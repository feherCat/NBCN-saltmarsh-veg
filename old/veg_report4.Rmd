---
title: "NCBN Salt Marsh Vegetation Monitoring Protocol Review"
output: 
  html_notebook: 
mainfont: Times New Roman
---

```{r setup, message=FALSE, warning=TRUE, include=FALSE}
library(tidyverse)
library(readxl)
library(gt)
library(flextable)
library(officer)
library(extrafont)
library(stringi)
library(cowplot)
library(lemon)
library(monochromeR)
library(vegan)
library(betareg)
library(ggh4x)
options(dplyr.summarise.inform = FALSE)
source(here::here("super_split.R"))
#font_import(pattern = "times")
#loadfonts(device = "win")

knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)

set.seed(1234)
load(here::here("data", "derived", "veg_cleaned.rda"))

set_flextable_defaults(
  font.size = 12,
  font.family = "times new roman",
  padding = 1
  )

park_pal <- c("#ef476f", "#f78c6b", "#ffd166", "#0bd59d", "#118ab2", "#073b4c"#, "#6E51AE" 
              )
asis_pal <- monochromeR::generate_palette("#ef476f", modification = "go_lighter", n_colours = 9)
#caco_pal <- monochromeR::generate_palette("#f78c6b", modification = "go_lighter", n_colours = 2)
colo_pal <- monochromeR::generate_palette("#f78c6b", modification = "go_lighter", n_colours = 8)
fiis_pal <- monochromeR::generate_palette("#ffd166", modification = "go_lighter", n_colours = 9)
gate_pal <- monochromeR::generate_palette("#0bd59d", modification = "go_lighter", n_colours = 3)
gewa_pal <- "#118ab2"
sahi_pal <- "#073b4c"
site_pal <- c(asis_pal, #caco_pal, 
              colo_pal, fiis_pal, gate_pal, gewa_pal, sahi_pal)
```

#### **1. Introduction**

##### **1.1** The NCBN Salt Marsh Vegetation Monitoring Protocol
|       The National Park Service Inventory and Monitoring (I&M) Program's Northeast Coastal and Barrier Network (NCBN) has identified salt marsh condition, in addition to several associated vital signs, as a high priority for long-term monitoring. The first iteration of the salt marsh vegetation monitoring protocol was originally developed by the USGS and University of Rhode Island for the purpose of comparing the vegetation community in hydrologically altered marshes to more pristine 'control' marshes in order to understand the potential effects of hydrologic restoration on salt marsh habitats within Cape Cod National Seashore (Roman et al., 2001). This protocol was then adapted to measure change in the species composition and abundance of the salt marsh plant community at the other six coastal parks monitored by NCBN in response to a multitude of stressors such as hydrologic alteration, storms, visitor use, nutrient loading, watershed development, sea-level rise and climate change, among others (Rocks and Stevens 2018). The salt marsh vegetation monitoring protocol was successfully implemented across seven NCBN parks over a period of 10 years from 2008 to 2018, but was placed on hold in 2018 due to staffing and budget shortages. To date, only a single analysis of the existing data has been conducted (Peck et al. 2021). However, this previous analysis examined only a subset of the data collected for this protocol and does not include many of the trend analyses that may be applicable to resource management in the parks. Since this protocol was put on hold in 2018, resource management staff at several parks in the NCBN network have expressed interest in both the results of the previous monitoring efforts and in continued salt marsh vegetation monitoring at their respective parks. Thus, the objectives of this report are: a) identify limitations of the current protocol and previous analyses conducted by Peck et al. (2021); b) provide additional analysis of the existing data and interpretation of the results that may be useful to the parks' resource management staff; and c) discuss alternative methods for continued monitoring of salt marsh vegetation in the parks.
&nbsp;

##### **1.2** Limitations of the Current Protocol
|        During the years that this protocol was active, it was by far the most labor- and time-intensive vital sign monitored by NCBN. For instance, assuming a four person crew (two full-time biologists and two interns) was used for each sampling event, a conservative estimate of 7,072 total man-hours were dedicated to field data collection alone during this time (i.e., 221 sampling events *x* 8 hours per day *x* 4 crew members). Further more, this estimate does not include the additional time needed for traveling to and from the NCBN main office (Kingston, Rhode Island) to each park, logistical considerations (e.g., time for budget and travel planning, equipment preparation, clean-up, etc.), or data management and annual reporting tasks, among others. For a more specific example, it took a total of 13 full days to complete field sampling at just 1 park - ASIS - in 2018. Similarly, this protocol was also one of the more budget intensive monitoring programs conducted by NCBN. In 2018, Rocks and Stevens (2018) estimated that the annual operational cost associated with the NCBN salt marsh vegetation monitoring protocol was $50,000 per year - a figure that would likely be much higher today. Thus, budget and staffing shortages represent a major impediment to continuing the field data collection procedures outlined in the existing protocol.
|       The data summaries that were suggested for annual reporting in the protocol implementation plan (Rocks and Stevens 2018) include species composition (species lists), percent cover for all cover types by site, and presence of any federal, state-listed and/or non-native species. Additionally, the protocol implementation plan also recommends that trend analysis be conducted on a 3-5 year basis and suggests the use of non-parametric multivariate community analysis methods such as analysis of similarities (ANOSIM) and similarity of percentages analysis (SIMPER) in order to understand change over time. The suggestion to include species lists for annual reporting are necessary in order to have a record of the full suite of species at each park and the compilation of these lists is relatively straightforward and easy to interpret. However, the recommended trend analysis (ANOSIM and SIMPER) do not actually calculate trends and only indicate where differences between plant communities have occurred in the previous sample years. As such, these methods of analysis have limited value for understanding the broader 'big-picture' changes in these salt marsh plant communities and also do not provide a means for predicting future changes and developing management actions that may be needed to either counteract or facilitate these changes. 
&nbsp;

##### **1.3** Limitations of Previous Analyses
|       In 2021, NCBN commissioned a report by Neptune and Company (hereafter referred to as Peck et al. 2021) that evaluates the sampling power of the salt marsh vegetation and nekton monitoring protocols and summarizes trends within a limited subset of the metrics collected as part of these protocols. For the vegetation protocol, the metrics of interest were a multimetric index (MMI) of salt marsh condition developed by Nagel et al. (2017), as well as individual metrics of community composition including the percent cover of Spartina patens and percent cover of high salinity plant species. Power simulations were performed to assess whether the data collected to date were sufficient to detect trends in either the multimetric index or previously listed individual metrics given the large amount of staff time and program money being spent on these protocols. Trends in the multimetric index and the two selected individual metrics for the period of 2008 to 2018 were also quantified using regression analyses. In this section, we have summarized the findings of Peck et al. (2021) and identified limitations of the study that could potentially be addressed by performing additional analyses on the existing data from 2008-2018.

|       First, Peck et al. (2021) suggested that the current sampling intensity and frequency are not high enough to detect a true difference in many of the metrics of interest at most parks (Table 2 below). Sampling efforts varied greatly between the parks due to differences in the areal extent of salt marsh habitats at each park (Table 1 below). However, there may be a limit to how many more plots (if any) could be added to each park given that salt marshes tend to occupy a relatively narrow fringe of the intertidal zone. For example, SAHI and GATE seem to have relatively small marsh areas, so it may not be possible to add any more sites/plots. Similarly, its plausible that ASIS and FIIS could also be “saturated” with plots given that a large portion of these parks is occupied by beach and dune habitats. Additionally, sampling efforts at each park are also limited by logistical constraints that are not within NCBN’s control, such as staff availability, travel funds, weather, and site access challenges.

|       Second, there are two limited conclusions that can be drawn from both a simple visual inspection of the plots showing how each measure changed over the study period (report figures 6-11) and results of the generalized linear models (report tables 3-8): 1) the selected metrics of vegetation community composition show no change at most parks, and 2) of the metrics that do have statistically significant rates of change (*Spartina patens* cover at FIIS and high salinity plant species cover at FIIS), the magnitude of these changes is relatively small (Table 4 below). The findings of Peck et al. (2021) are largely consistent with other similar monitoring studies that found that vegetation communities that are responding to long-term factors, like sea-level rise and climate change, as opposed to dramatic hydrologic alterations or discrete disturbance events (e.g., hurricanes), are likely to see changes that occur over decades or centennial time scales (Roman et al. 1997; Warren and Niering 1993). Additionally, for the measures that showed no change at some or all parks, changes in these communities could be occurring at extremely subtle rates that may not be discernible over the relatively short 10-year period that the vegetation and nekton monitoring protocols were active.

|       Although Peck et al. (2021) has value as both an assessment of the protocol's sampling frequency and intensity and as an initial exploratory data analysis, there are large amounts of data that were collected for the salt marsh vegetation monitoring protocol that were not examined in the report. For example, the protocol necessitates recording the presence and cover of every individual species found in every plot, but only a few species are used in the analyses. As such, the analyses contained within Peck et al. (2021) did not consider changes within the context of either a) ecologically significant groups that are known to characterize these habitats, or b) the entire full, comprehensive suite of species that comprise these communities. Given the multivariate nature of the data and the protocol's focus on monitoring change in biological communities over time, we have identified several analyses that could aid in interpreting and drawing conclusions from the existing 2008-2018 data set in the following sections.
&nbsp;

#### **2. Methods**
##### **2.1** Details of Park-Specific Sampling Schemes
```{r Sampling Schemes, message=FALSE, warning=FALSE, include=FALSE}
site_descriptions <- list(
  "year_site_plot_count" = plot_veg_cover_usda %>%
    group_by(UnitCode) %>%
    summarise(year_count = n_distinct(Year_chr),
              site_count = n_distinct(UniqueID),
              plot_count = n_distinct(EventID),
              min_year = min(as.integer(Year_chr)),
              max_year = max(as.integer(Year_chr))) %>%
    split(.$UnitCode),
  "site_list" = plot_veg_cover_usda %>%
    group_by(UnitCode) %>%
    distinct(UniqueID) %>%
    mutate(site = sub('.+_(.+)', '\\1', UniqueID)) %>%
    split(.$UnitCode),
  "site_year_list" = plot_veg_cover_usda %>%
    group_by(UnitCode, Year_chr) %>%
    distinct(UniqueID) %>%
    mutate(site = sub('.+_(.+)', '\\1', UniqueID),
           site_number = as.numeric(str_extract(site, "\\d+"))) %>%
    arrange(site_number) %>%
    summarise(site_list = str_flatten_comma(site, last = ", and ")) %>%
    group_by(UnitCode, site_list) %>%
    summarise(year_list = str_flatten_comma(Year_chr, last = ", and "),
              year_name = str_flatten(Year_chr, collapse = "_")) %>%
    mutate(year_name = paste0("a", year_name)) %>%
    super_split(UnitCode, year_name),
  "caco_site_list" = veg %>%
    filter(UnitCode == "CACO") %>%
    group_by(UnitCode) %>%
    distinct(UniqueID) %>%
    mutate(site = sub('.+_(.+)', '\\1', UniqueID)) %>%
    split(.$UnitCode)
)
```

|       At Assateague Island National Seashore, `r site_descriptions$year_site_plot_count$ASIS$site_count` sites were monitored biannually across `r site_descriptions$year_site_plot_count$ASIS$year_count` sampling events between `r site_descriptions$year_site_plot_count$ASIS$min_year` to `r site_descriptions$year_site_plot_count$ASIS$max_year` at a total of `r site_descriptions$year_site_plot_count$ASIS$plot_count` plots (Figure 1a). Annual reports summarizing the yearly data for the 2008, 2010, and 2012 monitoring seasons at Assateague are available in Patenaude and Pooler (2010a and 2011a) and Nicosia (2013a).
|       At Cape Cod National Seashore, `r length(site_descriptions$caco_site_list$CACO$site)` sites were monitored between 1997 to 2013. However, these sites were not monitored consistently across the same years because the study plan at this park was designed specifically for monitoring change at individual sites (rather than the entire park) following several different planned restoration projects. Given the difference in the study design as compared to the other six parks, we have excluded the data from Cape Cod from this analyses, although note that the park has published a monitoring report summarizing the monitoring data from 2003, 2008, and 2013 (Smith, 2015).
|       At Colonial National Historical Park, `r site_descriptions$year_site_plot_count$COLO$site_count` sites consisting of `r site_descriptions$year_site_plot_count$COLO$plot_count` plots were monitored across `r site_descriptions$year_site_plot_count$COLO$year_count` sampling events between `r site_descriptions$year_site_plot_count$COLO$min_year` to `r site_descriptions$year_site_plot_count$COLO$max_year` (Figure 1b). However, sites `r site_descriptions$site_year_list$COLO$a2008_2010$site_list` were measured between `r site_descriptions$site_year_list$COLO$a2008_2010$year_list`, but were then replaced by sites `r site_descriptions$site_year_list$COLO$a2012_2014_2016$site_list` in `r site_descriptions$site_year_list$COLO$a2012_2014_2016$year_list` due to time and access constraints. Annual reports summarizing the yearly data for the 2008, 2010, 2012, and 2014 monitoring seasons at Colonial are available in Patenaude and Pooler (2010b and c) and Nicosia (2013b and 2015a).
|       At Fire Island National Seashore, `r site_descriptions$year_site_plot_count$FIIS$site_count` sites were monitored biannually across `r site_descriptions$year_site_plot_count$FIIS$year_count` sampling events between `r site_descriptions$year_site_plot_count$FIIS$min_year` to `r site_descriptions$year_site_plot_count$FIIS$max_year` at a total of `r site_descriptions$year_site_plot_count$FIIS$plot_count` plots (Figure 1c), with the exception of site F6 which was not measured in 2013. Annual reports summarizing the yearly data for the 2009, 2011, and 2015 monitoring seasons at Fire Island are available in Patenaude and Pooler (2010d and 2010e), Nicosia and Pooler (2012a and 2012b), and Nicosia (2015b).
|       At Gateway National Recreation Area , `r site_descriptions$year_site_plot_count$GATE$site_count` sites were monitored biannually across `r site_descriptions$year_site_plot_count$GATE$year_count` sampling events between `r site_descriptions$year_site_plot_count$GATE$min_year` to `r site_descriptions$year_site_plot_count$max_year` at a total of `r site_descriptions$year_site_plot_count$GATE$plot_count` plots (Figure 1d). However, note that only site 1 site - `r site_descriptions$site_year_list$GATE$a2014$site_list` - was measured in 2014. Gateway National Recreation Area consists of three units including the Jamaica Bay unit in Brooklyn (New York), the Staten Island unit (New York), and the Sandy Hook unit (Monmouth County, New Jersey), however only the Sandy Hook unit was sampled as part of the NCBN salt marsh vegetation monitoring protocol. Annual reports summarizing the yearly data for the 2010, 2012, and 2014 monitoring seasons at Gateway are available in Patenaude and Pooler (2011b) and Nicosia (2013c and 2015c).
|       At George Washington Birthplace National Monument, only 1 site was measured biannually across `r site_descriptions$year_site_plot_count$GEWA$year_count` sampling events between `r site_descriptions$year_site_plot_count$GEWA$min_year` to `r site_descriptions$year_site_plot_count$GEWA$max_year` at a total of `r site_descriptions$year_site_plot_count$plot_count` plots (Figure 1e). Annual reports summarizing the yearly data for the 2008, 2010, and 2012 monitoring seasons at George Washington Birthplace are available in Patenaude and Pooler (2010g and 2011c) and Nicosia (2013d).
|       At Sagamore Hill National Historic Site, only 1 site was measured biannually across `r site_descriptions$year_site_plot_count$SAHI$year_count` sampling events between `r site_descriptions$year_site_plot_count$SAHI$min_year` to `r site_descriptions$year_site_plot_count$SAHI$max_year` at a total of `r site_descriptions$year_site_plot_count$SAHI$plot_count` plots (Figure 1f). Annual reports summarizing the yearly data for the 2009, 2011, and 2015 monitoring seasons Sagamore Hill are available in Patenaude and Pooler (2010h), Nicosia and Pooler (2012c), and Nicosia (2015d).
|       Note that parks will be referred to with their respective four-letter unit codes throughout the remainder of the text (Table 1). Additional details of the monitoring scheme used at each park are presented in Table 1.    
&nbsp;

![Figure.1 Map of salt marsh monitoring sites at each of the six NCBN parks.](veg_nekton_site_map.jpg)
&nbsp;

```{r Table 1, echo=FALSE, message=FALSE, warning=FALSE}
plot_veg_cover_usda %>%
  group_by(UnitCode) %>%
  summarise(site_count = n_distinct(UniqueID),
            plot_count = n_distinct(EventID),
            min_year = min(as.numeric(Year_chr)),
            max_year = max(as.numeric(Year_chr)),
            sample_events = n_distinct(Year_chr),
            years_sampled = toString(unique(sort(Year_chr))),
            sites = toString(unique(sort(stri_extract(UniqueID, regex = "(?<=_).*"))))) %>% 
  mutate(full_park_name = case_when(
    UnitCode == "ASIS" ~ "Assateague Island National Seashore",
    #UnitCode == "CACO" ~ "Cape Cod National Seashore",
    UnitCode == "COLO" ~ "Colonial National Historical Park",
    UnitCode == "FIIS" ~ "Fire Island National Seashore",
    UnitCode == "GATE" ~ "Gateway National Recreation Area",
    UnitCode == "GEWA" ~ "George Washington Birthplace National Monument",
    UnitCode == "SAHI" ~ "Sagamore Hill National Historic Site"
  ),
    State = case_when(
    UnitCode == "ASIS" ~ "MD, VA",
    #UnitCode == "CACO" ~ "MA",
    UnitCode == "COLO" ~ "VA",
    UnitCode == "FIIS" ~ "NY",
    UnitCode == "GATE" ~ "NJ, NY",
    UnitCode == "GEWA" ~ "VA",
    UnitCode == "SAHI" ~ "NY"
        )) %>%
flextable(., col_keys = c("full_park_name", "UnitCode", "State", "site_count", "sites", "plot_count", "years_sampled", "sample_events")) %>%
  align(., align = "center", part = "all") %>%
  set_table_properties(., width = 1, layout = "autofit") %>%
  add_header_lines(., values = c("Table 1. Site count, plot count, monitoring years, and count of sampling events at each park utilizing the NCBN salt marsh vegetation monitoring protocol.")) %>%
  set_header_labels(., full_park_name = "Park", UnitCode = "Unit Code", State = "Location", site_count = "Number of Sites", sites = "Site List", plot_count = "Number of Plots", years_sampled = "Sample Years", sample_events = "Sampling Events") %>%
  align(., i = 1, align = "left", part = "header") %>%
  border_inner_h(., border = fp_border(color = "transparent"), part = "body") %>%
  padding(., part = "body", padding.top = 3, padding.bottom = 3) 
```
&nbsp;

##### **2.2** Additional Analyses of the 2008-2018 Data
|       We compared changes in the salt marsh plant community over time within the 6 park units using the following three metrics: average total plot cover, total park-level species richness, and the number of species unique to each park. Average total plot cover was calculated as the average sum of the cover of all species in each plot. Total park-level species richness was calculated as the total number of distinct species found at each park. The number of unique species at each park represents the count of species at a park that were not found at the other five parks. For these three metrics, comparisons over time within each park are presented as line graphs with the sample years on the x-axis and the respective metric on the y-axis, with separate panels for each park unit. Error values and error bars represent the standard error of the average park-level yearly values for these three metrics. In the results section below, parks with a change in average total cover greater than 10% between the first and last sampling period were designated as increasing in average total cover, parks with a change in average total cover less than -10% were designated as decreasing in average total cover, and parks with changes in average total cover between -10% to 10% were designated as not changing over the respective study period for each park. Similarly, parks with a change in total park-level species richness or the count of unique species greater than 2 between the first and last sampling period were designated as increasing, parks with a change in these metrics less than -2 were designated as decreasing, and parks with a change in these metrics between -2 to 2 were designated as not changing over the respective study period for each park. A summary of the changes in average total plot cover, park-level species richness, and the count of unique species between the first and last sampling event at each park in shown in Table 2. 

|       For the species present in each park, we identified any species that were classified as either threatened or endangered at the federal level according to the U.S. Fish and Wildlife Service's 2024 threatened and endangered species list (Department of the Interior, Fish and Wildlife Service, 50 CFR Part 17, Docket No. FWS-HQ-ES-2023-0018; FXES1113090FEDR-245-FF09E23000, RIN 1018-BF88). Additionally, we identified any species that were considered threatened, endangered, rare, or vulnerable by the respective state where each park was located (hereafter referred to as threatened or endangered at the state-level) according to either the NPSpecies list for each park, or from individual lists published by each state. Similarly, we also identified species that were highlighted as either "management priority" or "exploitation concern" in the NPSpecies list for each park. Finally, we identified any species that were considered invasive, noxious, or prohibited by each respective state. Sources for these state-level threatened and endangered species lists and invasive species lists are provided in Appendix 1. 

|       Since salinity is known to be a key factor controlling plant community composition in coastal wetlands, we also compared changes over time in the count (i.e., richness), frequency, and percent cover of species with low, medium, and high salinity tolerance at each park. We used the salinity tolerance categories from the USDA plants database to categorize the salinity tolerance of each species as either low (< 0.5 ppt), medium (0.5 to 18 ppt), or high (> 18 ppt). Note that there were several species (n = 47 out of `r n_distinct(plot_veg_cover_usda$SciName_cor)`) that did not have salinity tolerance classifications in the USDA plants database. The salinity tolerance of each species is shown in the species list for each park in Appendix 3. In the results section below, salinity tolerance categories with a change in species count that were greater than 2, a change in frequency greater 0.05, or a change in percent cover greater than 10% between the first and last sampling period at each park were designated as increasing. Salinity tolerance categories with a change in species count that were less than -2, a change in frequency less than -0.05, or a change in percent cover less than -10% between the first and last sampling period at each park were designated as decreasing. Salinity tolerance categories with a change in species count that were between -2 to 2, a change in frequency between -0.05 to 0.05, or a change in percent cover between -10% to 10% between the first and last sampling period at each park were designated as not changing over the respective study period at each park. A summary of the changes in species count, frequency, and percent cover in each salinity category at each park is presented in Table X.

|       Similarly, we also compared changes over time in the count, frequency, and percent cover of species in eight distinct community classes at each park. The eight community classes included freshwater wetland, salt marsh, salt marsh open ditch, salt marsh plugged ditch, salt marsh pool/panne, salt marsh shoreline, tidal creek, and tidal lagoon. Note that there were several species (n = 44 out of `r n_distinct(plot_veg_cover_usda$SciName_cor)`) that had not been assigned to a community class. The community classification for each species is shown in the species list for each park in Appendix 3. In the results section below, community classes with a change in species count that were greater than 2, a change in frequency greater 0.05, or a change in percent cover greater than 10% between the first and last sampling period at each park were designated as increasing. Community classes with a change in species count that were less than -2, a change in frequency less than -0.05, or a change in percent cover less than -10% between the first and last sampling period at each park were designated as decreasing. Community classes with a change in species count that were between -2 to 2, a change in frequency between -0.05 to 0.05, or a change in percent cover between -10% to 10% between the first and last sampling period at each park were designated as not changing over the respective study period at each park. A summary of the changes in species count, frequency, and percent cover in each community class at each park is presented in Table X.

|       In keeping with the NCBN Salt Marsh Vegetation Monitoring SOP for data analyses and reporting (Rocks and Stevens 2018), the park-level average cover and average frequency of occurrence was calculated prior to the previously mentioned analyses of threatened and endangered species, invasive species, salinity tolerance, and community classification. Park-level average cover of each species was calculated as the average of the percent cover of each species across all plots in each year (see SOP 7, section 7.4.1 for additional details). Similarly, the average frequency of occurrence (hereafter referred to as frequency) of each species was calculated by first dividing the number of plots in which a species was found by the total number of plots sampled at each site in each year, and then averaging the site-level frequency values up to the park-level (see SOP 7, section 7.4.1 for additional details).

|       Finally, we compared changes in plant community composition over time at each park using permutational multivariate analysis of variance using distance matrices (ADONIS) via the 'adonis2' function from the R package 'vegan.' Although an analysis of similarities (a.k.a. ANOSIM) was recommended for trend analysis in the original NCBN salt marsh vegetation monitoring protocol, we opted to use the ADONIS model since ANOSIM can potentially confound the differences between groups with the dispersion within groups (Warton et al., 2012). For parks where the ADONIS model detected a significant difference between years, we used post-hoc pairwise comparisons with Benjamini and Hochberg corrections (Benjamini and Hochberg 1995) via the function 'pairwise.adonis' in the R package 'pairwiseAdonis' to find the year-pairs with significant differences. Finally, we used the 'kruskal.test' function from the R package 'stats' to find the species with significantly different percent cover for the year pairs identified in the previous pairwise comparisons.
&nbsp;

#### **3. Results**

```{r Data Setup Percent Cover Frequency, message=FALSE, warning=FALSE, include=FALSE}
perc_cover <- plot_veg_cover_usda %>%
  ungroup() %>%
  select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, PercentCover) %>%
  pivot_wider(., names_from = SciName_cor, values_from = PercentCover, values_fill = 0) %>%
  pivot_longer(., cols = -c("EventID", "UniqueID", "UnitCode", "Year_chr"), names_to = "SciName_cor", values_to = "PercentCover") %>%
  group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  mutate(total_species_site_cover = sum(PercentCover)) %>%
  filter(total_species_site_cover > 0) %>% # filter out species that weren't found at any plots within each site
  group_by(UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_cover = mean(PercentCover),
            se_cover = sd(PercentCover)/sqrt(length(PercentCover)))

perc_cover_site <- plot_veg_cover_usda %>%
  ungroup() %>%
  select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, PercentCover) %>%
  pivot_wider(., names_from = SciName_cor, values_from = PercentCover, values_fill = 0) %>%
  pivot_longer(., cols = -c("EventID", "UniqueID", "UnitCode", "Year_chr"), names_to = "SciName_cor", values_to = "PercentCover") %>%
  group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  mutate(total_species_site_cover = sum(PercentCover)) %>%
  filter(total_species_site_cover > 0) %>% # filter out species that weren't found at any plots within each site
  summarise(mean_site_cover = mean(PercentCover))

perc_cover_park <- plot_veg_cover_usda %>%
  ungroup() %>%
  select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, PercentCover) %>%
  pivot_wider(., names_from = SciName_cor, values_from = PercentCover, values_fill = 0) %>%
  pivot_longer(., cols = -c("EventID", "UniqueID", "UnitCode", "Year_chr"), names_to = "SciName_cor", values_to = "PercentCover") %>%
  group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  mutate(total_species_site_cover = sum(PercentCover)) %>%
  filter(total_species_site_cover > 0) %>% # filter out species that weren't found at any plots within each site
  group_by(UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_cover = mean(PercentCover),
            se_cover = sd(PercentCover)/sqrt(length(PercentCover))) %>%
  left_join(., plot_veg_cover_npspecies %>%
              ungroup() %>%
              select(-c(EventID, UniqueID, SubunitCode, Date, SciName_obs, TSN, PercentCover, total_percent_cover,
                        rel_percent_cover, CommonName, AcceptedSymbol, State, Duration, GrowthHabit, 
                        Nativity, invasive_caco, rare_ma, data_Name_submitted, data_Accepted_species,
                        nps_Name_submitted, nps_Accepted_species, `Park Code`)) %>%
              distinct(),
            by = c("UnitCode", "Year_chr", "SciName_cor"))

perc_cover_siteb <- plot_veg_cover_usda %>%
  ungroup() %>%
  select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, PercentCover) %>%
  pivot_wider(., names_from = SciName_cor, values_from = PercentCover, values_fill = 0) %>%
  pivot_longer(., cols = -c("EventID", "UniqueID", "UnitCode", "Year_chr"), names_to = "SciName_cor", values_to = "PercentCover") %>%
  group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  mutate(total_species_site_cover = sum(PercentCover)) %>%
  filter(total_species_site_cover > 0) %>% # filter out species that weren't found at any plots within each site
  group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_site_cover = mean(PercentCover)) %>%
  left_join(., plot_veg_cover_npspecies %>%
              ungroup() %>%
              select(-c(EventID, SubunitCode, Date, SciName_obs, TSN, PercentCover, total_percent_cover,
                        rel_percent_cover, CommonName, AcceptedSymbol, State, Duration, GrowthHabit, 
                        Nativity, invasive_caco, rare_ma, data_Name_submitted, data_Accepted_species,
                        nps_Name_submitted, nps_Accepted_species, `Park Code`)) %>%
              distinct(),
            by = c("UniqueID", "UnitCode", "Year_chr", "SciName_cor"))
```

```{r , message=FALSE, warning=FALSE, include=FALSE}
frq <- site_veg_frq_usda %>% # frequency averaged up to the park-level
  ungroup() %>%
  select(UniqueID, UnitCode, Year_chr, SciName_cor, frq) %>%
  pivot_wider(., names_from = "SciName_cor", values_from = "frq", values_fill = 0) %>%
  pivot_longer(., cols = -c("UniqueID", "UnitCode", "Year_chr"), names_to = "SciName_cor", values_to = "frq") %>%
  group_by(UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_frq = mean(frq),
            se_frq = sd(frq)/sqrt(length(frq)))
```
##### **3.1** Total Cover & Species Richness
```{r Total Cover, echo=FALSE, message=FALSE, warning=FALSE}

total_cover_df <- plot_veg_cover_usda %>%
  group_by(EventID, UniqueID, UnitCode, Year_chr) %>%
  summarise(mean_year_plot_total_cover = mean(total_percent_cover, na.rm = TRUE)) %>%
  group_by(UniqueID, UnitCode, Year_chr) %>%
  summarise(mean_year_site_total_cover = mean(mean_year_plot_total_cover, na.rm = TRUE)) %>% 
  group_by(UnitCode, Year_chr) %>%
  summarise(mean_year_total_cover = mean(mean_year_site_total_cover, na.rm = TRUE),
            se_year_total_cover = sd(mean_year_site_total_cover)/sqrt(length(mean_year_site_total_cover)))

total_cover_results <- list(
  #https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#a-beta-regression

  "total_cov_mods" = plot_veg_cover_usda %>%
    group_by(EventID, UniqueID, UnitCode, Year_chr) %>%
    summarise(mean_year_plot_total_cover = mean(total_percent_cover, na.rm = TRUE)) %>%
    group_by(UniqueID, UnitCode, Year_chr) %>%
    summarise(mean_year_site_total_cover = mean(mean_year_plot_total_cover, na.rm = TRUE)) %>%
    mutate(mean_year_site_total_cover = if_else(mean_year_site_total_cover > 100, 100, mean_year_site_total_cover)) %>%
    group_by(UnitCode) %>%
    mutate(year = as.numeric(Year_chr),
           year_num = as.numeric(year-min(year)),
           beta_cover = mean_year_site_total_cover/100) %>%
    filter(UnitCode != "GEWA") %>%
    nest() %>%
    mutate(beta_mod = map(data, ~betareg(beta_cover ~ year_num, data = .x, link = "loglog")),
           summary_mod = map(beta_mod, ~summary(.x)),
           pval = map_dbl(summary_mod, ~.x$coefficients[[1]][[8]])) %>%
    filter(pval < 0.05) %>%
    mutate(int = map_dbl(summary_mod, ~.x$coefficients[[1]][[1]]),
           b1 =  map_dbl(summary_mod, ~.x$coefficients[[1]][[2]]),
           b1_se = map_dbl(summary_mod, ~.x$coefficients[[1]][[4]]), 
           change_cover = map2_dbl(int, b1, ~plogis(.x + .y) - plogis(.x))*100,
           change_cover_se = map2_dbl(int, b1_se, ~plogis(.x + .y) - plogis(.x))*100,
           r2 = map_dbl(summary_mod, ~.x$pseudo.r.squared),
           change_cover_lab = paste0("Rate of change: ", round(change_cover,1), " ± ", round(change_cover_se, 1), " %/yr"),
           r2_lab = format(round(r2, 2), nsmall = 2)
           ),
  
  "plot_betas" =  plot_veg_cover_usda %>%
    group_by(EventID, UniqueID, UnitCode, Year_chr) %>%
    summarise(mean_year_plot_total_cover = mean(total_percent_cover, na.rm = TRUE)) %>%
    group_by(UniqueID, UnitCode, Year_chr) %>%
    summarise(mean_year_site_total_cover = mean(mean_year_plot_total_cover, na.rm = TRUE)) %>%
    mutate(mean_year_site_total_cover = if_else(mean_year_site_total_cover > 100, 100, mean_year_site_total_cover)) %>%
    group_by(UnitCode) %>%
    mutate(year = as.numeric(Year_chr),
           year_num = as.numeric(year-min(year)),
           beta_cover = mean_year_site_total_cover/100) %>%
    filter(UnitCode != "GEWA") %>%
    nest() %>%
    mutate(beta_mod = map(data, ~betareg(beta_cover ~ year_num, data = .x, link = "loglog")),
           summary_mod = map(beta_mod, ~summary(.x)),
           pval = map_dbl(summary_mod, ~.x$coefficients[[1]][[8]])) %>%
    filter(pval < 0.05) %>%
    mutate(int = map_dbl(summary_mod, ~.x$coefficients[[1]][[1]]),
           b1 =  map_dbl(summary_mod, ~.x$coefficients[[1]][[2]]),
           b1_se = map_dbl(summary_mod, ~.x$coefficients[[1]][[4]]), 
           change_cover = map2_dbl(int, b1, ~plogis(.x + .y) - plogis(.x))*100,
           min_date = map(data, ~as.Date(paste0(min(.x$year), "-01-01"))-(0.4*365.25)),
           min_date_num = map(data, ~min(.x$year_num)-(1)),
           max_date_num = map(data, ~max(.x$year_num)+(2)),
           nd = map2(min_date_num, max_date_num, ~data.frame("year_num" = seq(.x, .y, by = 0.5))),
           pred = map2(beta_mod, nd, ~data.frame(bind_cols(nd, "mean_year_total_cover" = predict(.x, newdata = .y)) %>% mutate(mean_year_total_cover = mean_year_total_cover * 100)))
           ) %>%
    select(UnitCode, pred, min_date, min_date_num, max_date_num) %>%
    unnest() %>%
    mutate(Year = as.Date(min_date) + (year_num*365.25)),
  
  "plot_lims" = list(
    scale_x_date(expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y"),
    scale_x_date(expand = c(0,0), sec.axis = dup_axis(), date_labels = "'%y"),
    scale_x_date(expand = c(0,0), sec.axis = dup_axis(), date_labels = "'%y"),
    scale_x_date(expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y"),
    scale_x_date(expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y"),
    scale_x_date(expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y")
  ),
  
  "total_cover_difs" = total_cover_df %>%
    group_by(UnitCode) %>%
    mutate(min_year = as.character(min(as.integer(Year_chr))),
           max_year = as.character(max(as.integer(Year_chr)))) %>%
    mutate(is_min_max_year = if_else(Year_chr == min_year | Year_chr == max_year, "T", NA)) %>%
    filter(is_min_max_year == "T") %>%
    mutate(year_grp = if_else(Year_chr == min_year, "min", "max")) %>%
    ungroup() %>%
    select(UnitCode, year_grp, mean_year_total_cover) %>%
    pivot_wider(., names_from = "year_grp", values_from = "mean_year_total_cover", values_fill = 0) %>%
    mutate(dif = round(max - min,1),
           value_lab = round(max-min,1)) %>%
    mutate(min = paste0(format(round(min,1), nsmall = 1), "%"),
           max = paste0(format(round(max,1), nsmall = 1), "%")) %>%
    filter(dif < -10 | dif > 10) %>%
    split(.$UnitCode),
  
  "avg_total_cover" = total_cover_df %>%
    group_by(UnitCode) %>%
    summarise(mean_total_cover = format(round(mean(mean_year_total_cover),1),nsmall=1),
              se_total_cover = format(round(sd(mean_year_total_cover)/sqrt(length(mean_year_total_cover)),1), nsmall = 1)) %>%
    mutate(mean_se = paste0(mean_total_cover, "%", " (± ", se_total_cover,")")) %>%
    split(.$UnitCode) %>%
    map(., ~pull(.,mean_se))
)
```

```{r Species richness, message=FALSE, warning=FALSE, include=FALSE}

species_richness_dfs <- list(
  "park_species_richness_per_yr" = plot_veg_cover_usda %>% # park-level species richness for each year across all years
    group_by(UnitCode, Year_chr) %>%
    summarise(plot_num = n_distinct(EventID),
              site_num = n_distinct(UniqueID),
              total_richness = n_distinct(SciName_cor)),
  
  "park_species_richness_all_yrs" = plot_veg_cover_usda %>% # park-level species richness across all years
    group_by(UnitCode) %>%
    summarise(plot_num = n_distinct(EventID),
              site_num = n_distinct(UniqueID),
              total_richness = n_distinct(SciName_cor)),
  
  "park_unique_species" = plot_veg_cover_usda %>% # unique species found in each park (i.e., species not found in any other parks)
    ungroup() %>%
    select(UnitCode, SciName_cor) %>%
    unique() %>%
    group_by(SciName_cor) %>%
    reframe(parks = as.list(unique(UnitCode))) %>%
    group_by(SciName_cor) %>%
    mutate(park_count = length(parks)) %>%
    filter(park_count == 1) %>%
    unnest(parks) %>%
    select("UnitCode" = parks, SciName_cor, park_count),
  
  "park_unique_species_count" = plot_veg_cover_usda %>% # count of unique species found in each park
    ungroup() %>%
    select(UnitCode, SciName_cor) %>%
    unique() %>%
    group_by(SciName_cor) %>%
    reframe(parks = as.list(unique(UnitCode))) %>%
    group_by(SciName_cor) %>%
    mutate(park_count = length(parks)) %>%
    filter(park_count == 1) %>%
    unnest(parks) %>%
    select("UnitCode" = parks, SciName_cor, park_count) %>%
    group_by(UnitCode) %>%
    summarise(n_unique = n_distinct(SciName_cor)),
  
  "park_unique_species_count_per_year" = plot_veg_cover_usda %>% # count of unique species per year
    ungroup() %>%
    select(UnitCode, Year_chr, SciName_cor) %>%
    unique() %>%
    left_join(., plot_veg_cover_usda %>% # unique species found in each park (i.e., species not found in any other parks)
                ungroup() %>%
                select(UnitCode, SciName_cor) %>%
                unique() %>%
                group_by(SciName_cor) %>%
                reframe(parks = as.list(unique(UnitCode))) %>%
                group_by(SciName_cor) %>%
                mutate(park_count = length(parks)) %>%
                filter(park_count == 1) %>%
                unnest(parks) %>%
                select("UnitCode" = parks, SciName_cor, park_count), 
              by = c("UnitCode", "SciName_cor")) %>%
    filter(!is.na(park_count)) %>%
    group_by(UnitCode, Year_chr) %>%
    summarise(n_unique = n_distinct(SciName_cor)) %>%
    ungroup() %>%
    add_row(UnitCode = c("ASIS", "ASIS", "ASIS", "SAHI", "SAHI"), Year_chr = c("2012", "2014", "2018", "2011", "2013"), n_unique = rep(0,5))
)

species_richness_results <- list(
  
  "species_richness_mods" = species_richness_dfs$park_species_richness_per_yr %>%
    group_by(UnitCode) %>%
    mutate(year = as.numeric(Year_chr),
           year_num = as.numeric(year-min(year))) %>%
    nest() %>%
    mutate(nb_mod = map(data, ~MASS::glm.nb(total_richness ~ year_num, data = .x)),
           summary_mod = map(nb_mod, ~summary(.x)),
           pval = map_dbl(summary_mod, ~coef(.x)[8])) %>%
    filter(pval < 0.05) %>%
    mutate(dev = map_dbl(summary_mod, ~.x$deviance),
           resid_df = map_dbl(summary_mod, ~.x$df.residual),
           f = 1-pchisq(dev, resid_df),
           b1 =  map_dbl(summary_mod, ~coef(.x)[2]),
           b1_se = map_dbl(summary_mod, ~coef(.x)[4]), 
           change_richness = map_dbl(b1, ~(1-exp(.x))*100), #https://stats.stackexchange.com/questions/478383/interpret-coefficient-of-negative-binomial-regression
           change_richness_se = map_dbl(b1_se, ~(1-exp(.x))*100),
           r2 = map_dbl(summary_mod, ~1-.x$deviance/.x$null.deviance), #https://www.statology.org/glm-r-squared/
           change_richness_lab = paste0("Rate of change: ", format(round(change_richness,1), nsmall = 1), " ± ", round(change_richness_se, 1), " sp./yr"),
           r2_lab = format(round(r2, 2), nsmall = 2)
           ),

  "plot_betas" = species_richness_dfs$park_species_richness_per_yr %>%
    group_by(UnitCode) %>%
    mutate(year = as.numeric(Year_chr),
           year_num = as.numeric(year-min(year))) %>%
    nest() %>%
    mutate(nb_mod = map(data, ~MASS::glm.nb(total_richness ~ year_num, data = .x)),
           summary_mod = map(nb_mod, ~summary(.x)),
           pval = map_dbl(summary_mod, ~coef(.x)[8])) %>%
    filter(pval < 0.05) %>%
    mutate(dev = map_dbl(summary_mod, ~.x$deviance),
           resid_df = map_dbl(summary_mod, ~.x$df.residual),
           f = 1-pchisq(dev, resid_df),
           b1 =  map_dbl(summary_mod, ~coef(.x)[2]),
           b1_se = map_dbl(summary_mod, ~coef(.x)[4]), 
           change_richness = map_dbl(b1, ~(1-exp(.x))*100),
           min_date = map(data, ~as.Date(paste0(min(.x$year), "-01-01"))-(0.4*365.25)),
           min_date_num = map(data, ~min(.x$year_num)-(1)),
           max_date_num = map(data, ~max(.x$year_num)+(1.5)),
           nd = map2(min_date_num, max_date_num, ~data.frame("year_num" = seq(.x, .y, by = 0.5))),
           pred = map2(nb_mod, nd, ~data.frame(bind_cols(nd, "richness" = predict(.x, newdata = .y, type = "response"))))
    ) %>%
    select(UnitCode, pred, min_date, min_date_num, max_date_num) %>%
    unnest() %>%
    mutate(Year = as.Date(min_date) + (year_num*365.25),
           richness_metric = "total_richness"),
  
  "plot_lims" = list(
    scale_x_date(expand = c(0,0), date_labels = "'%y", sec.axis = dup_axis()),
    scale_x_date(sec.axis = dup_axis(), date_labels = "'%y"),
    scale_x_date(date_labels = "'%y", sec.axis = dup_axis()),
    scale_x_date(date_labels = "'%y", sec.axis = dup_axis()),
    scale_x_date(date_labels = "'%y", sec.axis = dup_axis()),
    scale_x_date(date_labels = "'%y", sec.axis = dup_axis())
  ),
  
  "unique_species_mods" = species_richness_dfs$park_unique_species_count_per_year %>%
    group_by(UnitCode) %>%
    mutate(year = as.numeric(Year_chr),
           year_num = as.numeric(year-min(year))) %>%
    nest() %>%
    mutate(nb_mod = map(data, ~MASS::glm.nb(n_unique ~ year_num, data = .x)),
           summary_mod = map(nb_mod, ~summary(.x)),
           pval = map_dbl(summary_mod, ~coef(.x)[8])) %>%
    filter(pval < 0.05),
  
  "park_richness_df" = species_richness_dfs$park_species_richness_per_yr %>% 
      select(UnitCode, Year_chr, total_richness) %>%
      mutate(Year_chr = paste0("a_", Year_chr)) %>%
      super_split(UnitCode, Year_chr),
  
  "unique_species_df" = species_richness_dfs$park_unique_species_count_per_year %>%
      mutate(Year_chr = paste0("a_", Year_chr)) %>%
      super_split(UnitCode, Year_chr),
  
  "total_richness" = species_richness_dfs$park_species_richness_all_yrs %>% 
    ungroup() %>% 
    split(.$UnitCode) %>% 
    map(., ~pull(., total_richness)),
  
  "total_unique" = species_richness_dfs$park_unique_species_count %>% 
    ungroup() %>% 
    split(.$UnitCode) %>% 
    map(., ~pull(., n_unique)),
  
  "park_richness_difs" = species_richness_dfs$park_species_richness_per_yr %>%
    group_by(UnitCode) %>%
    mutate(min_year = as.character(min(as.integer(Year_chr))),
           max_year = as.character(max(as.integer(Year_chr)))) %>%
    mutate(is_min_max_year = if_else(Year_chr == min_year | Year_chr == max_year, "T", NA)) %>%
    filter(is_min_max_year == "T") %>%
    mutate(year_grp = if_else(Year_chr == min_year, "min", "max")) %>%
    ungroup() %>%
    select(UnitCode, year_grp, total_richness) %>%
    pivot_wider(., names_from = "year_grp", values_from = "total_richness") %>%
    mutate(dif = round(max - min,0),
           value_lab = round(max-min,0)) %>%
    filter(dif < -2 | dif > 2),
  
  "unique_species_difs" = species_richness_dfs$park_unique_species_count_per_year %>%
    group_by(UnitCode) %>%
    mutate(min_year = as.character(min(as.integer(Year_chr))),
           max_year = as.character(max(as.integer(Year_chr)))) %>%
    mutate(is_min_max_year = if_else(Year_chr == min_year | Year_chr == max_year, "T", NA)) %>%
    filter(is_min_max_year == "T") %>%
    mutate(year_grp = if_else(Year_chr == min_year, "min", "max")) %>%
    ungroup() %>%
    select(UnitCode, year_grp, n_unique) %>%
    pivot_wider(., names_from = "year_grp", values_from = "n_unique") %>%
    mutate(dif = round(max - min,0),
           value_lab = round(max-min,0)) %>%
    filter(dif < -2 | dif > 2),
  
  "all_yrs_species" = site_veg_frq_usda %>%
  group_by(UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_frq = mean(frq, na.rm = TRUE)) %>%
  group_by(UnitCode, Year_chr) %>%
  arrange(UnitCode, SciName_cor, Year_chr) %>%
  group_by(UnitCode, SciName_cor) %>%
  mutate(n_years = n(),
         all_years = case_when(UnitCode == "ASIS" & n_years >= 6 ~ TRUE,
                               UnitCode == "COLO" & n_years >= 5 ~ TRUE,
                               UnitCode == "FIIS" & n_years >= 5 ~ TRUE,
                               UnitCode == "GATE" & n_years >= 5 ~ TRUE,
                               UnitCode == "GEWA" & n_years >= 3 ~ TRUE,
                               UnitCode == "SAHI" & n_years >= 5 ~ TRUE,
                               T ~ FALSE)) %>%
  ungroup() %>%
  filter(all_years == TRUE) %>%
  select(UnitCode, SciName_cor) %>%
  distinct()
)
```

|       With the exception of SAHI, average total plot cover decreased over the study period at all parks, although the decrease in total cover was more pronounced at some parks than others (Table 2, Figure 2). For example, at FIIS and GEWA, total plot cover declined substantially between the first sampling event to the last sampling event and showed no signs of recovery (Table 2, Figure 2c and 2e). Alternatively, total plot cover at ASIS, COLO, and GATE declined from the beginning of the study period and appeared to reach a low in 2014, 2012, 2016, and 2015 (respectively), but then appeared to recover during the following sampling event(s), although not back to their previous levels (Figure 2a, 2b, and 2d). A summary of the changes in average total plot cover between the first and last sampling event at each park in shown in Table 2. 
|       In total, we identified `r plot_veg_cover_usda %>% ungroup() %>% select(SciName_cor) %>% n_distinct()` plant species across all 6 parks. Of these species, `r species_richness_dfs$park_unique_species %>% ungroup() %>% summarise(sum(park_count)) %>% pull()` were unique to a single park. A summary of the changes in park-level species richness and the count of unique species between the first and last sampling event at each park in shown in Table 2. The species with the top five cover, frequency of occurrence, and importance values at each park are shown in Appendix 2.
&nbsp;

```{r Table 2, echo=FALSE, message=FALSE, warning=FALSE, fig.height = 2, out.height = 2}
total_cover_results$total_cover_difs %>%
  bind_rows(.) %>%
  select(UnitCode, "total_cov_dif" = value_lab) %>%
  left_join(., species_richness_results$park_richness_difs %>%
              select(UnitCode, "park_richness_dif" = value_lab), 
            by = "UnitCode") %>%
  left_join(., species_richness_results$unique_species_difs %>%
              select(UnitCode, "unique_species_dif" = value_lab), 
            by = "UnitCode") %>%
  mutate(across(
    c(total_cov_dif, park_richness_dif, unique_species_dif), 
    ~case_when(.x > 0 ~ paste0("↑ +", .x),
               .x < 0 ~ paste0("↓ ", .x),
               is.na(.x) ~ "-"))
  ) %>%
  mutate(total_cov_dif = paste0(total_cov_dif, "%")) %>%
  add_row(., UnitCode = "SAHI", total_cov_dif = "-", park_richness_dif = "-", unique_species_dif = "-") %>%
  flextable(.) %>%
  set_header_labels(., UnitCode = "Park", total_cov_dif = "Average total\nplot cover", park_richness_dif = "Total park-level\nspecies richness", unique_species_dif = "Count of\nunique species") %>%
  align(., align = "center", part = "all") %>%
  highlight(., j = "total_cov_dif", i = ~ total_cov_dif != "-", color = "#FF7C80") %>%
  highlight(., j = "park_richness_dif", i = ~str_detect(park_richness_dif, "^-$", negate = T), color = "#FF7C80") %>%
  highlight(., j = "park_richness_dif", i = ~str_detect(park_richness_dif, "\\+"), color = "#84E084") %>%
  highlight(., j = "unique_species_dif", i = ~str_detect(unique_species_dif, "^-$", negate = T), color = "#FF7C80") %>%
  highlight(., j = "unique_species_dif", i = ~str_detect(unique_species_dif, "\\+"), color = "#84E084") %>%
  padding(., padding.top = 3, padding.bottom = 3, part = "body") %>%
   add_header_lines(., values = c("Table 2. Trends in average total plot cover, total park-level species richness, and count of unique species between the first and last sampling event at each park.")) %>%
  align(., i = 1, align = "left", part = "header") %>%
  set_table_properties(., width = 0.5, layout = "autofit") 
```

##### *3.1.1* Total Cover & Species Richness: ASIS
|       At ASIS, average total plot cover across the entire study period was `r total_cover_results$avg_total_cover$ASIS`. Average total plot cover at ASIS declined from `r total_cover_results$total_cover_difs$ASIS %>% pull(max)` in 2008 to `r total_cover_results$total_cover_difs$ASIS %>% pull(min)` in 2018 (Table 2, Figure 2a). A total of `r species_richness_results$total_richness$ASIS` species were identified across the entire study period at ASIS. Seven species were found in at least one plot during every sampling event as ASIS, including *Distichlis spicata*, *Iva frutescens*, *Juncus gerardii*, *Limonium carolinianum*, *Salicornia maritima*, *Spartina alterniflora*, and *Spartina patens*. Similarly, there were `r species_richness_results$total_unique$ASIS` species that were unique to ASIS, including *Andropogon virginicus*, an unidentified *Aster* species, *Dichanthelium acuminatum var. fasciculatum*, an unidentified *Eragrostis* species, *Festuca rubra*, *Mitchella repens*, and *Pinus taeda*. Total park-level species richness at ASIS declined from `r species_richness_results$park_richness_difs %>% filter(UnitCode == "ASIS") %>% pull(max)` in 2008 to `r species_richness_results$park_richness_difs %>% filter(UnitCode == "ASIS") %>% pull(min)`in 2018, whereas the count of unique species remained unchanged (Table 2, Figure 3a). A list of all species found at ASIS is shown in Appendix 3a.

##### *3.1.2* Total Cover & Species Richness: COLO
|       At COLO, average total plot cover across the entire study period was `r total_cover_results$avg_total_cover$COLO`. Average total plot cover at COLO declined from `r total_cover_results$total_cover_difs$COLO %>% pull(max)` in 2008 to `r total_cover_results$total_cover_difs$COLO %>% pull(min)` in 2016 (Table 2, Figure 2b). A total of `r species_richness_results$total_richness$COLO` species were identified across the entire study period at COLO. Five species were found in at least one plot during every sampling event as COLO, including *Peltandra virginica*, *Phragmites australis*, *Schoenoplectus robustus*, *Spartina cynosuroides*, and *Typha angustifolia*. Additionally, there were `r species_richness_results$total_unique$COLO` species that were unique to COLO, including *Apios americana*, *Carex hyalinolepsis*, *Carex lurida*, *Eleocharis parvula*, an unidentified *Hydrocotyle* species, *Juncus tenuis*, an unidentified *Leersia* species, *Lilaeopsis chinensis*, an unidentified *Lycopus* species, *Najas minor*, *Osmunda regalis*, *Persea borbonia*, *Phyla lanceolata*, an unidentified *Polygonum* species, *Polygonum persicaria*, *Pontedaria cordata*, *Sagittaria lancifolia*, *Sagittaria subulata*, *Schoenoplectus tabernaemontani*, *Taxodium distichum*, an unidentified *Typha* species, an unidentified *Vitis* species, and *Zizaniopsis miliacea*. Total park-level species richness at COLO increased from `r species_richness_results$park_richness_difs %>% filter(UnitCode == "COLO") %>% pull(min)` in 2008 to `r species_richness_results$park_richness_difs %>% filter(UnitCode == "COLO") %>% pull(max)`in 2016 (Table 2, Figure 3b). Similarly, the count of unique species also increased from `r species_richness_results$unique_species_difs %>% filter(UnitCode == "COLO") %>% pull(min)` in 2008 to `r species_richness_results$unique_species_difs %>% filter(UnitCode == "COLO") %>% pull(max)` in 2016 (Table 2, Figure 3b). A list of all species found at COLO is shown in Appendix 3b.

##### *3.1.3* Total Cover & Species Richness: FIIS
|       At FIIS, average total plot cover across the entire study period was `r total_cover_results$avg_total_cover$FIIS`. Average total plot cover at FIIS declined from `r total_cover_results$total_cover_difs$FIIS %>% pull(max)` in 2009 to `r total_cover_results$total_cover_difs$FIIS %>% pull(min)` in 2017 (Table 2, Figure 2c). A total of `r species_richness_results$total_richness$FIIS` species were identified across the entire study period at FIIS. Eleven species were found in at least one plot during every sampling event as FIIS, including *Baccharis halimifolia*, *Distichlis spicata*, *Iva frutescens*, *Juncus gerardii*, *Limonium carolinianum*, *Phragmites australis*, *Solidago sempervirens*, *Spartina alterniflora*, *Spartina patens*, *Teucrium canadense*, and *Toxicodendron radicans*. Similarly, there were `r species_richness_results$total_unique$FIIS` species that were unique to FIIS, including *Bassia hirsuta* an unidentified *Cuscuta* species, *Elaeagnus umbellata*, an unidentified *Hibiscus* species, *Juncus canadensis*, an unidentified *Lepidium* species, an unidentified *Panicum* species, *Polygonum perforliatum*, *Quercus velutina*, an unidentified *Rosa* species, an unidentified *Rubus* species, an unidentified *Scirpus* species, *Solidago rugosa*, *Symphyotrichum tenuifolium*, and *Triadenum virginicum*. Total park-level species richness at FIIS remained unchanged across the entire study period (Table 2, Figure 3c). However, the count of unique species decreased from `r species_richness_results$unique_species_difs %>% filter(UnitCode == "FIIS") %>% pull(max)` in 2009 to `r species_richness_results$unique_species_difs %>% filter(UnitCode == "FIIS") %>% pull(min)` in 2017 (Table 2, Figure 3c). A list of all species found at FIIS is shown in Appendix 3c.

##### *3.1.4* Total Cover & Species Richness: GATE
|       At GATE, average total plot cover across the entire study period was `r total_cover_results$avg_total_cover$GATE`. Average total plot cover at GATE declined from `r total_cover_results$total_cover_difs$GATE %>% pull(max)` in 2010 to `r total_cover_results$total_cover_difs$GATE %>% pull(min)` in 2018 (Table 2, Figure 2d). A total of `r species_richness_results$total_richness$GATE` species were identified across the entire study period at GATE. Nine species were found in at least one plot during every sampling event as GATE, including *Ammophila breviligulata*, *Atriplex patula*, *Cakile edentula*, *Iva frutescens*, *Limonium carolinianum*, *Salicornia maritima*, *Solidago sempervirens*, *Spartina alterniflora*, and *Spartina patens*. Similarly, there were `r species_richness_results$total_unique$GATE` species that were unique to GATE, including *Acalypha rhomboidea*, *Ageratina altissima*, *Amelanchier canadensis*, an unidentified *Bassia* species, *Bidens bipinnata*, an unidentified *Bromus* species, *Carex kobomugi*, *Celtis occidentalis*, *Cenchrus longispinus*, *Cenchrus longispinus*, *Cenchrus tribuloides*, *Centaurea melitensis*, *Chamaesyce polygonifolia*, an unidentified *Digitaria* species, an unidentified *Ipomoea* species, *Lepidium virginicum*, *Lonicera japonica*, an unidentified *Melilotus* species, *Mirabilis nyctaginea*, *Myrica gale*, *Opuntia humifusa*, *Pseudognaphalium obtusifolium*, *Rhus copallinum var. latifolia*, *Rosa rugosa*, *Rubus pensilvanicus*, *Rubus phoenicolasius*, *Salsola kali*, *Solanum nigrum*, an unidentified *Solidago* species, *Suaeda linearis*, and *Xanthium strumarium*. Total park-level species richness at GATE increased from `r species_richness_results$park_richness_difs %>% filter(UnitCode == "GATE") %>% pull(min)` in 2010 to `r species_richness_results$park_richness_difs %>% filter(UnitCode == "GATE") %>% pull(max)`in 2018 (Table 2, Figure 3d). Similarly, the count of unique species also increased from `r species_richness_results$unique_species_difs %>% filter(UnitCode == "GATE") %>% pull(min)` in 2010 to `r species_richness_results$unique_species_difs %>% filter(UnitCode == "GATE") %>% pull(max)` in 2018 (Table 2, Figure 3d). A list of all species found at GATE is shown in Appendix 3d.

##### *3.1.5* Total Cover & Species Richness: GEWA
|       At GEWA, average total plot cover across the entire study period was `r total_cover_results$avg_total_cover$GEWA`. Average total plot cover at GEWA declined from `r total_cover_results$total_cover_difs$GEWA %>% pull(max)` in 2008 to `r total_cover_results$total_cover_difs$GEWA %>% pull(min)` in 2012 (Table 2, Figure 2e). A total of `r species_richness_results$total_richness$GEWA` species were identified across the entire study period at GEWA. Eleven species were found in at least one plot during every sampling event as GEWA, including *Amaranthus cannabinus*, *Atriplex patula*, *Distichlis spicata*, *Hibiscus moscheutos*, *Kosteletzkya virginica*, *Lythrum lineare*, *Polygonum punctatum*, *Schoenoplectus robustus*, *Spartina cynosuroides*, *Typha angustifolia*, and *Zizania aquatica*. Similarly, there were `r species_richness_results$total_unique$GEWA` species that were unique to GEWA, including *Alnus serrulata*, *Boehmeria cylindrica*, an unidentified *Cyperus* species, *Decodon verticillatus*, an unidentified *Galium* species, *Impatiens capensis*, *Onoclea sensibilis*, *Phalaris arundinacea*, *Polygonum arifolium*, *Polygonum sagittatum*, *Quercus phellos*, an unidentified *Rumex* species, and *Saururus cernuus*. Total park-level species richness at GEWA decreased from `r species_richness_results$park_richness_difs %>% filter(UnitCode == "GEWA") %>% pull(max)` in 2008 to `r species_richness_results$park_richness_difs %>% filter(UnitCode == "GEWA") %>% pull(max)`in 2012 (Table 2, Figure 3e). Similarly, the count of unique species also decreased from `r species_richness_results$unique_species_difs %>% filter(UnitCode == "GEWA") %>% pull(max)` in 2008 to `r species_richness_results$unique_species_difs %>% filter(UnitCode == "GATE") %>% pull(min)` in 2012 (Table 2, Figure 3e). A list of all species found at GEWA is shown in Appendix 3e.

##### *3.1.6* Total Cover & Species Richness: SAHI
|       At SAHI, average total plot cover across the entire study period was `r total_cover_results$avg_total_cover$SAHI`. Average total plot cover at SAHI remained unchanged across the entire study period (2009 to 2017) (Table 2, Figure 2f). A total of `r species_richness_results$total_richness$SAHI` species were identified across the entire study period at SAHI. Five species were found in at least one plot during every sampling event as SAHI, including *Atriplex cristata*, *Distichlis spicata*, *Limonium carolinianum*, *Spartina alterniflora*, and *Spartina patens*. Similarly, there were `r species_richness_results$total_unique$SAHI` species that were unique to SAHI, including *Lechea maritima*, *Panicum amarum*, and *Suaeda calceoliformis*. Total park-level species richness and the count of unique species at SAHI remained unchanged between 2009 to 2017 (Table 2, Figure 3f). A list of all species found at SAHI is shown in Appendix 3f.

```{r Figure 2, echo=FALSE, message=FALSE, warning=FALSE, fig.height=5, fig.width=6.5, out.height=5, out.width=6.5}
ggdraw(total_cover_df %>%
         mutate(Year = as.Date(paste0(Year_chr, "-01-01"))) %>%
         ggplot(., aes(x = Year, y = mean_year_total_cover, color = UnitCode)) +
         geom_line(data = total_cover_results$plot_betas, aes(x = Year, y = mean_year_total_cover), color = "black", size = 0.7) +
         geom_line(show.legend = F) +
         geom_errorbar(aes(ymin = mean_year_total_cover - se_year_total_cover, ymax = mean_year_total_cover + se_year_total_cover), color = "black") +
         geom_point(aes(fill = UnitCode), show.legend = F, shape = 21, color = "black", size = 2) +
         geom_text(data = . %>%
                     ungroup() %>%
                     distinct(UnitCode) %>%
                     mutate(letter = paste0("(",LETTERS[1:n()], ")"),
                            f = pmap_chr(list(letter, UnitCode), function(a, b) deparse(bquote(bold(.(a)~plain(.(b))))))),
                   aes(x = structure(-Inf, class = "Date"), y =  Inf, label = f),
                   hjust = -0.2, vjust = 2, size  = 3.5, fontface = "bold", family = "serif", parse = T, inherit.aes = F) +
         geom_text(data = total_cover_results$total_cov_mods, 
                   aes(x = structure(-Inf, class = "Date"), y = Inf, label = change_cover_lab), 
                   hjust = -0.05, vjust = 3.95, size = 3.5, family = "serif", inherit.aes = F) +
         geom_text(data = total_cover_results$total_cov_mods %>%
                     mutate(f = map_chr(r2_lab, function(x) deparse(bquote(italic(.("r")^plain("2")~plain(.("="))~plain(.(x))))))),
                   aes(x = structure(-Inf, class = "Date"), y = Inf, label = f),
                   hjust = -0.2, vjust = 4, size = 3.5, family = "serif", parse = T, inherit.aes = F) +
         scale_color_manual(values = park_pal) +
         scale_fill_manual(values = park_pal) +
         lemon::facet_rep_wrap(~UnitCode, scales = "free_x") +
         scale_y_continuous(limits = c(0,160), breaks = seq(0,150, by = 25), labels = c("0", "", "50", "", "100", "", "150"), name = "Average total plot cover (%)", sec.axis = dup_axis()) +
         ggh4x::facetted_pos_scales(x = total_cover_results$plot_lims) +
         labs(caption = bquote(bold("Figure 2.")~"Average total plot cover at each park.")) +
         lfeheR::theme(base_size = 12) +
         theme(
           text = element_text(family = "serif", size = 12),
           legend.position = "none",
           axis.title.y = element_text(margin = margin(r = 10, unit = "pt")),
           panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
           strip.text = element_blank(),
           plot.caption = element_text(size = 12, hjust = -0.1, color = "transparent")
         ),
       ylim = c(-0.15,1)) +
  draw_label(bquote(bold("Figure 2.")~"Average total plot cover (%) at each park. Black lines in panels B and C represent the rate"), fontfamily = "serif", x = 0.02, y = 0.04, size = 12, hjust = 0) +
  draw_label(bquote(plain("of change in average total plot cover at COLO and FIIS, respectively. The rate of change in average")), fontfamily = "serif", x = 0.02, y = -0.01, size = 12, hjust = 0) +
  draw_label(bquote(plain("total plot cover was either not significant (i.e., rate of change = 0 %/yr) for ASIS, GATE, and SAHI,")), fontfamily = "serif", x = 0.02, y = -0.06, size = 12, hjust = 0) +
  draw_label(bquote(plain("or, in the case of GEWA, could not be estimated since there were only 3 sampling events.")), fontfamily = "serif", x = 0.02, y = -0.11, size = 12, hjust = 0) 
```
&nbsp;

```{r Fig 3, echo=FALSE, message=TRUE, warning=TRUE, fig.height=5, fig.width=6.5, out.height=5, out.width=6.5}
ggdraw(species_richness_dfs$park_species_richness_per_yr %>%
         left_join(., species_richness_dfs$park_unique_species_count_per_year, by = c("UnitCode", "Year_chr")) %>%
         pivot_longer(., cols = c(total_richness, n_unique), names_to = "richness_metric", values_to = "richness") %>%
         mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
                richness = if_else(is.na(richness), 0, richness)) %>%
         ungroup() %>%
         ggplot(., aes(x = Year, y = richness, color = UnitCode, fill = UnitCode, group = richness_metric)) +
         geom_line(data = species_richness_results$plot_betas, aes(x = Year, y = richness), color = "black", size = 0.7) +
         geom_line(show.legend = F) +
         geom_point(aes(shape = richness_metric), show.legend = T, size = 2, color = "black") +
         geom_text(data = . %>% 
                     ungroup() %>% 
                     distinct(UnitCode) %>%
                     mutate(letter = paste0("(",LETTERS[1:n()], ")"),
                            f = pmap_chr(list(letter, UnitCode), function(a, b) deparse(bquote(bold(.(a)~plain(.(b))))))),
                   aes(x = structure(-Inf, class = "Date"), y =  Inf, label = f),
                   hjust = -0.2, vjust = 1.5, size  = 3.5, fontface = "bold", family = "serif", parse = T, inherit.aes = F) +
         geom_text(data = species_richness_results$species_richness_mods, 
                   aes(x = structure(-Inf, class = "Date"), y = Inf, label = change_richness_lab), 
                   hjust = -0.05, vjust = 3.95, size = 3.5, family = "serif", inherit.aes = F) +
         geom_text(data = species_richness_results$species_richness_mods %>%
                     mutate(f = map_chr(r2_lab, function(x) deparse(bquote(italic(.("r")^plain("2")~plain(.("="))~plain(.(x))))))),
                   aes(x = structure(-Inf, class = "Date"), y = Inf, label = f),
                   hjust = -0.2, vjust = 4, size = 3.5, family = "serif", parse = T, inherit.aes = F) +
         scale_color_manual(values = park_pal) +
         scale_fill_manual(values = park_pal) +
         scale_shape_manual(values = c(21, 23), breaks = c("total_richness", "n_unique"), labels = c("Total park-level species richness   ", "Unique species count")) +
         lemon::facet_rep_wrap(~UnitCode, scales = "free_x", repeat.tick.labels = F) +
         scale_y_continuous(limits = c(0,55), name = "Park-level species richness (n)", labels = function(x) sprintf("%0.0f", x), sec.axis = dup_axis()) +
         scale_x_date(date_labels = "'%y", sec.axis = dup_axis()) +
         ggh4x::facetted_pos_scales(x = species_richness_results$plot_lims) +
         guides(color = "none", fill = "none") +
         labs(caption = bquote(bold("Figure 3.")~"Park-level species richness (circle points) and count of species unique to each park (diamond points).")) +
         lfeheR::theme(base_size = 12) +
         theme(
           text = element_text(family = "serif", size = 12),
           legend.position = "bottom",
           legend.title = element_blank(),
           legend.key = element_blank(),
           legend.margin = margin(t = -10, unit = "pt"),
           axis.title.y = element_text(margin = margin(r = 10, unit = "pt")),
           panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
           strip.text = element_blank(),
           plot.caption = element_text(size = 12, hjust = 0, color = "transparent")
         ),
       ylim = c(-0.15,1)) +
  draw_label(bquote(bold("Figure 3.")~"Total park-level species richness (circles) and count of species unique to each park."), x = 0.02, y = 0.04, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(" (diamonds). The black line in panel A represents the rate of change in total park-level species"), x = 0.02, y = -0.01, fontfamily = "serif", hjust = 0, size = 12) +
   draw_label(bquote("richness at ASIS. The rate of change in total park-level species richness was not significant (i.e., rate"), fontfamily = "serif", x = 0.02, y = -0.06, size = 12, hjust = 0) +
  draw_label(bquote(plain("of change = 0 sp./yr) for the other 5 parks.")), fontfamily = "serif", x = 0.02, y = -0.11, size = 12, hjust = 0)
```
&nbsp;



##### **3.2** Threatened, Endangered, & Rare Species
```{r TE and Rare species, message=TRUE, warning=TRUE, include=FALSE}
rare_te_species_dfs <- list(
  "fed_te_species_cover" = plot_veg_cover_npspecies %>%
    filter(!is.na(Federal.Listing.Status)),
  
  "state_rare_species_cover" = plot_veg_cover_usda %>%
    ungroup() %>%
    select(UnitCode, Year_chr, SciName_cor, starts_with("rare_")) %>%
    mutate(is_rare = case_when(if_any(starts_with("rare_"), ~ .x == "T") ~ "T")) %>%
    filter(is_rare == "T") %>%
    select(UnitCode, Year_chr, SciName_cor) %>%
    left_join(., perc_cover, by = c("SciName_cor", "UnitCode", "Year_chr")) %>%
    distinct(),
  
  "state_rare_species_frq" = site_veg_frq_usda %>%
    ungroup() %>%
    select(UnitCode, Year_chr, SciName_cor, starts_with("rare")) %>%
    mutate(is_rare = case_when(if_any(starts_with("rare_"), ~ .x == "T") ~ "T")) %>%
    filter(is_rare == "T") %>%
    select(UnitCode, Year_chr, SciName_cor) %>%
    left_join(., frq, by = c("SciName_cor", "UnitCode", "Year_chr")) %>%
    distinct(),
  
  "state_te_species_cover" = plot_veg_cover_npspecies %>% 
    ungroup() %>%
    select(UnitCode, Year_chr, SciName_cor, `State Status`) %>%
    filter(!is.na(`State Status`)) %>%
    distinct() %>%
    add_row(UnitCode = "GATE", Year_chr = "2018", SciName_cor = "Myrica gale", `State Status` = "NJ: R") %>% # add rare species that weren't on NPspecies - Myrica gale is considered rare by NJ but wasn't on the NPspeicies
    left_join(., perc_cover, by = c("SciName_cor", "UnitCode", "Year_chr")) %>%
    distinct(),
  
  "state_te_species_frq" = site_veg_frq_npspecies %>%
    ungroup() %>%
    select(UnitCode, Year_chr, SciName_cor, `State Status`) %>%
    filter(!is.na(`State Status`)) %>%
    distinct() %>%
    add_row(UnitCode = "GATE", Year_chr = "2018", SciName_cor = "Myrica gale", `State Status` = "NJ: R") %>% # add rare species that weren't on NPspecies - Myrica gale is considered rare by NJ but wasn't on the NPspeicies
    left_join(., frq, by = c("SciName_cor", "UnitCode", "Year_chr")) %>%
    distinct()
)

rare_te_species_results <- list(
  "state_te_species_count" = rare_te_species_dfs$state_te_species_cover %>%
    select(SciName_cor) %>%
    n_distinct(),
  
  "single_year_cover" = rare_te_species_dfs$state_te_species_cover %>%
    group_by(UnitCode, SciName_cor) %>%
    filter(n() == 1) %>%
    ungroup() %>% 
    mutate(Year = as.integer(Year_chr)) %>% 
    mutate(format_mean_cover = if_else(round(mean_cover,1) < 0.1, format(round(mean_cover,2), nsmall = 2), format(round(mean_cover,1), nsmall = 1)),
           format_se_cover = if_else(round(se_cover,1) < 0.1, format(round(se_cover,2), nsmall = 2), format(round(se_cover,1), nsmall = 1)),
           mean_se_cover = paste0(format_mean_cover, " ± ", format_se_cover, "%"),
           Year_chr = paste0("a_", Year_chr),
           SciName_cor = janitor::make_clean_names(SciName_cor, allow_dupes = TRUE)) %>%
    select(UnitCode, Year_chr, SciName_cor, mean_se_cover) %>%
    super_split(UnitCode, Year_chr, SciName_cor),
  
  "single_year_frq" = rare_te_species_dfs$state_te_species_frq %>%
    group_by(UnitCode, SciName_cor) %>%
    filter(n() == 1) %>%
    ungroup() %>%
    mutate(Year = as.integer(Year_chr)) %>%
    mutate(format_mean_frq = if_else(round(mean_frq,2) < 0.01, format(round(mean_frq,3), nsmall = 3), format(round(mean_frq,2), nsmall = 2)),
           format_se_frq = if_else(round(se_frq,2) < 0.01, format(round(se_frq,3), nsmall = 3), format(round(se_frq,2), nsmall = 2)),
           mean_se_frq = paste0(format_mean_frq, " ± ", format_se_frq),
           Year_chr = paste0("a_", Year_chr),
           SciName_cor = janitor::make_clean_names(SciName_cor, allow_dupes = TRUE)) %>%
    select(UnitCode, Year_chr, SciName_cor, mean_se_frq) %>%
    super_split(UnitCode, Year_chr, SciName_cor),
  
  "state_te_species_cover_mods" = perc_cover_site %>%
    right_join(., plot_veg_cover_npspecies %>% 
                 ungroup() %>%
                 select(UnitCode, Year_chr, SciName_cor, `State Status`) %>%
                 filter(!is.na(`State Status`)) %>%
                 distinct(),
               by = c("UnitCode", "Year_chr", "SciName_cor"), relationship = "many-to-one") %>%
    group_by(UnitCode) %>%
    mutate(year = as.numeric(Year_chr),
           year_num = as.numeric(year-first(year)),
           beta_mean_site_cover = mean_site_cover/100) %>%
    group_by(UnitCode, SciName_cor) %>%
    mutate(n_years = n_distinct(Year_chr)) %>%
    filter(n_years > 2) %>%
    filter(UnitCode != "GEWA") %>%
    nest() %>%
    mutate(beta_mod = map(data, ~betareg(beta_mean_site_cover ~ year_num, data = .x, link = "loglog")),
           summary_mod = map(beta_mod, ~summary(.x)),
           pval = map_dbl(summary_mod, ~.x$coefficients[[1]][[8]])) %>%
    filter(pval < 0.05),
  
  "state_te_species_frq_mods" = site_veg_frq_npspecies  %>%
    filter(!is.na(`State Status`)) %>%
    group_by(UnitCode) %>%
    mutate(year = as.numeric(Year_chr),
           year_num = as.numeric(year-min(year))) %>%
    group_by(UnitCode, SciName_cor) %>%
    mutate(n_years = n_distinct(Year_chr)) %>%
    filter(n_years > 2) %>%
    filter(UnitCode != "GEWA") %>%
    nest() %>%
    mutate(beta_mod = map(data, ~betareg(frq ~ year_num, data = .x, link = "loglog")),
           summary_mod = map(beta_mod, ~summary(.x)),
           pval = map_dbl(summary_mod, ~.x$coefficients[[1]][[8]])) %>%
    filter(pval < 0.05) %>%
    mutate(int = map_dbl(summary_mod, ~.x$coefficients[[1]][[1]]),
           b1 =  map_dbl(summary_mod, ~.x$coefficients[[1]][[2]]),
           b1_se = map_dbl(summary_mod, ~.x$coefficients[[1]][[4]]), 
           change_frq = map2_dbl(int, b1, ~plogis(.x + .y) - plogis(.x)),
           change_frq_se = map2_dbl(int, b1_se, ~plogis(.x + .y) - plogis(.x)),
           r2 = map_dbl(summary_mod, ~.x$pseudo.r.squared),
           change_frq_lab = if_else(change_frq < -0.01,
                                    paste0(format(round(change_frq,2), nsmall = 2), " % of plots/yr"),
                                    paste0(format(round(change_frq,3), nsmall = 3), " % of plots/yr")),
           change_frq_lab_sp = if_else(SciName_cor == "Limonium carolinianum", 
                                       paste0("LICA: ", change_frq_lab), 
                                       paste0("PAAM: ", change_frq_lab)),
           r2_lab = format(round(r2, 2), nsmall = 2)
           ),
  
  "plot_betas" = site_veg_frq_npspecies  %>%
    filter(!is.na(`State Status`)) %>%
    group_by(UnitCode) %>%
    mutate(year = as.numeric(Year_chr),
           year_num = as.numeric(year-min(year))) %>%
    group_by(UnitCode, SciName_cor) %>%
    mutate(n_years = n_distinct(Year_chr)) %>%
    filter(n_years > 2) %>%
    filter(UnitCode != "GEWA") %>%
    nest() %>%
    mutate(beta_mod = map(data, ~betareg(frq ~ year_num, data = .x, link = "loglog")),
           summary_mod = map(beta_mod, ~summary(.x)),
           pval = map_dbl(summary_mod, ~.x$coefficients[[1]][[8]])) %>%
    filter(pval < 0.05) %>%
    mutate(int = map_dbl(summary_mod, ~.x$coefficients[[1]][[1]]),
           b1 =  map_dbl(summary_mod, ~.x$coefficients[[1]][[2]]),
           b1_se = map_dbl(summary_mod, ~.x$coefficients[[1]][[4]]),
           change_frq = map2_dbl(int, b1, ~plogis(.x + .y) - plogis(.x)),
           min_date = map(data, ~as.Date(paste0(min(.x$year), "-01-01"))-(0.4*365.25)),
           min_date_num = map(data, ~min(.x$year_num)-(1)),
           max_date_num = map(data, ~max(.x$year_num)+(2)),
           nd = map2(min_date_num, max_date_num, ~data.frame("year_num" = seq(.x, .y, by = 0.5))),
           pred = map2(beta_mod, nd, ~data.frame(bind_cols(nd, "frq" = predict(.x, newdata = .y))))
           ) %>%
    select(UnitCode, SciName_cor, pred, min_date, min_date_num, max_date_num) %>%
    unnest(cols = c(pred, min_date, min_date_num, max_date_num)) %>%
    mutate(Year = as.Date(min_date) + (year_num*365.25)),
  
  "plot_lims" = list(
    scale_x_date(limits = c(as.Date("2008-01-01"), as.Date("2018-01-01")), expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y"),
    scale_x_date(limits = c(as.Date("2008-01-01"), as.Date("2018-01-01")), expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y"),
    scale_x_date(limits = c(as.Date("2008-01-01"), as.Date("2018-01-01")), expand = c(0, 0), sec.axis = dup_axis(), date_labels = "'%y")
  )
)
```

|       None of the species found at any of the parks were considered federally threatened or endangered as of December 2024 (Department of the Interior, Fish and Wildlife Service, 50 CFR Part 17, Docket No. FWS-HQ-ES-2023-0018; FXES1113090FEDR-245-FF09E23000, RIN 1018-BF88). A total of `r rare_te_species_results$state_te_species_count` species were considered threatened or endangered at the state level. None of the species found at either ASIS, COLO, or GEWA were considered threatened or endangered at the state level. Of the species found at either FIIS, GATE, or SAHI, *Cenchrus tribuloides* and *Salicornia bigelovii* were considered threatened, *Suaeda linearis* was considered endangered, *Limonium carolinianum*, *Opuntia humifusa*, and *Thelypteris palustris* were considered vulnerable, and *Panicum amarum* were considered rare by the State of New York. One species, *Myrica gale*, was considered rare by the State of New Jersey. 

###### *3.2.1* Threatened, Endangered, & Rare Species: FIIS
|       At FIIS, one species, *Salicornia bigelovii* was found in only a single plot in 2009 and was not found again in any other years (mean average cover: `r rare_te_species_results$single_year_cover$FIIS$a_2011$salicornia_bigelovii$mean_se_cover`, mean frequency: `r rare_te_species_results$single_year_frq$FIIS$a_2011$salicornia_bigelovii$mean_se_frq`). *Limonium carolinianum* was found during every sampling event at FIIS, and both mean average cover and frequency varied little between sampling events (Figure 4a and 4d). Similarly, the mean average cover and frequency of *Thelypteris palustris* remained relatively unchanged between 2009 and 2011 and the species was not found again in any other years (Figure 4a and 4d).

###### *3.2.2* Threatened, Endangered, & Rare Species: GATE
|       At GATE, three species were found in only a single plot in 2018 and were not found again in any other years: *Cenchrus tribuloides* (mean average cover: `r rare_te_species_results$single_year_cover$GATE$a_2018$cenchrus_tribuloides$mean_se_cover`, mean frequency: `r rare_te_species_results$single_year_frq$GATE$a_2018$cenchrus_tribuloides$mean_se_frq`), *Myrica gale* (mean average cover: `r rare_te_species_results$single_year_cover$GATE$a_2018$myrica_gale$mean_se_cover`, mean frequency: `r rare_te_species_results$single_year_frq$GATE$a_2018$myrica_gale$mean_se_frq`), and *Opuntia humifusa* (mean average cover: `r rare_te_species_results$single_year_cover$GATE$a_2018$opuntia_humifusa$mean_se_cover`, mean frequency: `r rare_te_species_results$single_year_frq$GATE$a_2018$opuntia_humifusa$mean_se_frq`). One species, *Suaeda linearis* (mean average cover: `r rare_te_species_results$single_year_cover$GATE$a_2010$suaeda_linearis$mean_se_cover`, mean frequency: `r rare_te_species_results$single_year_frq$GATE$a_2010$suaeda_linearis$mean_se_frq`), was found in 10 plots at GATE in 2010, but was not found again in any other years. *Limonium carolinianum* was found during every sampling event at GATE, and both mean average cover and frequency varied little between sampling events (Figure 4b and 4e). Similarly, the mean average cover and frequency of *Salicornia bigelovii* remained relatively unchanged between 2010 and 2012 and the species was not found again in any other years (Figure 4b and 4e).

###### *3.2.3* Threatened, Endangered, & Rare Species: SAHI
|       At SAHI, *Limonium carolinianum* was found during every sampling event at SAHI. Although the mean average cover of *Limonium carolinianum* at SAHI remained largely unchanged, the mean frequency of the species decreased between 2009 to 2017 (Figure 4c and 4f). Additionally, *Panicum amarum* was found at SAHI in 2009, 2015, and 2017, although the mean average cover and frequency varied little between years (Figure 4c and 4f).

```{r State TE species plot, echo=FALSE, fig.height=5, fig.width=6.5, message=FALSE, warning=FALSE, out.height=5, out.width=6.5}
rare_te_cover_plot <- rare_te_species_dfs$state_te_species_cover %>%
      mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
             SciName_lab = paste0(SciName_cor, "   ")) %>%
      group_by(UnitCode, SciName_cor) %>%
      mutate(n_years = n_distinct(Year_chr)) %>%
      filter(n_years > 1) %>%
  arrange(UnitCode) %>%
      ggplot(., aes(x = Year, y = mean_cover)) +
      geom_errorbar(aes(ymin = mean_cover - se_cover, ymax = mean_cover + se_cover, group = SciName_lab), color = "black", width = 100) +
      geom_line(aes(color = SciName_lab)) +
      geom_point(aes(fill = SciName_lab), shape = 21, size = 2, color = "black") +
      geom_text(data = . %>%
                  ungroup() %>%
                  distinct(UnitCode) %>%
                  mutate(letter = paste0("(",LETTERS[1:n()], ")"),
                         f = pmap_chr(list(letter, UnitCode), function(a, b) deparse(bquote(bold(.(a)~plain(.(b))))))),
                aes(x = structure(-Inf, class = "Date"), y =  Inf, label = f),
                hjust = -0.2, vjust = 1.5, size  = 3.5, fontface = "bold", family = "serif", parse = T, inherit.aes = F) +
      lemon::facet_rep_wrap(~UnitCode, repeat.tick.labels = T) +
      scale_y_continuous(limits = c(0,8.5), name = "Cover of state-level\nT&E species (%)", sec.axis = dup_axis()) +
      ggh4x::facetted_pos_scales(x = rare_te_species_results$plot_lims) +
      guides(color = guide_legend(title = "Species:"), fill = guide_legend(title = "Species:")) +
      lfeheR::theme(base_size = 12) +
      theme(
        text = element_text(family = "serif", size = 12),
        axis.title.y.left = element_text(margin = margin(0,10,0,0,"pt")),
        axis.title.x.bottom = element_blank(),
        legend.key = element_rect(color = "transparent"),
        legend.text = element_text(face = "italic"),
        legend.direction = "horizontal",
        panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
        strip.background = element_blank(),
        strip.text = element_blank()
      )

rare_te_frq_plot <- rare_te_species_dfs$state_te_species_frq %>%
  mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
         SciName_lab = paste0(SciName_cor, "   ")) %>%
  group_by(UnitCode, SciName_cor) %>%
  mutate(n_years = n_distinct(Year_chr)) %>%
  filter(n_years > 1) %>%
  arrange(UnitCode) %>%
  ggplot(., aes(x = Year, y = mean_frq)) +
  geom_line(data = rare_te_species_results$plot_betas %>% 
              mutate(SciName_lab = paste0(SciName_cor, "   ")), 
            aes(x = Year, y = frq, group = SciName_lab), color = "black", size = 0.7)+
  geom_errorbar(aes(ymin = mean_frq - se_frq, ymax = mean_frq + se_frq, group = SciName_lab), color = "black", width = 100) +
  geom_line(aes(color = SciName_lab)) +
  geom_point(aes(fill = SciName_lab), shape = 21, size = 2, color = "black") +
  geom_text(data = . %>%
              ungroup() %>%
              distinct(UnitCode) %>%
              mutate(letter = paste0("(",LETTERS[4:6], ")"),
                     f = pmap_chr(list(letter, UnitCode), function(a, b) deparse(bquote(bold(.(a)~plain(.(b))))))),
            aes(x = structure(-Inf, class = "Date"), y =  Inf, label = f),
            hjust = -0.2, vjust = 1.5, size  = 3.5, fontface = "bold", family = "serif", parse = T, inherit.aes = F) +
  geom_text(data = rare_te_species_results$state_te_species_frq_mods %>%
              filter(SciName_cor == "Limonium carolinianum"), 
            aes(x = structure(-Inf, class = "Date"), y = Inf, label = change_frq_lab_sp), 
            hjust = -0.05, vjust = 3.25, size = 3.5, family = "serif", inherit.aes = F) +
  geom_text(data = rare_te_species_results$state_te_species_frq_mods %>%
              filter(SciName_cor == "Panicum amarum"), 
            aes(x = structure(-Inf, class = "Date"), y = Inf, label = change_frq_lab_sp), 
            hjust = -0.05, vjust = 4.75, size = 3.5, family = "serif", inherit.aes = F) +
  lemon::facet_rep_wrap(~UnitCode, repeat.tick.labels = T) +
  scale_y_continuous(limits = c(0, 0.32), breaks = seq(0,0.3, by = 0.1), name = "Frequency of state-\nlevel T&E species", sec.axis = dup_axis()) +
  ggh4x::facetted_pos_scales(x = rare_te_species_results$plot_lims) +
  guides(color = guide_legend(title = "Species:"), fill = guide_legend(title = "Species:")) +
  lfeheR::theme(base_size = 12) +
  theme(
    text = element_text(family = "serif", size = 12),
    axis.title.x.bottom = element_blank(),
    axis.title.y.left = element_text(margin = margin(0,10,0,0,"pt")),
    legend.key = element_rect(color = "transparent"),
    legend.text = element_text(face = "italic"),
    legend.direction = "horizontal",
    panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
    strip.background = element_blank(),
    strip.text = element_blank()
  )

rare_te_legend <- get_legend(
  ggplot(plot_veg_cover_usda %>% filter(SciName_cor %in% c("Limonium carolinianum", "Panicum amarum", "Salicornia bigelovii", "Thelypteris palustris")), aes(x = Year_chr, y = PercentCover), group = SciName_cor) +
    geom_line(aes(color = SciName_cor)) +
    geom_point(aes(fill = SciName_cor), shape = 21, size = 2, color = "black") +
    guides(color = guide_legend(title = "Species:", nrow = 2), fill = guide_legend(title = "Species:", nrow = 2)) +
    lfeheR::theme(base_size = 12) +
    theme(
      text = element_text(family = "serif", size = 12),
      legend.key = element_rect(color = "transparent"),
      legend.key.spacing.y = unit(0,"cm"),
      legend.text = element_text(face = "italic"),
      legend.direction = "horizontal",
      legend.background = element_rect(fill = "transparent")
    )
)

ggdraw() +
  draw_plot(plot_grid(rare_te_cover_plot + theme(legend.position = "none"), rare_te_frq_plot + theme(legend.position = "none"), nrow = 2, align = "vh"), y = 0.36, height = 0.64) +
  draw_label("Year", x = 0.525, y = 0.34, fontfamily = "serif", size = 12, hjust = 0) +
  draw_plot(rare_te_legend, y = -0.23, height = 1) +
  draw_label(bquote(bold("Figure 4.")~"Mean average cover (a, b, and c) and frequency (d, e, and f) of state-level threatened and"), x = 0.02, y = 0.19, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote("endangered species at FIIS, GATE, and SAHI. Black lines in panel F represent the rate of change in"), x = 0.02, y = 0.15, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote("average frequency of"~italic(.("Limonium Carolinianum"))~"(LICA) and"~italic(.("Panicum amarum"))~"(PAAM) at SAHI."), x = 0.02, y = 0.11, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote("For the other 5 parks, the rate of change in average cover or frequency was either not significant"), x = 0.02, y = 0.07, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote("(i.e., rate of change = 0) or could not be estimated since there were less than 3 sampling events."), x = 0.02, y = 0.03, fontfamily = "serif", hjust = 0, size = 12)
```
&nbsp;

##### **3.3** NPSpecies: Highlighted Species
```{r NPSpecies highlighted, message=FALSE, warning=FALSE, include=FALSE}
mang_species_dfs <- list(
  "mang_species_cover" = plot_veg_cover_npspecies %>%
    ungroup() %>%
    select(UnitCode, Year_chr, SciName_cor, `NPS Tags`) %>%
    filter(!is.na(`NPS Tags`)) %>%
    distinct() %>%
    left_join(., perc_cover, by = c("SciName_cor", "UnitCode", "Year_chr")) %>%
    distinct(),
  
  "mang_species_frq" = site_veg_frq_npspecies %>%
    ungroup() %>%
    select(UnitCode, Year_chr, SciName_cor, `NPS Tags`) %>%
    filter(!is.na(`NPS Tags`)) %>%
    distinct() %>%
    left_join(., frq, by = c("SciName_cor", "UnitCode", "Year_chr")) %>%
    distinct()
)

mang_species_results <- list(
  "mang_species_count" = mang_species_dfs$mang_species_cover %>%
    select(SciName_cor) %>%
    n_distinct(),
  
  "single_year_cover" = mang_species_dfs$mang_species_cover %>%
    group_by(UnitCode, SciName_cor) %>%
    filter(n() == 1) %>%
    ungroup() %>% 
    mutate(Year = as.integer(Year_chr)) %>% 
    mutate(format_mean_cover = if_else(round(mean_cover,1) < 0.1, format(round(mean_cover,2), nsmall = 2), format(round(mean_cover,1), nsmall = 1)),
           format_se_cover = if_else(round(se_cover,1) < 0.1, format(round(se_cover,2), nsmall = 2), format(round(se_cover,1), nsmall = 1)),
           mean_se_cover = paste0(format_mean_cover, " ± ", format_se_cover, "%"),
           Year_chr = paste0("a_", Year_chr),
           SciName_cor = janitor::make_clean_names(SciName_cor, allow_dupes = TRUE)) %>%
    select(UnitCode, Year_chr, SciName_cor, mean_se_cover) %>%
    super_split(UnitCode, Year_chr, SciName_cor),
  
  "single_year_frq" = mang_species_dfs$mang_species_frq %>%
    group_by(UnitCode, SciName_cor) %>%
    filter(n() == 1) %>%
    ungroup() %>%
    mutate(Year = as.integer(Year_chr)) %>%
    mutate(format_mean_frq = if_else(round(mean_frq,2) < 0.01, format(round(mean_frq,3), nsmall = 3), format(round(mean_frq,2), nsmall = 2)),
           format_se_frq = if_else(round(se_frq,2) < 0.01, format(round(se_frq,3), nsmall = 3), format(round(se_frq,2), nsmall = 2)),
           mean_se_frq = paste0(format_mean_frq, " ± ", format_se_frq),
           Year_chr = paste0("a_", Year_chr),
           SciName_cor = janitor::make_clean_names(SciName_cor, allow_dupes = TRUE)) %>%
    select(UnitCode, Year_chr, SciName_cor, mean_se_frq) %>%
    super_split(UnitCode, Year_chr, SciName_cor),
  
  "mang_species_frq_mods" = site_veg_frq_npspecies  %>%
    filter(!is.na(`NPS Tags`)) %>%    
    group_by(UnitCode) %>%
    mutate(year = as.numeric(Year_chr),
           year_num = as.numeric(year-min(year))) %>%
    group_by(UnitCode, SciName_cor) %>%
    mutate(n_years = n_distinct(Year_chr)) %>%
    filter(n_years > 2) %>%
    filter(UnitCode != "GEWA") %>%
    nest() %>%
    mutate(beta_mod = map(data, ~betareg(frq ~ year_num, data = .x, link = "loglog")),
           summary_mod = map(beta_mod, ~summary(.x)),
           pval = map_dbl(summary_mod, ~.x$coefficients[[1]][[8]])) %>%
    filter(pval < 0.05) %>%
    mutate(int = map_dbl(summary_mod, ~.x$coefficients[[1]][[1]]),
           b1 =  map_dbl(summary_mod, ~.x$coefficients[[1]][[2]]),
           b1_se = map_dbl(summary_mod, ~.x$coefficients[[1]][[4]]), 
           change_frq = map2_dbl(int, b1, ~plogis(.x + .y) - plogis(.x)),
           change_frq_se = map2_dbl(int, b1_se, ~plogis(.x + .y) - plogis(.x)),
           r2 = map_dbl(summary_mod, ~.x$pseudo.r.squared),
           change_frq_lab = if_else(change_frq < -0.01,
                                    paste0(format(round(change_frq,2), nsmall = 2), " % of plots/yr"),
                                    paste0(format(round(change_frq,3), nsmall = 3), " % of plots/yr")),
           change_frq_lab_sp = if_else(SciName_cor == "Limonium carolinianum", 
                                       paste0("LICA: ", change_frq_lab), 
                                       paste0("PAAM: ", change_frq_lab)),
           r2_lab = format(round(r2, 2), nsmall = 2)
           ),
  
  "plot_betas" = site_veg_frq_npspecies  %>%
    filter(!is.na(`State Status`)) %>%
    group_by(UnitCode) %>%
    mutate(year = as.numeric(Year_chr),
           year_num = as.numeric(year-min(year))) %>%
    group_by(UnitCode, SciName_cor) %>%
    mutate(n_years = n_distinct(Year_chr)) %>%
    filter(n_years > 2) %>%
    filter(UnitCode != "GEWA") %>%
    nest() %>%
    mutate(beta_mod = map(data, ~betareg(frq ~ year_num, data = .x, link = "loglog")),
           summary_mod = map(beta_mod, ~summary(.x)),
           pval = map_dbl(summary_mod, ~.x$coefficients[[1]][[8]])) %>%
    filter(pval < 0.05) %>%
    mutate(int = map_dbl(summary_mod, ~.x$coefficients[[1]][[1]]),
           b1 =  map_dbl(summary_mod, ~.x$coefficients[[1]][[2]]),
           b1_se = map_dbl(summary_mod, ~.x$coefficients[[1]][[4]]),
           change_frq = map2_dbl(int, b1, ~plogis(.x + .y) - plogis(.x)),
           min_date = map(data, ~as.Date(paste0(min(.x$year), "-01-01"))-(0.4*365.25)),
           min_date_num = map(data, ~min(.x$year_num)-(1)),
           max_date_num = map(data, ~max(.x$year_num)+(2)),
           nd = map2(min_date_num, max_date_num, ~data.frame("year_num" = seq(.x, .y, by = 0.5))),
           pred = map2(beta_mod, nd, ~data.frame(bind_cols(nd, "frq" = predict(.x, newdata = .y))))
           ) %>%
    select(UnitCode, SciName_cor, pred, min_date, min_date_num, max_date_num) %>%
    unnest(cols = c(pred, min_date, min_date_num, max_date_num)) %>%
    mutate(Year = as.Date(min_date) + (year_num*365.25)),
  
  "plot_lims" = list(
    scale_x_date(limits = c(as.Date("2008-01-01"), as.Date("2018-01-01")), expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y"),
    scale_x_date(limits = c(as.Date("2008-01-01"), as.Date("2018-01-01")), expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y"),
    scale_x_date(limits = c(as.Date("2008-01-01"), as.Date("2018-01-01")), expand = c(0, 0), sec.axis = dup_axis(), date_labels = "'%y")
  )
)
```

|       A total of `r mang_species_results$mang_species_count` species were highlighted with the tags "management priority" and/or "exploitation concern" in NPSpecies. None of the species found at either ASIS or GEWA were highlighted with these tags. Of the species found at either COLO, FIIS, GATE, or SAHI, *Artemisia vulgaris*, *Cenchrus tribuloides*, *Elaeagnus umbellata*, *Iva frutescens*, *Lonicera japonica*, *Panicum amarum*, *Phragmites australis*, *Salicornia bigelovii*, and *Suaeda linearis* were tagged as "management priority". Additionally, three species, *Limonium carolinianum*, *Morella pensylvanica*, and *Thelypteris palustris* were tagged as both "management priority" and "exploitation concern" for FIIS.

###### *3.3.1* NPSpecies: Highlighted Species: COLO
|       At COLO, only a single species - *Phragmites australis* - was tagged as "management priority". *Phragmites australis* was found in every year at COLO, although the mean average cover and frequency remained low over the entire study period from 2008 to 2016 (Figure 5a and 5e).

###### *3.3.2* NPSpecies: Highlighted Species: FIIS
|       At FIIS, six species were tagged as "management priority" and/or "exploitation concern", including *Elaeagnus umbellata*, *Limonium carolinianum*, *Morella pensylvanica*, *Phragmites australis*, *Salicornia bigelovii*, and *Thelypteris palustris*. *Morella pensylvanica* (mean average cover: `r mang_species_results$single_year_cover$FIIS$a_2011$morella_pensylvanica$mean_se_cover`, mean frequency: `r mang_species_results$single_year_frq$FIIS$a_2011$morella_pensylvanica$mean_se_frq`) and *Salicornia bigelovii* (mean average cover: `r mang_species_results$single_year_cover$FIIS$a_2011$salicornia_bigelovii$mean_se_cover`, mean frequency: `r mang_species_results$single_year_frq$FIIS$a_2011$salicornia_bigelovii$mean_se_frq`) were only found in 2011, and *Elaeagnus umbellata* (mean average cover: `r mang_species_results$single_year_cover$FIIS$a_2015$elaeagnus_umbellata$mean_se_cover`, mean frequency: `r mang_species_results$single_year_frq$FIIS$a_2015$elaeagnus_umbellata$mean_se_frq`) was only found in 2015. Both *Limonium carolinianum* and *Phragmites australis* were found in every year at FIIS, although the mean average cover and frequency of both species remained low over the entire study period from 2009 to 2017 (Figure 5b and 5f). Similarly, *Thelypteris palustris* was found only in 2009 and 2011 at FIIS, and the mean average cover and frequency remained low over these years (Figure 5b and 5f).

###### *3.3.3* NPSpecies: Highlighted Species: GATE
|       At GATE, seven species were tagged as "management priority", including *Artemisia vulgaris*, *Cenchrus tribuloides*, *Iva frutescens*, *Lonicera japonica*, *Phragmites australis*, *Salicornia bigelovii*, and *Suaeda linearis*. *Suaeda linearis* (mean average cover: `r mang_species_results$single_year_cover$GATE$a_2010$suaeda_linearis$mean_se_cover`, mean frequency: `r mang_species_results$single_year_frq$GATE$a_2010$suaeda_linearis$frq_se_cover`) was only found in 2010. Similarly, *Cenchrus tribuloides* (mean average cover: `r mang_species_results$single_year_cover$GATE$a_2018$cenchrus_tribuloides$mean_se_cover`, mean frequency: `r mang_species_results$single_year_frq$GATE$a_2018$cenchrus_tribuloides$frq_se_cover`) was only found in 2018. *Iva frutescens* was found in every year at GATE, and while the average mean cover remained relatively low over the entire study period, the mean frequency declined between 2010 to 2018 (Figure 5c and 5g). *Artemisia vulgaris* was found in 2014, 2016, and 2018 at GATE, and the mean average cover and frequency remained low over these years (Figure 5c and 5g). *Lonicera japonica* was only found in 2012 and 2018, and the mean average cover and frequency remained low over these years (Figure 5c and 5g). Similarly, *Phragmites australis* was only found in 2012 and 2016, and the mean average cover and frequency remained low over these years (Figure 5c and 5g). Finally, *Salicornia bigelovii* was only found in 2010 and 2012, and the mean average cover and frequency remained low over these years (Figure 5c and 5g).

###### *3.3.4* NPSpecies: Highlighted Species: SAHI
|       At SAHI, only a single species - *Panicum amarum* - was tagged as "management priority". *Panicum amarum* was found in 2009, 2015, and 2017 at SAHI, although the mean average cover and frequency remained low over these years (Figure 5d and 5h).

```{r NPSpecies highlighted plot, echo=FALSE, fig.height=5, fig.width=8.5, message=FALSE, warning=FALSE, out.height=5, out.width=8.5}
mang_cover_plot <- mang_species_dfs$mang_species_cover %>%
      mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
             SciName_lab = paste0(SciName_cor, "   ")) %>%
      group_by(UnitCode, SciName_cor) %>%
      mutate(n_years = n_distinct(Year_chr)) %>%
      filter(n_years > 1) %>%
  arrange(UnitCode) %>%
      ggplot(., aes(x = Year, y = mean_cover)) +
      geom_errorbar(aes(ymin = mean_cover - se_cover, ymax = mean_cover + se_cover, group = SciName_lab), color = "black", width = 100) +
      geom_line(aes(color = SciName_lab)) +
      geom_point(aes(fill = SciName_lab), shape = 21, size = 2, color = "black") +
      geom_text(data = . %>%
                  ungroup() %>%
                  distinct(UnitCode) %>%
                  mutate(letter = paste0("(",LETTERS[1:n()], ")"),
                         f = pmap_chr(list(letter, UnitCode), function(a, b) deparse(bquote(bold(.(a)~plain(.(b))))))),
                aes(x = structure(-Inf, class = "Date"), y =  Inf, label = f),
                hjust = -0.2, vjust = 1.5, size  = 3.5, fontface = "bold", family = "serif", parse = T, inherit.aes = F) +
      lemon::facet_rep_wrap(~UnitCode, repeat.tick.labels = T, nrow = 1) +
      scale_y_continuous(limits = c(0,10.5), breaks = seq(0,10, by = 2), name = "Cover of highlighted\n NPSpecies (%)", sec.axis = dup_axis()) +
      scale_x_date(expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y") +
      guides(color = guide_legend(title = "Species:"), fill = guide_legend(title = "Species:")) +
      lfeheR::theme(base_size = 12) +
      theme(
        text = element_text(family = "serif", size = 12),
        axis.title.y.left = element_text(margin = margin(0,10,0,0,"pt")),
        axis.title.x.bottom = element_blank(),
        legend.key = element_rect(color = "transparent"),
        legend.text = element_text(face = "italic"),
        legend.direction = "horizontal",
        panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
        strip.background = element_blank(),
        strip.text = element_blank()
      )

mang_frq_plot <- mang_species_dfs$mang_species_frq %>%
  mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
         SciName_lab = paste0(SciName_cor, "   ")) %>%
  group_by(UnitCode, SciName_cor) %>%
  mutate(n_years = n_distinct(Year_chr)) %>%
  filter(n_years > 1) %>%
  arrange(UnitCode) %>%
      ggplot(., aes(x = Year, y = mean_frq)) +
      geom_errorbar(aes(ymin = mean_frq - se_frq, ymax = mean_frq + se_frq, group = SciName_lab), color = "black", width = 100) +
      geom_line(aes(color = SciName_lab)) +
      geom_point(aes(fill = SciName_lab), shape = 21, size = 2, color = "black") +
      geom_text(data = . %>%
                  ungroup() %>%
                  distinct(UnitCode) %>%
                  mutate(letter = paste0("(",LETTERS[5:8], ")"),
                         f = pmap_chr(list(letter, UnitCode), function(a, b) deparse(bquote(bold(.(a)~plain(.(b))))))),
                aes(x = structure(-Inf, class = "Date"), y =  Inf, label = f),
                hjust = -0.2, vjust = 1.5, size  = 3.5, fontface = "bold", family = "serif", parse = T, inherit.aes = F) +
      lemon::facet_rep_wrap(~UnitCode, repeat.tick.labels = T, nrow = 1) +
      scale_y_continuous(limits = c(0, 0.32), breaks = seq(0,0.3, by = 0.1), name = "Frequency of\n highlighted NPSpecies", sec.axis = dup_axis()) +
      scale_x_date(expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y") +
      guides(color = guide_legend(title = "Species:"), fill = guide_legend(title = "Species:")) +
      lfeheR::theme(base_size = 12) +
      theme(
        text = element_text(family = "serif", size = 12),
        axis.title.x.bottom = element_blank(),
        axis.title.y.left = element_text(margin = margin(0,10,0,0,"pt")),
        legend.key = element_rect(color = "transparent"),
        legend.text = element_text(face = "italic"),
        legend.direction = "horizontal",
        panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
        strip.background = element_blank(),
        strip.text = element_blank()
  )

mang_legend <- get_legend(
  ggplot(plot_veg_cover_usda %>% filter(SciName_cor %in% c("Artemisia vulgaris", "Iva frutescens", "Limonium carolinianum", "Lonicera japonica", "Panicum amarum", "Phragmites australis", "Salicornia bigelovii", "Thelypteris palustris")), aes(x = Year_chr, y = PercentCover), group = SciName_cor) +
    geom_line(aes(color = SciName_cor)) +
    geom_point(aes(fill = SciName_cor), shape = 21, size = 2, color = "black") +
    guides(color = guide_legend(title = "Species:", nrow = 3), fill = guide_legend(title = "Species:", nrow = 3)) +
    lfeheR::theme(base_size = 12) +
    theme(
      text = element_text(family = "serif", size = 12),
      legend.key = element_rect(color = "transparent"),
      legend.key.spacing.y = unit(0,"cm"),
      legend.text = element_text(face = "italic"),
      legend.direction = "horizontal",
      legend.background = element_rect(fill = "transparent")
    )
)

ggdraw() +
  draw_plot(plot_grid(mang_cover_plot + theme(legend.position = "none"), mang_frq_plot + theme(legend.position = "none"), nrow = 2, align = "vh"), y = 0.3, height = 0.7) +
  draw_label("Year", x = 0.525, y = 0.28, fontfamily = "serif", size = 12, hjust = 0) +
  draw_plot(mang_legend, y = -0.32, height = 1) +
  draw_label(bquote(bold("Figure 5.")~"Mean average cover (a, b, c, and) and frequency (d, e, f, and g) of species highlighted as \"managment priority\" and/or"), x = 0.02, y = 0.07, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote("\"exploitation concern\" within NPSpecies."), x = 0.02, y = 0.03, fontfamily = "serif", hjust = 0, size = 12)
```
&nbsp;

##### **3.4** Invasive, Noxious & Prohibited Species
```{r Invasive species, message=TRUE, warning=TRUE, include=FALSE}
invasive_species_dfs <- list(
  "inv_species_cover" = plot_veg_cover_usda %>%
    ungroup() %>%
    select(UnitCode, Year_chr, SciName_cor, starts_with("invasive_")) %>%
    mutate(is_invasive = case_when(if_any(starts_with("invasive_"), ~ .x == "T") ~ "T")) %>%
    filter(is_invasive == "T") %>%
    distinct() %>%
    left_join(., perc_cover, by = c("SciName_cor", "UnitCode", "Year_chr")) %>%
    distinct(),
  
  "inv_species_frq" = site_veg_frq_usda %>%
    ungroup() %>%
    select(UnitCode, Year_chr, SciName_cor, starts_with("invasive_")) %>%
    mutate(is_invasive = case_when(if_any(starts_with("invasive_"), ~ .x == "T") ~ "T")) %>%
    filter(is_invasive == "T") %>%
    distinct() %>%
    left_join(., frq, by = c("SciName_cor", "UnitCode", "Year_chr")) %>%
    distinct()
)

invasive_species_results <- list(
  "inv_species_count" = invasive_species_dfs$inv_species_cover %>%
    select(SciName_cor) %>%
    n_distinct(),
  
  "single_year_cover" = invasive_species_dfs$inv_species_cover %>%
    group_by(UnitCode, SciName_cor) %>%
    filter(n() == 1) %>%
    ungroup() %>% 
    mutate(Year = as.integer(Year_chr)) %>% 
    mutate(format_mean_cover = if_else(round(mean_cover,1) < 0.1, format(round(mean_cover,2), nsmall = 2), format(round(mean_cover,1), nsmall = 1)),
           format_se_cover = if_else(round(se_cover,1) < 0.1, format(round(se_cover,2), nsmall = 2), format(round(se_cover,1), nsmall = 1)),
           mean_se_cover = paste0(format_mean_cover, " ± ", format_se_cover, "%"),
           Year_chr = paste0("a_", Year_chr),
           SciName_cor = janitor::make_clean_names(SciName_cor, allow_dupes = TRUE)) %>%
    select(UnitCode, Year_chr, SciName_cor, mean_se_cover) %>%
    super_split(UnitCode, Year_chr, SciName_cor),
  
  "single_year_frq" = invasive_species_dfs$inv_species_frq %>%
    group_by(UnitCode, SciName_cor) %>%
    filter(n() == 1) %>%
    ungroup() %>%
    mutate(Year = as.integer(Year_chr)) %>%
    mutate(format_mean_frq = if_else(round(mean_frq,2) < 0.01, format(round(mean_frq,3), nsmall = 3), format(round(mean_frq,2), nsmall = 2)),
           format_se_frq = if_else(round(se_frq,2) < 0.01, format(round(se_frq,3), nsmall = 3), format(round(se_frq,2), nsmall = 2)),
           mean_se_frq = paste0(format_mean_frq, " ± ", format_se_frq),
           Year_chr = paste0("a_", Year_chr),
           SciName_cor = janitor::make_clean_names(SciName_cor, allow_dupes = TRUE)) %>%
    select(UnitCode, Year_chr, SciName_cor, mean_se_frq) %>%
    super_split(UnitCode, Year_chr, SciName_cor)
)
```

|       A total of `r invasive_species_results$inv_species_count` species were considered invasive, noxious, or prohibited within their respective states. No invasive species were found at either ASIS, GEWA, or SAHI.  Notably, *Phragmites australis* was found in multiple years at both FIIS and GATE (Figure 6). 

##### *3.4.1* Invasive Species: COLO
|       At COLO, only a single species, *Najas minor*, was considered invasive by the Virginia Department of Conservation and Recreation, and was only found at a single plot in 2016 (mean average cover: `r invasive_species_results$single_year_cover$COLO$a_2016$najas_minor$mean_se_cover`, mean frequency: `r invasive_species_results$single_year_frq$COLO$a_2016$najas_minor$mean_se_frq`). 

##### *3.4.2* Invasive Species: FIIS
|       At FIIS, three species, including *Elaeagnus umbellata*, *Polygonum perfoliatum*, and *Phragmites australis* were considered invasive by the state of New York. Both *Elaeagnus umbellata* (mean average cover: `r invasive_species_results$single_year_cover$FIIS$a_2015$elaeagnus_umbellata$mean_se_cover`, mean frequency: `r invasive_species_results$single_year_frq$FIIS$a_2015$elaeagnus_umbellata$mean_se_frq`) and *Polygonum perfoliatum* (mean average cover: `r invasive_species_results$single_year_cover$FIIS$a_2015$polygonum_perfoliatum$mean_se_cover`, mean frequency: `r invasive_species_results$single_year_frq$FIIS$a_2015$polygonum_perfoliatum$mean_se_frq`) were only found at a single plot located within the William Floyd Estate in 2015. The mean average cover and frequency of *Phragmites australis* remained unchanged across the entire study period from 2009 to 2017 (Figure 6a and 6c).

##### *3.4.3* Invasive Species: GATE
|       At GATE, four species, including *Artemisia vulgaris*, *Lonicera japonica*, *Phragmites australis*, and *Rubus phoenicolasius* were considered invasive by the state of New York. *Rubus phoenicolasius* was only found at a single plot in 2018 (mean average cover: `r invasive_species_results$single_year_cover$GATE$a_2018$rubus_phoenicolasius$mean_se_cover`, mean frequency: `r invasive_species_results$single_year_frq$GATE$a_2018$rubus_phoenicolasius$mean_se_frq`) and was not found again in any other years. *Artemisia vulgaris* was found in 2014, 2016, and 2018 at GATE, and the mean average cover and frequency remained low over these years (Figure 6b and 6d). *Lonicera japonica* was only found in 2012 and 2018, and the mean average cover and frequency remained low over these years (Figure 6b and 6d). Similarly, *Phragmites australis* was only found in 2012 and 2016, and the mean average cover and frequency remained low over these years (Figure 6b and 6d).

```{r Figure 6, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.25, fig.height=5, out.width=6.25, out.height=5}
invasive_cover_plot <- invasive_species_dfs$inv_species_cover %>%
      mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
             SciName_lab = paste0(SciName_cor, "   ")) %>%
      group_by(UnitCode, SciName_cor) %>%
      mutate(n_years = n_distinct(Year_chr)) %>%
      filter(n_years > 1) %>%
  arrange(UnitCode) %>%
      ggplot(., aes(x = Year, y = mean_cover)) +
      geom_errorbar(aes(ymin = mean_cover - se_cover, ymax = mean_cover + se_cover, group = SciName_lab), color = "black", width = 100) +
      geom_line(aes(color = SciName_lab)) +
      geom_point(aes(fill = SciName_lab), shape = 21, size = 2, color = "black") +
      geom_text(data = . %>%
                  ungroup() %>%
                  distinct(UnitCode) %>%
                  mutate(letter = paste0("(",LETTERS[1:n()], ")"),
                         f = pmap_chr(list(letter, UnitCode), function(a, b) deparse(bquote(bold(.(a)~plain(.(b))))))),
                aes(x = structure(-Inf, class = "Date"), y =  Inf, label = f),
                hjust = -0.2, vjust = 2, size  = 3.5, fontface = "bold", family = "serif", parse = T, inherit.aes = F) +
      lemon::facet_rep_wrap(~UnitCode, repeat.tick.labels = T) +
      scale_y_continuous(limits = c(0,8.5), name = "Cover of invasive\nspecies (%)", sec.axis = dup_axis()) +
      scale_x_date(expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y") +
      guides(color = guide_legend(title = "Species:"), fill = guide_legend(title = "Species:")) +
      lfeheR::theme(base_size = 12) +
      theme(
        text = element_text(family = "serif", size = 12),
        axis.title.x.bottom = element_blank(),
        axis.title.y.left = element_text(margin = margin(0,10,0,0,"pt")),
        legend.key = element_rect(color = "transparent"),
        legend.text = element_text(face = "italic"),
        legend.direction = "horizontal",
        panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
        strip.background = element_blank(),
        strip.text = element_blank()
      )

invasive_frq_plot <- invasive_species_dfs$inv_species_frq %>%
      mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
             SciName_lab = paste0(SciName_cor, "   ")) %>%
  group_by(UnitCode, SciName_cor) %>%
  mutate(n_years = n_distinct(Year_chr)) %>%
      filter(n_years > 1) %>%
  arrange(UnitCode) %>%
      ggplot(., aes(x = Year, y = mean_frq)) +
      geom_errorbar(aes(ymin = mean_frq - se_frq, ymax = mean_frq + se_frq, group = SciName_lab), color = "black", width = 100) +
      geom_line(aes(color = SciName_lab)) +
      geom_point(aes(fill = SciName_lab), shape = 21, size = 2, color = "black") +
      geom_text(data = . %>%
                  ungroup() %>%
                  distinct(UnitCode) %>%
                  mutate(letter = paste0("(",LETTERS[3:4], ")"),
                         f = pmap_chr(list(letter, UnitCode), function(a, b) deparse(bquote(bold(.(a)~plain(.(b))))))),
                aes(x = structure(-Inf, class = "Date"), y =  Inf, label = f),
                hjust = -0.2, vjust = 2, size  = 3.5, fontface = "bold", family = "serif", parse = T, inherit.aes = F) +
      lemon::facet_rep_wrap(~UnitCode, repeat.tick.labels = T) +
      scale_y_continuous(limits = c(0, 0.32), breaks = seq(0,0.3, by = 0.1), name = "Frequency of\ninvasive species", sec.axis = dup_axis()) +
      scale_x_date(expand = c(.04, 0), sec.axis = dup_axis(), date_labels = "'%y") +
      guides(color = guide_legend(title = "Species:"), fill = guide_legend(title = "Species:")) +
      lfeheR::theme(base_size = 12) +
      theme(
        text = element_text(family = "serif", size = 12),
        axis.title.y.left = element_text(margin = margin(0,10,0,0,"pt")),
        axis.title.x.bottom = element_blank(),
        legend.key = element_rect(color = "transparent"),
        legend.text = element_text(face = "italic"),
        legend.direction = "horizontal",
        panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
        strip.background = element_blank(),
        strip.text = element_blank()
  )

invasive_legend <- get_legend(
  ggplot(plot_veg_cover_usda %>% filter(SciName_cor %in% c("Phragmites australis", "Lonicera japonica", "Artemisia vulgaris")), aes(x = Year_chr, y = PercentCover), group = SciName_cor) +
    geom_line(aes(color = SciName_cor)) +
    geom_point(aes(fill = SciName_cor), shape = 21, size = 2, color = "black") +
    guides(color = guide_legend(title = "Species:"), fill = guide_legend(title = "Species:")) +
    lfeheR::theme(base_size = 12) +
    theme(
      text = element_text(family = "serif", size = 12),
      legend.key = element_rect(color = "transparent"),
      legend.text = element_text(face = "italic"),
      legend.direction = "horizontal",
      legend.background = element_rect(fill = "transparent")
    )
)

ggdraw() +
  draw_plot(plot_grid(invasive_cover_plot + theme(legend.position = "none"), invasive_frq_plot + theme(legend.position = "none"), nrow = 2, align = "vh"), y = 0.18, height = 0.82) +
  draw_label("Year", x = 0.525, y = 0.17, fontfamily = "serif", size = 12, hjust = 0) +
  draw_plot(invasive_legend, y = -0.38, height = 1) +
  draw_label(bquote(bold("Figure 6.")~"Mean average cover (a and b) and frequency (c and d) of invasive species at FIIS"), x = 0.02, y = 0.06, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote("and GATE."), x = 0.02, y = 0.02, fontfamily = "serif", hjust = 0, size = 12)
```
&nbsp;

##### **3.5** Salinity Tolerance
```{r Salinity tolerance, echo=FALSE, message=FALSE, warning=FALSE}
salinity_dfs <- list(
  
  "sal_count" = site_veg_frq_usda %>%
    ungroup() %>%
    mutate(SalinityCode = case_when(SalinityCode == "high >18 ppt" ~ "High",
                                    SalinityCode == "medium 0.5-18 ppt" ~ "Medium",
                                    SalinityCode == "low <0.5 ppt" ~ "Low", 
                                    SalinityCode == "unknown" ~ NA, 
                                    SalinityCode == "no" ~ NA,
                                    T ~ SalinityCode),
           SalinityTolerance = case_when(SalinityTolerance == "" ~ NA,
                                         SalinityTolerance == "None" ~ NA,
                                         T ~ SalinityTolerance)) %>%
    mutate(sal_code = if_else(is.na(SalinityTolerance) & !is.na(SalinityCode), SalinityCode, SalinityTolerance)) %>%
    group_by(UnitCode, Year_chr, sal_code) %>%
    filter(!is.na(sal_code)) %>%
    summarise(species_count = n_distinct(SciName_cor)) %>%
    mutate(value_label = as.character(round(species_count,0))) %>%
    mutate(value_label = if_else(species_count == 1, NA, as.character(species_count))),
  
  "sal_frq" = plot_veg_cover_usda %>%
    ungroup() %>%
    select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, SalinityCode, SalinityTolerance) %>%
    mutate(SalinityCode = case_when(SalinityCode == "high >18 ppt" ~ "High",
                                    SalinityCode == "medium 0.5-18 ppt" ~ "Medium",
                                    SalinityCode == "low <0.5 ppt" ~ "Low", 
                                    SalinityCode == "unknown" ~ NA, 
                                    SalinityCode == "no" ~ NA,
                                    T ~ SalinityCode),
           SalinityTolerance = case_when(SalinityTolerance == "" ~ NA,
                                         SalinityTolerance == "None" ~ NA,
                                         T ~ SalinityTolerance)) %>%
    mutate(sal_code = if_else(is.na(SalinityTolerance) & !is.na(SalinityCode), SalinityCode, SalinityTolerance)) %>%
    select(-c(SalinityCode, SalinityTolerance)) %>%
    group_by(UniqueID, UnitCode, Year_chr) %>%
    mutate(total_site_plots = n_distinct(EventID)) %>%
    group_by(UniqueID, UnitCode, Year_chr, sal_code) %>%
    mutate(total_site_present = n_distinct(EventID)) %>%
    mutate(site_frq = total_site_present/total_site_plots) %>%
    group_by(UniqueID, UnitCode, Year_chr, sal_code) %>%
    summarise(mean_site_frq = mean(site_frq)) %>%
    group_by(UnitCode, Year_chr, sal_code) %>%
    summarise(mean_frq = mean(mean_site_frq),
              se_frq = sd(mean_site_frq)/sqrt(length(mean_site_frq))) %>%
    filter(!is.na(sal_code)) %>%
    mutate(value_label = format(round(mean_frq,2), nsmall = 2)) %>%
    mutate(value_label = if_else(round(mean_frq,2) <= 0.05, NA, format(round(mean_frq,2), nsmall = 2))),
  
  "sal_cover" = perc_cover %>% 
    left_join(., plot_veg_cover_usda %>%
                ungroup() %>%
                select(UnitCode, Year_chr, SciName_cor, SalinityCode, SalinityTolerance), 
              by = c("UnitCode", "Year_chr", "SciName_cor")) %>%
    distinct() %>%
    ungroup() %>%
    mutate(SalinityCode = case_when(SalinityCode == "high >18 ppt" ~ "High",
                                    SalinityCode == "medium 0.5-18 ppt" ~ "Medium",
                                    SalinityCode == "low <0.5 ppt" ~ "Low", 
                                    SalinityCode == "unknown" ~ NA, 
                                    SalinityCode == "no" ~ NA,
                                    T ~ SalinityCode),
           SalinityTolerance = case_when(SalinityTolerance == "" ~ NA,
                                         SalinityTolerance == "None" ~ NA,
                                         T ~ SalinityTolerance)) %>%
    mutate(sal_code = if_else(is.na(SalinityTolerance) & !is.na(SalinityCode), SalinityCode, SalinityTolerance)) %>%
    filter(!is.na(sal_code)) %>%
    group_by(UnitCode, Year_chr, sal_code) %>%
    summarise(mean_cover = sum(mean_cover)) %>%
    mutate(value_label = if_else(round(mean_cover,0) <= 10, NA, paste0(format(round(mean_cover,0), nsmall = 0))))
)


salinity_results <- list(
  "sal_count_difs" = salinity_dfs$sal_count %>%
    group_by(UnitCode, sal_code) %>%
    mutate(min_year = as.character(min(as.integer(Year_chr))),
           max_year = as.character(max(as.integer(Year_chr)))) %>%
    mutate(is_min_max_year = if_else(Year_chr == min_year | Year_chr == max_year, "T", NA)) %>%
    filter(is_min_max_year == "T") %>%
    mutate(year_grp = if_else(Year_chr == min_year, "min", "max")) %>%
    ungroup() %>%
    select(UnitCode, sal_code, year_grp, species_count) %>%
    pivot_wider(., names_from = "year_grp", values_from = "species_count") %>%
    mutate(dif = round(max - min,2),
           value_lab = round(max-min,0)),
  
  "sal_frq_difs" = salinity_dfs$sal_frq %>%
    group_by(UnitCode, sal_code) %>%
    mutate(min_year = as.character(min(as.integer(Year_chr))),
           max_year = as.character(max(as.integer(Year_chr)))) %>%
    mutate(is_min_max_year = if_else(Year_chr == min_year | Year_chr == max_year, "T", NA)) %>%
    filter(is_min_max_year == "T") %>%
    mutate(year_grp = if_else(Year_chr == min_year, "min", "max")) %>%
    ungroup() %>%
    select(UnitCode, sal_code, year_grp, mean_frq) %>%
    pivot_wider(., names_from = "year_grp", values_from = "mean_frq") %>%
    mutate(dif = round(max - min,2),
           value_lab = format(round(max-min,2)), nsmall = 2),
  
  "sal_cover_difs" = salinity_dfs$sal_cover %>%
    group_by(UnitCode, sal_code) %>%
    mutate(min_year = as.character(min(as.integer(Year_chr))),
           max_year = as.character(max(as.integer(Year_chr)))) %>%
    mutate(is_min_max_year = if_else(Year_chr == min_year | Year_chr == max_year, "T", NA)) %>%
    filter(is_min_max_year == "T") %>%
    mutate(year_grp = if_else(Year_chr == min_year, "min", "max")) %>%
    ungroup() %>%
    select(UnitCode, sal_code, year_grp, mean_cover) %>%
    pivot_wider(., names_from = "year_grp", values_from = "mean_cover", values_fill = 0) %>%
    mutate(dif = round(max - min,0),
           value_lab = round(max-min,0)),
  
  "sal_count_avg" = salinity_dfs$sal_count %>% 
    group_by(UnitCode, sal_code) %>%
    summarise(mean_count = format(round(mean(species_count),1),nsmall = 1), 
              se_count = format(round(sd(species_count)/sqrt(length(species_count)),1),nsmall = 1)) %>%
    super_split(., UnitCode, sal_code),
  
  "sal_frq_avg" = salinity_dfs$sal_frq %>%
    group_by(UnitCode, sal_code) %>%
    summarise(mean_frqa = mean(mean_frq),
              se_frq = sd(mean_frq)/sqrt(length(mean_frq))) %>%
    mutate(format_mean_frq = 
             if_else(
               round(mean_frqa,2) < 0.01, 
               format(round(mean_frqa,3), nsmall = 3), 
               format(round(mean_frqa,2), nsmall = 2)),
           format_se_frq = 
             if_else(
               round(se_frq,2) < 0.01, 
               format(round(se_frq,3), nsmall = 3), 
               format(round(se_frq,2), nsmall = 2)),
           mean_se_frq = paste0(format_mean_frq, " ± ", format_se_frq)) %>%
    super_split(., UnitCode, sal_code),
  
  "sal_cover_avg" = salinity_dfs$sal_cover %>%
    group_by(UnitCode, sal_code) %>%
    summarise(mean_covera = mean(mean_cover),
              se_cover = sd(mean_cover)/sqrt(length(mean_cover))) %>%
    mutate(format_mean_cover = 
             if_else(round(mean_covera, 1) < 0.1, 
                     format(round(mean_covera,2), nsmall = 2), 
                     format(round(mean_covera,1), nsmall = 1)),
           format_se_cover = 
             if_else(round(se_cover,1) < 0.1, 
                     format(round(se_cover,2), nsmall = 2), 
                     format(round(se_cover,1), nsmall = 1)),
           mean_se_cover = paste0(format_mean_cover, " ± ", format_se_cover, "%")) %>%
    super_split(., UnitCode, sal_code)
)
```

```{r Table 3, echo=FALSE, message=FALSE, warning=FALSE}
salinity_results$sal_count_difs %>%
  select(UnitCode, sal_code, "count_dif" = value_lab) %>%
  left_join(., salinity_results$sal_frq_difs %>%
              select(UnitCode, sal_code, "frq_dif" = value_lab), 
            by = c("UnitCode", "sal_code")) %>%
  left_join(., salinity_results$sal_cover_difs %>%
              select(UnitCode, sal_code, "cover_dif" = value_lab), 
            by = c("UnitCode", "sal_code")) %>%
  mutate(count_dif = case_when(count_dif > 2 ~ paste0("↑ +", count_dif),
                               count_dif < -2 ~ paste0("↓ ", count_dif),
                               count_dif >= -2 & count_dif <= 2 ~ "-"),
         frq_dif = case_when(as.numeric(frq_dif) > 0.05 ~ paste0("↑ +", frq_dif),
                             as.numeric(frq_dif) < -0.05 ~ paste("↓ ", frq_dif),
                             as.numeric(frq_dif) >= -0.05 & frq_dif <= 0.05 ~ "-"),
         cover_dif = case_when(cover_dif > 10 ~ paste0("↑ +", cover_dif, "%"),
                               cover_dif < -10 ~ paste0("↓ ", cover_dif, "%"),
                               cover_dif >= -10 & cover_dif <= 10 ~ "-"),
         sal_code = factor(sal_code, levels = c("Low", "Medium", "High"))) %>%
  arrange(UnitCode, sal_code)  %>%
  flextable(.) %>%
  set_header_labels(., UnitCode = "Park", sal_code = "Salinity tolerance", count_dif = "Species Count", frq_dif = "Frequency", cover_dif = "Average cover") %>%
  align(., align = "center", part = "all") %>%
  highlight(., j = "count_dif", i = ~ count_dif != "-", color = "#FF7C80") %>%
  highlight(., j = "frq_dif", i = ~str_detect(frq_dif, "^-$", negate = T), color = "#FF7C80") %>%
  highlight(., j = "frq_dif", i = ~str_detect(frq_dif, "\\+"), color = "#84E084") %>%
  highlight(., j = "cover_dif", i = ~str_detect(cover_dif, "^-$", negate = T), color = "#FF7C80") %>%
  highlight(., j = "cover_dif", i = ~str_detect(cover_dif, "\\+"), color = "#84E084") %>%
  padding(., padding.top = 3, padding.bottom = 3, part = "body") %>%
   add_header_lines(., values = c("Table 3. Trends in species count, frequency, and average cover of species in each salinity tolerance category between the first and last sampling event at each park.")) %>%
  align(., i = 1, align = "left", part = "header") %>%
  merge_v(., j = "UnitCode") %>%
  fix_border_issues() %>%
  hline(., i = c(3,6,9,12,15), border = fp_border(color = "black")) %>%
  set_table_properties(., width = 0.55, layout = "autofit") 
```
&nbsp;

```{r Salinity plot, message=FALSE, warning=FALSE, include=FALSE}
salinity_plot <- function(park) {
  
  sal_count <- salinity_dfs$sal_count %>%
    filter(UnitCode == park)
  
  sal_frq <- salinity_dfs$sal_frq %>%
    filter(UnitCode == park)
  
  sal_cover <- salinity_dfs$sal_cover %>%
    filter(UnitCode == park)
  
  labfun <- function(metric_df, metric_name) {
    f <- metric_df %>%
      ungroup() %>%
      mutate(sal = factor(case_when(
        sal_code == "High" ~ "High (>18 ppt)   ",
        sal_code == "Medium" ~ "Medium (0.5-18 ppt)   ",
        sal_code == "Low" ~ "Low (<0.5 ppt)   ",
        T ~ NA
      ), levels = c("High (>18 ppt)   ", "Medium (0.5-18 ppt)   ", "Low (<0.5 ppt)   ")),
      Year = as.Date(paste0(Year_chr, "-01-01"))) %>%
      filter(!is.na(sal))
  }
  
  sal_count2 <- labfun(metric_df = sal_count, metric_name = "species_count")
  sal_frq2 <- labfun(metric_df = sal_frq, metric_name = "mean_frq")
  sal_cover2 <- labfun(metric_df = sal_cover, metric_name = "mean_cover")
  
  ggfun <- function(metric_df2, metric_name, park_name = park){
    
    if(metric_name == "species_count") {
      letter_lab <- "(A)"
      metric_lab <- "Species count (n)"
      max_y <- 37
      value_text_size <- 3.5
      y_breaks <- seq(0,30, by = 10)
    } else if(metric_name == "mean_frq") {
      letter_lab <- "(B)"
      metric_lab <- "Frequency"
      if(park_name == "ASIS") {
        max_y <- 1.31
        y_breaks <- seq(0, 1.20, by = 0.3)
      } else if(park_name == "COLO"){
        max_y <- 2.43
        y_breaks <- seq(0, 2.50, by = 0.5)
      } else if(park_name == "FIIS"){
        max_y <- 1.49
        y_breaks <- seq(0, 1.4, by = 0.3)
      } else if(park_name == "GATE"){
        max_y <- 1.26
        y_breaks <- seq(0, 1.20, by = 0.3)
      } else if(park_name == "GEWA"){
        max_y <- 2.25
        y_breaks <- seq(0, 2.00, by = 0.5)
      } else if(park_name == "SAHI"){
        max_y <- 1.32
        y_breaks <- seq(0, 1.20, by = 0.3)
      }
      value_text_size <- 2.5
    } else if(metric_name == "mean_cover") {
      letter_lab <- "(C)"
      metric_lab <- "Cover (%)"
      max_y <- 140
      y_breaks <- seq(0,125, by = 25)
      value_text_size <- 3.5
    }
    
    if(park_name == "ASIS") {
      pal <- asis_pal[c(1,5,9)]
    } else if(park_name == "COLO") {
      pal <- colo_pal[c(1,5,8)]
    } else if(park_name == "FIIS") {
      pal <- fiis_pal[c(1,5,9)]
    } else if(park_name == "GATE") {
      pal <- gate_pal
    } else if(park_name == "GEWA") {
      pal <- monochromeR::generate_palette("#118ab2", modification = "go_lighter", n_colors = 3)
    } else if(park_name == "SAHI") {
      pal <- monochromeR::generate_palette("#073b4c", modification = "go_lighter", n_colors = 3)
    }
    
    if(park_name == "SAHI") {
      value_text_color <- "white"
    } else {
      value_text_color <- "black"
    }
    
    park_lab <- paste0(park_name, ":")
    
    if(metric_name == "mean_frq"){
      x_title_color <- "black"
    } else {
      x_title_color <- "transparent"
    }
    
    metric_df2 %>%
      ggplot(., aes(x = Year, y = eval(sym(metric_name)))) +
      geom_col(aes(fill = sal), color = "black") +
      geom_text(aes(label = value_label, group = sal), color = value_text_color, position = position_stack(vjust = 0.5), size = value_text_size, family = "serif", show.legend = FALSE) +
      annotate("text", label = deparse(bquote(bold(.(letter_lab)))), x = structure(-Inf, class = "Date"), y = Inf, hjust = -0.3, vjust = 1.5, size = 3.5, fontface = "bold", family = "serif", parse = T) +
      scale_fill_manual(values = pal, name = "Salinity tolerance:") +
      scale_x_date(date_breaks = "2 year", date_labels = "'%y") +
      scale_y_continuous(limits = c(0,max_y), breaks = y_breaks, expand = c(0,0), name = metric_lab, sec.axis = dup_axis()) +
      guides(fill = guide_legend(reverse = TRUE)) +
      theme(
        text = element_text(size = 12, family = "serif", color = "black"),
        panel.border = element_rect(color = "black", fill = NA),
        panel.background = element_blank(),
        panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
        panel.grid.minor = element_blank(),
        axis.ticks.length.x = unit(0, "pt"),
        axis.ticks.length.y = unit(-4, "pt"),
        axis.title.y.right = element_blank(),
        axis.title.y.left = element_text(size = 12, margin = margin(r = 5, unit = "pt")),
        axis.text.y.left = element_text(size = 12, color = "black"),
        axis.title.x = element_text(size = 12, color = x_title_color),
        axis.text.y.right = element_blank(),
        axis.text.x = element_text(size = 12, color = "black"),
        legend.text = element_text(size = 12),
        legend.title = element_text(size = 12),
        legend.direction = "horizontal",
        legend.background = element_rect(fill = "transparent")
      )
  }
  
  count_plot <- ggfun(metric_df2 = sal_count2, metric_name = "species_count")
  frq_plot <- ggfun(metric_df2 = sal_frq2, metric_name = "mean_frq") +
    theme(legend.position = "none")
  cover_plot <- ggfun(metric_df2 = sal_cover2, metric_name = "mean_cover") +
    theme(legend.position = "none")
  
  legend <- cowplot::get_legend(count_plot)
  count_plot <- count_plot + theme(legend.position = "none")
  
  ggdraw(plot_grid(plot_grid(count_plot, frq_plot, cover_plot, nrow = 1, byrow = T),
                   plot_grid(NULL, legend, NULL, nrow = 1, byrow = T, rel_widths = c(0.1, 1, 0.1)),
                   rel_heights = c(1,0.06), nrow = 2))
}
```


###### *3.5.1* Salinity Tolerance: ASIS
|      At ASIS, species with high salinity tolerance had the greatest species count, frequency, and percent cover across all years despite the declines in frequency and cover between the first and last sampling event (Table 3). Across the entire study period at ASIS, the average count of species with low, medium, and high salinity tolerance was `r salinity_results$sal_count_avg$ASIS$Low$mean_count`, `r salinity_results$sal_count_avg$ASIS$Medium$mean_count`, and `r salinity_results$sal_count_avg$ASIS$High$mean_count`, respectively. The average frequency of species with low, medium, and high salinity tolerance was `r salinity_results$sal_frq_avg$ASIS$Low$format_mean_frq`, `r salinity_results$sal_frq_avg$ASIS$Medium$format_mean_frq`, and `r salinity_results$sal_frq_avg$ASIS$High$format_mean_frq`, respectively. The mean average cover of species with low, medium, and high salinity tolerance was `r salinity_results$sal_cover_avg$ASIS$Low$format_mean_frq`%, `r salinity_results$sal_cover_avg$ASIS$Medium$format_mean_frq`%, and `r salinity_results$sal_cover_avg$ASIS$High$format_mean_frq`%, respectively. The count of species with medium salinity tolerance decreased between 2008 to 2018, whereas the count of species with low and high salinity tolerance remained unchanged (Table 3, Figure 7a). The frequency of species in all salinity tolerance categories remained unchanged (Table 3, Figure 7b). Additionally, the average cover of species with high salinity tolerance decreased whereas the average cover of species with low and medium salinity tolerance remained unchanged (Table 3, Figure 7c). 

```{r Figure 7, echo=FALSE, fig.height=4, fig.width=6.5, message=FALSE, out.height=4, out.width=6.5}
ggdraw(salinity_plot(park = "ASIS"), ylim = c(-0.25,1)) +
  draw_label(bquote(bold("Figure 7.")~"ASIS (a) species count, (b) frequency, and (c) average cover (%) in each salinity"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("tolerance category. Note that count values below 1, frequency values below 0.05, and cover values"), x = 0.02, y = -0.14, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("below 10% are not shown."), x = 0.02, y = -0.2, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

###### *3.5.2* Salinity Tolerance: COLO
|       Across the entire study period at COLO, the average count of species with low, medium, and high salinity tolerance was `r salinity_results$sal_count_avg$COLO$Low$mean_count`, `r salinity_results$sal_count_avg$COLO$Medium$mean_count`, and `r salinity_results$sal_count_avg$COLO$High$mean_count`, respectively. The average frequency of species with low, medium, and high salinity tolerance was `r salinity_results$sal_frq_avg$COLO$Low$format_mean_frq`, `r salinity_results$sal_frq_avg$COLO$Medium$format_mean_frq`, and `r salinity_results$sal_frq_avg$COLO$High$format_mean_frq`, respectively. The average cover of species with low, medium, and high salinity tolerance was `r salinity_results$sal_cover_avg$COLO$Low$format_mean_cover`%, `r salinity_results$sal_cover_avg$COLO$Medium$format_mean_cover`%, and `r salinity_results$sal_cover_avg$COLO$High$format_mean_cover`%, respectively. The count of species in all salinity tolerance categories remained unchanged between 2008 to 2016 (Table 3, Figure 8a). However, both the frequency and average cover of species with low and medium salinity tolerance increased substantially whereas the frequency and cover of species with high salinity tolerance substantially decreased over the study period (Table 3, Figure 8b and 8c).

```{r Figure 8, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=4, out.width=6.5, out.height=4}
ggdraw(salinity_plot(park = "COLO"), ylim = c(-0.2,1)) +
  draw_label(bquote(bold("Figure 8.")~"COLO (a) species count, (b) frequency, and (c) average cover (%) in each salinity"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("tolerance category. Note that cover values below 10% are not shown."), x = 0.02, y = -0.14, size = 12, fontfamily = "serif", hjust = 0) 
```
&nbsp;

###### *3.5.3* Salinity Tolerance: FIIS
|       Across the entire study period at FIIS, the average count of species with low, medium, and high salinity tolerance was `r salinity_results$sal_count_avg$FIIS$Low$mean_count`, `r salinity_results$sal_count_avg$FIIS$Medium$mean_count`, and `r salinity_results$sal_count_avg$FIIS$High$mean_count`, respectively. The average frequency of species with low, medium, and high salinity tolerance was `r salinity_results$sal_frq_avg$FIIS$Low$format_mean_frq`, `r salinity_results$sal_frq_avg$FIIS$Medium$format_mean_frq`, and `r salinity_results$sal_frq_avg$FIIS$High$format_mean_frq`, respectively. The average cover of species with low, medium, and high salinity tolerance was `r salinity_results$sal_cover_avg$FIIS$Low$format_mean_cover`%, `r salinity_results$sal_cover_avg$FIIS$Medium$format_mean_cover`%, and `r salinity_results$sal_cover_avg$FIIS$High$format_mean_cover`%, respectively. The count and frequency of species in all salinity tolerance categories varied between years but ultimately remained unchanged between 2009 to 2017 (Table 3, Figure 9a and 9b). The average cover of species with high salinity tolerance declined between 2009 to 2017, whereas the average cover of species with low and medium salinity tolerance remained unchanged during this time (Table 3, Figure 9c).

```{r Figure 9, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=4, out.width=6.5, out.height=4}
ggdraw(salinity_plot(park = "FIIS"), ylim = c(-0.25,1)) +
  draw_label(bquote(bold("Figure 9.")~"FIIS (a) species count, (b) frequency, and (c) average cover (%) in each salinity"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("tolerance category. Note that count values below 1, frequency values below 0.05, and cover values"), x = 0.02, y = -0.14, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("below 10% are not shown."), x = 0.02, y = -0.2, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

###### *3.5.4* Salinity Tolerance: GATE
|       Across the entire study period at GATE, the average count of species with low, medium, and high salinity tolerance was `r salinity_results$sal_count_avg$GATE$Low$mean_count`, `r salinity_results$sal_count_avg$GATE$Medium$mean_count`, and `r salinity_results$sal_count_avg$GATE$High$mean_count`, respectively. The average frequency of species with low, medium, and high salinity tolerance was `r salinity_results$sal_frq_avg$GATE$Low$format_mean_frq`, `r salinity_results$sal_frq_avg$GATE$Medium$format_mean_frq`, and `r salinity_results$sal_frq_avg$GATE$High$format_mean_frq`, respectively. The average cover of species with low, medium, and high salinity tolerance was `r salinity_results$sal_cover_avg$GATE$Low$format_mean_cover`%, `r salinity_results$sal_cover_avg$GATE$Medium$format_mean_cover`%, and `r salinity_results$sal_cover_avg$GATE$High$format_mean_cover`%, respectively. The count and frequency of species in all salinity tolerance categories remained unchanged between 2010 to 2018 (Table 3, Figure 10a and 10b). However, the average cover of species with high salinity tolerance decreased over the study period, whereas the average cover of species with low or medium salinity tolerance remained unchanged (Table 3, Figure 10c). Note that differences between the year 2014 and other years are most likely related to the fact that only 1 site (out of 3) was sampled in 2014.

```{r Figure 8, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=4, out.width=6.5, out.height=4}
ggdraw(salinity_plot(park = "GATE"), ylim = c(-0.25,1)) +
  draw_label(bquote(bold("Figure 10.")~"GATE (a) species count, (b) frequency, and (c) average cover (%) in each salinity"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("tolerance category. Note that frequency values below 0.05 and cover values below 10% are not"), x = 0.02, y = -0.14, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("shown."), x = 0.02, y = -0.2, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

###### *3.5.5* Salinity Tolerance: GEWA
|       Across the entire study period at GEWA, the average count of species with low, medium, and high salinity tolerance was `r salinity_results$sal_count_avg$GEWA$Low$mean_count`, `r salinity_results$sal_count_avg$GEWA$Medium$mean_count`, and `r salinity_results$sal_count_avg$GEWA$High$mean_count`, respectively. The average frequency of species with low, medium, and high salinity tolerance was `r salinity_results$sal_frq_avg$GEWA$Low$format_mean_frq`, `r salinity_results$sal_frq_avg$GEWA$Medium$format_mean_frq`, and `r salinity_results$sal_frq_avg$GEWA$High$format_mean_frq`, respectively. The average cover of species with low, medium, and high salinity tolerance was `r salinity_results$sal_cover_avg$GEWA$Low$format_mean_cover`%, `r salinity_results$sal_cover_avg$GEWA$Medium$format_mean_cover`%, and `r salinity_results$sal_cover_avg$GEWA$High$format_mean_cover`%, respectively. The count of species with low and medium salinity tolerance decreased between 2008 to 2012, whereas the count of species with high salinity tolerance remained unchanged (Table 3, Figure 11a). Conversely, the frequency of species with low salinity tolerance increased, whereas the frequency of species with medium and high salinity tolerance remained unchanged (Table 3, Figure 11b). Interestingly, the average cover of species with low salinity tolerance remained unchanged during the study period, whereas the average cover of species with medium and high salinity tolerance decreased between 2008 to 2012 (Table 3, Figure 11c).

```{r Figure 9, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=4, out.width=6.5, out.height=4}
ggdraw(salinity_plot(park = "GEWA"), ylim = c(-0.25,1)) +
  draw_label(bquote(bold("Figure 11.")~"GEWA (a) species count, (b) frequency, and (c) average cover (%) in each salinity"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("tolerance category. Note that frequency values below 0.05 and cover values below 10% are not"), x = 0.02, y = -0.14, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("shown."), x = 0.02, y = -0.2, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

###### *3.5.6* Salinity Tolerance: SAHI
|       At SAHI, no species with low salinity tolerance were found throughout the entire study period. Across the entire study period, the average count of species with medium and high salinity tolerance was `r salinity_results$sal_count_avg$SAHI$Medium$mean_count` and `r salinity_results$sal_count_avg$SAHI$High$mean_count`, respectively. The average frequency of species with medium and high salinity tolerance was `r salinity_results$sal_frq_avg$SAHI$Medium$format_mean_frq` and `r salinity_results$sal_frq_avg$SAHI$High$format_mean_frq`, respectively. The average cover of species with medium and high salinity tolerance was `r salinity_results$sal_cover_avg$SAHI$Medium$format_mean_cover`%, and `r salinity_results$sal_cover_avg$SAHI$High$format_mean_cover`%, respectively. The species count, frequency, and average of species with both medium and high salinity tolerance remained unchanged across the entire study period (Table 3, Figure 12).

```{r Figure 11, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=4, out.width=6.5, out.height=4}
ggdraw(salinity_plot(park = "SAHI"), ylim = c(-0.25,1))+
  draw_label(bquote(bold("Figure 12.")~"SAHI (a) species count, (b) frequency, and (c) average cover (%) in each salinity"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("tolerance category. Note that count values below 1, frequency values below 0.05, and cover values"), x = 0.02, y = -0.14, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("below 10% are not shown."), x = 0.02, y = -0.2, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

##### **3.6** Community Classes
```{r Community Class plot, echo=FALSE, message=FALSE, warning=FALSE}
commun_dfs <- list(
  "commun_count" = site_veg_frq_usda %>%
    ungroup() %>%
    group_by(UnitCode, Year_chr, Community_Class) %>%
    filter(!is.na(Community_Class) & Community_Class != "9") %>%
    summarise(species_count = n_distinct(SciName_cor)) %>%
    mutate(value_label = as.character(round(species_count,0))) %>%
    mutate(value_label = if_else(species_count == 1, NA, as.character(species_count))),
  
  "commun_frq" = plot_veg_cover_usda %>%
    ungroup() %>%
    select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, Community_Class) %>%
    filter(!is.na(Community_Class) & Community_Class != "9") %>%
    group_by(UniqueID, UnitCode, Year_chr) %>%
    mutate(total_site_plots = n_distinct(EventID)) %>%
    group_by(UniqueID, UnitCode, Year_chr, Community_Class) %>%
    mutate(total_site_present = n_distinct(EventID)) %>%
    mutate(site_frq = total_site_present/total_site_plots) %>%
    group_by(UniqueID, UnitCode, Year_chr, Community_Class) %>%
    summarise(mean_site_frq = mean(site_frq)) %>%
    group_by(UnitCode, Year_chr, Community_Class) %>%
    summarise(mean_frq = mean(mean_site_frq),
              se_frq = sd(mean_site_frq)/sqrt(length(mean_site_frq))) %>%
    filter(!is.na(Community_Class)) %>%
    mutate(value_label = format(round(mean_frq,2), nsmall = 2)) %>%
    mutate(value_label = if_else(round(mean_frq,2) <= 0.05, NA, format(round(mean_frq,2), nsmall = 2))),
  
  "commun_cover" = perc_cover %>%
    ungroup() %>%
    left_join(., plot_veg_cover_usda %>%
                ungroup() %>%
                select(UnitCode, Year_chr, SciName_cor, Community_Class),
              by = c("UnitCode", "Year_chr", "SciName_cor")) %>%
    distinct() %>%
    filter(!is.na(Community_Class) & Community_Class != "9") %>%
    group_by(UnitCode, Year_chr, Community_Class) %>%
    summarise(mean_cover = sum(mean_cover, na.rm = TRUE)) %>%
    mutate(value_label = if_else(round(mean_cover,0) <= 10, NA, paste0(format(round(mean_cover,0), nsmall = 0))))
)

commun_results <- list(
  "commun_count_difs" = commun_dfs$commun_count %>%
    group_by(UnitCode, Community_Class) %>%
    mutate(min_year = as.character(min(as.integer(Year_chr))),
           max_year = as.character(max(as.integer(Year_chr)))) %>%
    mutate(is_min_max_year = if_else(Year_chr == min_year | Year_chr == max_year, "T", NA)) %>%
    filter(is_min_max_year == "T") %>%
    mutate(year_grp = if_else(Year_chr == min_year, "min", "max")) %>%
    ungroup() %>%
    select(UnitCode, Community_Class, year_grp, species_count) %>%
    pivot_wider(., names_from = "year_grp", values_from = "species_count") %>%
    mutate(dif = round(max - min,2),
           value_lab = round(max-min,0)) %>%
    filter(dif < -2 | dif > 2),
  
  
  "commun_frq_difs" = commun_dfs$commun_frq %>%
    group_by(UnitCode, Community_Class) %>%
    mutate(min_year = as.character(min(as.integer(Year_chr))),
           max_year = as.character(max(as.integer(Year_chr)))) %>%
    mutate(is_min_max_year = if_else(Year_chr == min_year | Year_chr == max_year, "T", NA)) %>%
    filter(is_min_max_year == "T") %>%
    mutate(year_grp = if_else(Year_chr == min_year, "min", "max")) %>%
    ungroup() %>%
    select(UnitCode, Community_Class, year_grp, mean_frq) %>%
    pivot_wider(., names_from = "year_grp", values_from = "mean_frq") %>%
    mutate(dif = round(max - min,2),
           value_lab = round(max-min,2)) %>%
    filter(dif < -0.05 | dif > 0.05),
  
  "commun_cover_difs" = commun_dfs$commun_cover %>%
    group_by(UnitCode, Community_Class) %>%
    mutate(min_year = as.character(min(as.integer(Year_chr))),
           max_year = as.character(max(as.integer(Year_chr)))) %>%
    mutate(is_min_max_year = if_else(Year_chr == min_year | Year_chr == max_year, "T", NA)) %>%
    filter(is_min_max_year == "T") %>%
    mutate(year_grp = if_else(Year_chr == min_year, "min", "max")) %>%
    ungroup() %>%
    select(UnitCode, Community_Class, year_grp, mean_cover) %>%
    pivot_wider(., names_from = "year_grp", values_from = "mean_cover", values_fill = 0) %>%
    mutate(dif = round(max - min,0),
           value_lab = round(max-min,0)) %>%
    filter(dif < -10 | dif > 10)
)
```

```{r Table 4, echo=FALSE, message=FALSE, warning=FALSE}
plot_veg_cover_usda %>%
  ungroup() %>%
  select(UnitCode, Community_Class) %>%
  distinct() %>%
  filter(Community_Class != "9" & !is.na(Community_Class)) %>%
  left_join(., commun_results$commun_count_difs %>%
              select(UnitCode, Community_Class, "count_dif" = value_lab),
            by = c("UnitCode", "Community_Class")) %>%
  left_join(., commun_results$commun_frq_difs %>%
              select(UnitCode, Community_Class, "frq_dif" = value_lab), 
            by = c("UnitCode", "Community_Class")) %>%
  left_join(., commun_results$commun_cover_difs %>%
              select(UnitCode, Community_Class, "cover_dif" = value_lab), 
            by = c("UnitCode", "Community_Class")) %>%
  mutate(count_dif = case_when(count_dif > 2 ~ paste0("↑ +", count_dif),
                               count_dif < -2 ~ paste0("↓ ", count_dif),
                               count_dif >= -2 & count_dif <= 2 | is.na(count_dif) ~ "-"),
         frq_dif = case_when(frq_dif > 0.05 ~ paste0("↑ +", frq_dif),
                             frq_dif < -0.05 ~ paste("↓ ", frq_dif),
                             frq_dif >= -0.05 & frq_dif <= 0.05 | is.na(frq_dif) ~ "-"),
         cover_dif = case_when(cover_dif > 10 ~ paste0("↑ +", cover_dif, "%"),
                               cover_dif < -10 ~ paste0("↓ ", cover_dif, "%"),
                               cover_dif >= -10 & cover_dif <= 10 | is.na(cover_dif) ~ "-"),
         Community_Class = case_when(Community_Class == "freshwater wetland" ~ "Freshwater wetland",
                                     Community_Class == "salt marsh" ~ "Salt marsh",
                                     Community_Class == "salt marsh open ditch" ~ "Salt marsh open ditch",
                                     Community_Class == "salt marsh plugged ditch" ~ "Salt marsh plugged ditch",
                                     Community_Class == "salt marsh pool/panne" ~ "Salt marsh pool/panne",
                                     Community_Class == "salt marsh shoreline" ~ "Salt marsh shoreline",
                                     Community_Class == "tidal creek" ~ "Tidal creek",
                                     Community_Class == "tidal lagoon" ~ "Tidal lagoon")) %>%
  arrange(UnitCode, Community_Class)  %>%
  flextable(.) %>%
  set_header_labels(., UnitCode = "Park", Community_Class = "Community Classification", count_dif = "Species Count", frq_dif = "Frequency", cover_dif = "Average cover") %>%
  align(., align = "center", part = "all") %>%
  highlight(., j = "count_dif", i = ~ count_dif != "-", color = "#FF7C80") %>%
  highlight(., j = "frq_dif", i = ~str_detect(frq_dif, "^-$", negate = T), color = "#FF7C80") %>%
  highlight(., j = "frq_dif", i = ~str_detect(frq_dif, "\\+"), color = "#84E084") %>%
  highlight(., j = "cover_dif", i = ~str_detect(cover_dif, "^-$", negate = T), color = "#FF7C80") %>%
  highlight(., j = "cover_dif", i = ~str_detect(cover_dif, "\\+"), color = "#84E084") %>%
  padding(., padding.top = 3, padding.bottom = 3, part = "body") %>%
   add_header_lines(., values = c("Table 4. Trends in species count, frequency, and average cover of species in each community classification category between the first and last sampling event at each park.")) %>%
  align(., i = 1, align = "left", part = "header") %>%
  merge_v(., j = "UnitCode") %>%
  fix_border_issues() %>%
  hline(., i = c(5,12,19,26,33), border = fp_border(color = "black")) %>%
  set_table_properties(., width = 0.75, layout = "autofit") 
```
&nbsp;

```{r Community Plot, message=FALSE, warning=FALSE, include=FALSE}
commun_plot <- function(park) {
  
  commun_count <- commun_dfs$commun_count %>%
    filter(UnitCode == park)
  
  commun_frq <- commun_dfs$commun_frq %>%
    filter(UnitCode == park)
  
  commun_cover <- commun_dfs$commun_cover %>%
    filter(UnitCode == park)
  
  labfun <- function(metric_df, metric_name) {
    f <- metric_df %>%
      ungroup() %>%
      mutate(Community_Class = case_when(Community_Class == "freshwater wetland" ~ "Freshwater\nwetland",
                                         Community_Class == "salt marsh" ~ "Salt marsh",
                                         Community_Class == "salt marsh open ditch" ~ "Salt marsh\nopen ditch",
                                         Community_Class == "salt marsh plugged ditch" ~ "Salt marsh\nplugged ditch",
                                         Community_Class == "salt marsh pool/panne" ~ "Salt marsh\npool/panne",
                                         Community_Class == "salt marsh shoreline" ~ "Salt marsh\nshoreline",
                                         Community_Class == "tidal creek" ~ "Tidal creek",
                                         Community_Class == "tidal lagoon" ~ "Tidal\nlagoon"),
             Year = as.Date(paste0(Year_chr, "-01-01"))) %>%
      filter(!is.na(Community_Class))
  }
  
  commun_count2 <- labfun(metric_df = commun_count, metric_name = "species_count")
  commun_frq2 <- labfun(metric_df = commun_frq, metric_name = "mean_frq")
  commun_cover2 <- labfun(metric_df = commun_cover, metric_name = "mean_cover")
  
  ggfun <- function(metric_df2, metric_name, park_name = park){
    
    if(metric_name == "species_count") {
      letter_lab <- "(A)"
      metric_lab <- "Species count (n)"
      max_y <- 42
      value_text_size <- 3.5
      y_breaks <- seq(0,40, by = 10)
    } else if(metric_name == "mean_frq") {
      letter_lab <- "(B)"
      metric_lab <- "Frequency"
      if(park_name == "ASIS"){
        max_y <- 2.16
        y_breaks <- seq(0,2, by = 0.4)
      } else if(park_name == "COLO"){
        max_y <- 1.94
        y_breaks <- seq(0,2, by = 0.4)
      } else if(park_name == "FIIS"){
        max_y <- 2.50
        y_breaks <- seq(0,2.4, by = 0.5)
      } else if(park_name == "GATE") {
        max_y <- 1.84
        y_breaks <- seq(0,2, by = 0.4)
      } else if(park_name == "GEWA") {
        max_y <- 2.75
        y_breaks <- seq(0, 2.75, by = 0.5)
      } else if(park_name == "SAHI") {
        max_y <- 1.52
        y_breaks <- seq(0,1.6, by = 0.3)
      }
      value_text_size <- 2.5
    } else if(metric_name == "mean_cover") {
      letter_lab <- "(C)"
      metric_lab <- "Cover (%)"
      max_y <- 140
      y_breaks <- seq(0,125, by = 25)
      value_text_size <- 3.5
    }
    
    gg_color_hue <- function(n) {
      hues = seq(15, 375, length = n + 1)
      hcl(h = hues, l = 65, c = 100)[1:n]
    }
    
    full_pal <- gg_color_hue(n = 8)
    
    if(park_name == "ASIS") {
      pal <- full_pal[c(3:6,8)]
    } else if(park_name %in% c("COLO", "GEWA")) {
      pal <- full_pal[c(1,3:8)]
    } else if(park_name %in% c("FIIS", "GATE")) {
      pal <- full_pal[c(2:8)]
    } else if(park_name == "SAHI") {
      pal <- full_pal[c(3:5,7:8)]
    }
    
    park_lab <- paste0(park_name, ":")
    
    if(metric_name == "mean_frq"){
      x_title_color <- "black"
    } else {
      x_title_color <- "transparent"
    }
    
    metric_df2 %>%
      ggplot(., aes(x = Year, y = eval(sym(metric_name)))) +
      geom_col(aes(fill = Community_Class), color = "black") +
      geom_text(aes(label = value_label, group = Community_Class), color = "black", position = position_stack(vjust = 0.5), size = value_text_size, family = "serif", hjust = 0.5, show.legend = FALSE) +
      annotate("text", label = deparse(bquote(bold(.(letter_lab)))), x = structure(-Inf, class = "Date"), y = Inf, hjust = -0.3, vjust = 1.5, size = 3.5, fontface = "bold", family = "serif", parse = T) +
      scale_fill_manual(values = pal) +
      scale_x_date(date_breaks = "2 year", date_labels = "'%y") +
      scale_y_continuous(limits = c(0,max_y), breaks = y_breaks, expand = c(0,0), name = metric_lab, sec.axis = dup_axis()) +
      guides(fill = guide_legend(reverse = FALSE)) +
      theme(
        text = element_text(size = 12, family = "serif", color = "black"),
        panel.border = element_rect(color = "black", fill = NA),
        panel.background = element_blank(),
        panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
        panel.grid.minor = element_blank(),
        axis.ticks.length.x = unit(0, "pt"),
        axis.ticks.length.y = unit(-4, "pt"),
        axis.title.y.right = element_blank(),
        axis.title.y.left = element_text(size = 12, margin = margin(r = 5, unit = "pt")),
        axis.text.y.left = element_text(size = 12, color = "black"),
        axis.title.x = element_text(size = 12, color = x_title_color, margin = margin(5,0,5,0, "pt")),
        axis.text.y.right = element_blank(),
        axis.text.x = element_text(size = 12, color = "black"),
        legend.margin = margin(0,0,5,0,"pt"),
        legend.text = element_text(size = 12),
        legend.title = element_blank(),
        legend.direction = "horizontal",
        legend.background = element_rect(fill = "transparent")
      )
  }
  
  count_plot <- ggfun(metric_df2 = commun_count2, metric_name = "species_count")
  frq_plot <- ggfun(metric_df2 = commun_frq2, metric_name = "mean_frq") +
    theme(legend.position = "none")
  cover_plot <- ggfun(metric_df2 = commun_cover2, metric_name = "mean_cover") +
    theme(legend.position = "none")
  
  legend <- cowplot::get_legend(count_plot)
  count_plot <- count_plot + theme(legend.position = "none")
  
  if(park %in% c("ASIS", "SAHI")){
    ggdraw(plot_grid(plot_grid(count_plot, frq_plot, cover_plot, nrow = 1, byrow = T),
                     plot_grid(NULL, legend, NULL, nrow = 1, byrow = T, rel_widths = c(0.1, 1, 0.1)),
                     rel_heights = c(1,0.06), nrow = 2))
  } else {
    ggdraw(plot_grid(plot_grid(count_plot, frq_plot, cover_plot, nrow = 1, byrow = T),
                     NULL,
                     plot_grid(NULL, legend, NULL, nrow = 1, byrow = T, rel_widths = c(0.1, 1, 0.1)),
                     rel_heights = c(0.9,0.05,0.1), nrow = 3))
  }
  
}
```

##### *3.6.1* Community Classes: ASIS
|       The species present at ASIS were classified as either salt marsh open ditch, salt marsh plugged ditch, salt marsh pool/panne, salt marsh shoreline, or tidal lagoon. The count of species in the salt marsh open ditch class decreased between 2008 to 2018 (Figure 13a). Species classified as salt marsh shoreline were not found in 2011 and 2014 (Figure 13a). The count of species in the salt marsh plugged ditched, salt marsh pool/panne, and tidal lagoon classes remained unchanged (Figure 13a). The frequency of species in the salt marsh pool/panne class decreased, whereas the frequency of species in the remaining four classes remained unchanged (Figure 13b). The average cover of species in the salt marsh open ditch, salt marsh shoreline, and salt marsh pool/panne classes decreased whereas the average cover of species in the salt marsh plugged ditch and tidal lagoon classes remained unchanged (Figure 13c). 

```{r Figure 13, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=5, out.width=6.5, out.height=5}
ggdraw(commun_plot("ASIS"), ylim = c(-0.2,1)) +
  draw_label(bquote(bold("Figure 13.")~"ASIS (a) species count, (b) frequency, and (c) average cover (%) in each community"), x = 0.02, y = -0.07, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("class. Note that count values below 1, frequency values below 0.05, and cover values below 10%"), x = 0.02, y = -0.12, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("are not shown."), x = 0.02, y = -0.17, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

###### *3.6.2* Community Classes: COLO
|       The species present at COLO were classified as either freshwater wetland, salt marsh open ditch, salt marsh plugged ditch, salt marsh pool/panne, salt marsh shoreline, tidal lagoon, or tidal creek. Only a single species in the freshwater wetland class was found between 2010 and 2012 (*Brasenia schreberi* in 2008 and *Hydrocotyle verticillata* in 2010 and 2012); no freshwater wetland species were found in 2014 and 2016 (Figure 14a). Similarly, species classified as salt marsh shoreline were not found in 2012 and 2016; whereas species classified as tidal lagoon were not found in 2016 or 2018 (Figure 14a). The count of species in the remaining four classes (salt marsh open ditch, salt marsh plugged ditch, salt marsh pool/panne, and tidal creek) remained unchanged (Figure 14a). The frequency of species in the salt marsh pool/panne class decreased, whereas the frequency of species in the remaining three classes remained unchanged (Figure 14b). The average cover of species in the freshwater wetland, salt marsh shoreline, and tidal lagoon classes decreased whereas the average cover of species in the salt marsh open ditch, salt marsh plugged ditch, salt marsh pool/panne, and tidal creek classes remained unchanged (Figure 14c). 

```{r Figure 14, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=5, out.width=6.5, out.height=5}
ggdraw(commun_plot("COLO"), ylim = c(-0.2,1)) +
  draw_label(bquote(bold("Figure 14.")~"COLO (a) species count, (b) frequency, and (c) average cover (%) in each community"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("class. Note that count values below 1, frequency values below 0.05, and cover values below 10%"), x = 0.02, y = -0.12, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("are not shown."), x = 0.02, y = -0.16, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

###### *3.6.3* Community Classes: FIIS
|       The species present at FIIS were classified as either salt marsh, salt marsh open ditch, salt marsh plugged ditch, salt marsh pool/panne, salt marsh shoreline, tidal creek, or tidal lagoon. Only a single species in the freshwater wetland class was found 2009 (*Cakile edentula*); no freshwater wetland species were found between 2011 to 2017 (Figure 15a). Similarly, species classified as salt marsh shoreline were found in 2011 and 2015 but were not found again in any other years (Figure 15a). The frequency of species classified as salt marsh pool/panne decreased slightly between 2009 to 2017, whereas the frequency of species in the salt marsh open ditch, salt marsh plugged ditch, tidal creek, and tidal lagoon classes remained unchanged (Figure 15b). The cover of species in the salt marsh, salt marsh pool/panne, and salt marsh shoreline decreased between 2009 to 2017, whereas the cover of species in the salt marsh open ditch, salt marsh plugged ditch, tidal creek, and tidal lagoon classes remained unchanged over the sampling period (Figure 15c).

```{r Figure 15, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=5, out.width=6.5, out.height=5}
ggdraw(commun_plot("FIIS"), ylim = c(-0.2,1)) +
  draw_label(bquote(bold("Figure 15.")~"FIIS (a) species count, (b) frequency, and (c) average cover (%) in each community"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("class. Note that count values below 1, frequency values below 0.05, and cover values below 10% "), x = 0.02, y = -0.12, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("are not shown."), x = 0.02, y = -0.16, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

###### *3.6.4* Community Classes: GATE
|       The species present at GATE were classified as either salt marsh, salt marsh open ditch, salt marsh plugged ditch, salt marsh pool/panne, salt marsh shoreline, tidal creek, or tidal lagoon. The count of species in the salt marsh, salt marsh plugged ditch, salt marsh pool/panne, tidal creek, and tidal lagoon classes remained unchanged between 2010 to 2018. The count of species in the salt marsh open ditch class decreased over time, and no species in the salt marsh shoreline class were found in 2012 or 2014 (Figure 16a). The frequency of species classified as salt marsh plugged ditch decreased between 2010 to 2018 whereas the frequency of species in the remaining six classes remained unchanged (Figure 16b). The cover of species in the salt marsh, salt marsh open ditch, salt marsh plugged ditch, and salt marsh pool/panne classes decreased over the sampling period, whereas the cover of species in the salt marsh shoreline, tidal creek, and tidal lagoon classes remained unchanged over time (Figure 16c). Note that differences between the year 2014 and other years are most likely related to the fact that only 1 site (out of 3) was sampled in 2014.

```{r Figure 16, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=5, out.width=6.5, out.height=5}
ggdraw(commun_plot("GATE"), ylim = c(-0.2,1)) +
  draw_label(bquote(bold("Figure 16.")~"GATE (a) species count, (b) frequency, and (c) average cover (%) in each community"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("class. Note that count values below 1, frequency values below 0.05, and cover values below 10%"), x = 0.02, y = -0.12, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("are not shown."), x = 0.02, y = -0.16, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

###### *3.6.5* Community Classes: GEWA
|       The species present at GEWA were classified as either freshwater wetland, salt marsh open ditch, salt marsh plugged ditch, salt marsh pool/panne, tidal creek, or tidal lagoon. Only a single species classified as freshwater wetland was found in 2008 (*Brasenia schreberi*) and 2010 (*Hydrocotyle verticillata*); no freshwater wetland species were found in 2012 (Figure 17a). Similarly, no species classified as tidal lagoon were found in 2008, but a single species (*Spartina alterniflora*) was found in both 2010 and 2012 (Figure 17a). The count of species classified as salt marsh open ditch decreased between 2008 to 2012, whereas the count of species in the remaining three categories remained unchanged (Figure 17a). Interestingly, the frequency of species in the tidal lagoon class fluctuated substantially from 0 in 2008, to 0.76 in 2010, and back to 0.08 in 2012, whereas the frequency of species the remaining five classes remained unchanged over time (Figure 17b). Similarly, the cover of species in the tidal lagoon class also fluctuated substantially from 0 in 2008, to 51% in 2010, and back to 2% in 2012 (Figure 17c). The cover of species in the freshwater wetland and salt marsh open ditch classes decreased between 2008 to 2012, whereas the cover of species in the salt marsh plugged ditch, salt marsh pool/panne, salt marsh shoreline, and tidal creek classes increased over the same time (Figure 17c).

```{r Figure 17, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=5, out.width=6.5, out.height=5}
ggdraw(commun_plot("GEWA"), ylim = c(-0.2,1)) +
  draw_label(bquote(bold("Figure 17.")~"GEWA (a) species count, (b) frequency, and (c) average cover (%) in each community"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("class. Note that count values below 1, frequency values below 0.05, and cover values below 10%"), x = 0.02, y = -0.12, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("are not shown."), x = 0.02, y = -0.16, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

###### *3.6.6* Community Classes: SAHI
|       The species present at SAHI were classified as either salt marsh open ditch, salt marsh plugged ditch, salt marsh pool/panne, tidal creek, or tidal lagoon. Only a single species classified as tidal creek - *Bassia hyssopifolia* - was found in 2009 (Figure 18a). Similarly, no species in the salt marsh open ditch class were found in 2013 (Figure 18a). The count of species in the salt marsh plugged ditch, salt marsh pool/panne, and tidal lagoon classes remained unchanged over the study period (Figure 18a). Frequency of the tidal creek and salt marsh pool/panne class decreased over the study period, whereas the frequency of the remaining three classes remained unchanged (Figure 18b). Only the cover of species in the salt marsh open ditch and tidal lagoon (i.e., *Spartina alterniflora*) classes increased over the sampling period, whereas cover of the other classes remained unchanged over time (Figure 18c).

```{r Figure 18, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6.5, fig.height=5, out.width=6.5, out.height=5}
ggdraw(commun_plot("SAHI"), ylim = c(-0.2,1)) +
  draw_label(bquote(bold("Figure 18.")~"SAHI (a) species count, (b) frequency, and (c) average cover (%) in each community"), x = 0.02, y = -0.08, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("class. Note that count values below 1, frequency values below 0.05, and cover values below 10%"), x = 0.02, y = -0.12, size = 12, fontfamily = "serif", hjust = 0) +
  draw_label(bquote("are not shown."), x = 0.02, y = -0.16, size = 12, fontfamily = "serif", hjust = 0)
```
&nbsp;

##### **3.7** Community Composition
```{r Community Composition, echo=FALSE, message=FALSE, warning=FALSE}
species_matrix <- plot_veg_cover_usda %>%
  ungroup() %>%
  select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, PercentCover) %>%
  group_by(EventID, UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  pivot_wider(., names_from = "SciName_cor", values_from = "PercentCover", values_fill = 0) %>%
  ungroup() %>%
  filter(complete.cases(.))

# ADONIS
ado <- function(park){
  
  set.seed(10403)
  
  ado_species <- species_matrix %>%
    arrange(EventID, UniqueID, UnitCode, Year_chr) %>%
    filter(UnitCode == park) %>%
    select(-c(EventID, UniqueID, UnitCode, Year_chr))
  
  ado_env <- species_matrix %>%
    arrange(EventID, UniqueID, UnitCode, Year_chr) %>%
    filter(UnitCode == park) %>%
    select(EventID, UniqueID, Year_chr) %>%
    distinct()
  
  ado_mod <- adonis2(ado_species ~ Year_chr, data = ado_env)
  
  if(park == "SAHI") {
    ado_pairwise <- pairwiseAdonis::pairwise.adonis(ado_species, ado_env$Year_chr, p.adjust.m = "fdr") %>%
      filter(p.adjusted < 0.1)
  } else {
    ado_pairwise <- pairwiseAdonis::pairwise.adonis(ado_species, ado_env$Year_chr, p.adjust.m = "fdr") %>%
      filter(p.adjusted < 0.05)
  }
  
  list("species" = ado_species, "env" = ado_env, "mod" = ado_mod, "pairwise" = ado_pairwise)
}

# I ran these 1 at a time because ASIS and FIIS take a long time (~45 min each)
# ado_asis <- ado("ASIS")
# save(ado_asis, file = "./data/derived/adonis/asis_adonis.rda")
# ado_colo <- ado("COLO")
# save(ado_colo, file = "./data/derived/adonis/colo_adonis.rda")
# ado_fiis <- ado("FIIS")
# save(ado_fiis, file = "./data/derived/adonis/fiis_adonis.rda")
# ado_gate <- ado("GATE")
# save(ado_gate, file = "./data/derived/adonis/gate_adonis.rda")
# ado_gewa <- ado("GEWA")
# save(ado_gewa, file = "./data/derived/adonis/gewa_adonis.rda")
# ado_sahi <- ado("SAHI")
# save(ado_sahi, file = "./data/derived/adonis/sahi_adonis.rda")

# load adonis models
adonis <- list.files(here::here("data", "derived", "adonis"), pattern = ".rda", full.names = TRUE) %>%
  map(~get(load(.))) %>%
  set_names(., nm = sort(unique(plot_veg_cover_usda$UnitCode)))


# SIMPER
# set.seed(10403)
simper_fun <- function(park){
  
  simper_species <- species_matrix %>%
    arrange(EventID, UniqueID, UnitCode, Year_chr) %>%
    filter(UnitCode == park) %>%
    select(-c(EventID, UniqueID, UnitCode, Year_chr))
  
  simper_env <- species_matrix %>%
    filter(UnitCode == park) %>%
    select(EventID, UniqueID, Year_chr) %>%
    distinct()
  
  simper_mod <- with(simper_env, simper(simper_species, Year_chr, permutations = 999)) 
}

# I ran these 1 at a time because ASIS and FIIS take a long time
# asis_simper <- simper_fun("ASIS")
# save(asis_simper, file = "./data/derived/simper/asis_simper.rda")
# colo_simper <- simper_fun("COLO")
# save(colo_simper, file = "./data/derived/simper/colo_simper.rda")
# fiis_simper <- simper_fun("FIIS")
# save(fiis_simper, file = "./data/derived/simper/fiis_simper.rda")
# gate_simper <- simper_fun("GATE")
# save(gate_simper, file = "./data/derived/simper/gate_simper.rda")
# gewa_simper <- simper_fun("GEWA")
# save(gewa_simper, file = "./data/derived/simper/gewa_simper.rda")
# sahi_simper <- simper_fun("SAHI")
# save(sahi_simper, file = "./data/derived/simper/sahi_simper.rda")

# load simper models
# simper <- list.files(here::here("data", "derived", "simper"), pattern = ".rda", full.names = TRUE) %>%
#   map(~get(load(.))) %>%
#   set_names(., nm = sort(unique(plot_veg_cover_usda$UnitCode)))


# KRUSKAL
# load kruskal test results
# note: kruskal tests were run using 'park_kruskals.R'
kruskal <- list.files(here::here("data", "derived", "kruskal"), pattern = ".rda", full.names = TRUE) %>%
  map(~get(load(.))) %>%
  set_names(., nm = sort(unique(plot_veg_cover_usda$UnitCode)))

# get list of species with significant differences between years
kruskal_species_fun <- function(park) {

  if(park == "ASIS") {
    year_combos <- c(str_replace(adonis$ASIS$pairwise$pairs, " vs ", "_"))
  } else if(park == "COLO") {
    year_combos <- c(str_replace(adonis$COLO$pairwise$pairs, " vs ", "_"))
  } else if(park == "FIIS") {
    year_combos <- c(str_replace(adonis$FIIS$pairwise$pairs, " vs ", "_"))
  } else if(park == "GATE") {
    year_combos <- c(str_replace(adonis$GATE$pairwise$pairs, " vs ", "_"))
  } else if(park == "GEWA") {
    year_combos <- c(str_replace(adonis$GEWA$pairwise$pairs, " vs ", "_"))
  } else if(park == "SAHI") {
    year_combos <- c(str_replace(adonis$SAHI$pairwise$pairs, " vs ", "_"))
  }
  
  year_combo_list <- map_chr(year_combos, ~paste0("mod_p_", .x))
  
  kruskal %>%
    pluck(park) %>%
    ungroup() %>%
    select(UnitCode, SciName_cor, year_combo_list) %>%
    unnest() %>%
    pivot_longer(., cols = -c("UnitCode", "SciName_cor"), names_to = "year_pair", values_to = "p_val") %>%
    filter(p_val < 0.05) %>%
    mutate(year_combo = paste0(str_sub(year_pair, 7, 10), " vs ", str_sub(year_pair, 12, 15)))
}

kruskal_park_species <- list("ASIS", "COLO", "FIIS", "GATE", "GEWA", "SAHI") %>%
  map(., ~kruskal_species_fun(.x)) %>%
  set_names(., nm = sort(unique(c("ASIS", "COLO", "FIIS", "GATE", "GEWA", "SAHI"))))
```

```{r Adonis plot, echo=FALSE, message=FALSE, warning=FALSE}
ado_plot <- function(park){

  include_vector <- adonis %>% pluck(park) %>% pluck("pairwise") %>% pluck("pairs")

  park_cover <- plot_veg_cover_usda %>% 
    filter(UnitCode == park) %>%
    ungroup() %>%
    select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, PercentCover) %>%
    group_by(EventID, UniqueID, UnitCode, Year_chr, SciName_cor) %>%
    pivot_wider(., names_from = "SciName_cor", values_from = "PercentCover", values_fill = 0) %>%
    pivot_longer(., cols = -c("EventID", "UniqueID", "UnitCode", "Year_chr"), names_to = "SciName_cor", values_to = "PercentCover") %>%
    group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
    summarise(mean_site_cover = mean(PercentCover, na.rm = TRUE)) %>%
    group_by(UnitCode, Year_chr, SciName_cor) %>%
    summarise(mean_cover = mean(mean_site_cover, na.rm = TRUE)) 
  
  years <- park_cover %>%
    group_by(UnitCode) %>%
    mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
           first_date = as.integer(lubridate::year(min(Year))),
           last_date = as.integer(lubridate::year(max(Year)))) %>%
    ungroup() %>%
    select(first_date, last_date) %>%
    distinct()

  year_list <- as.list(seq(years$first_date, years$last_date, by = 2)) %>% map(., ~as.character(.x))
  
  year_list_combos <- as.data.frame(expand.grid("col1" = year_list, "col2" = year_list))

  df_filter_fun <- function(year1, year2) {
    park_year1 <- park_cover %>% filter(Year_chr == year1)
    park_year2 <- park_cover %>% filter(Year_chr == year2)
    
    park_year1_year2 <- full_join(park_year1, park_year2, by = "SciName_cor") %>%
      mutate(cover_dif = mean_cover.y - mean_cover.x)
    
    return(park_year1_year2)
  } 
  
  df_names <- year_list_combos %>%
    mutate(names = paste0(park, "_", col1, "_", col2)) %>%
    pull(names)

  park_species_difs <- map2(
    year_list_combos$col1, 
    year_list_combos$col2, 
    ~df_filter_fun(year1 = .x, year2 = .y)) %>%
    set_names(., nm = df_names) %>%
    bind_rows() %>%
    mutate(year_combo = paste0(Year_chr.x, " vs ", Year_chr.y))
  
  points_df <- park_species_difs %>% 
    left_join(., kruskal_park_species %>% pluck(park), by = c("SciName_cor", "year_combo")) %>% 
    filter(!is.na(p_val)) %>%
    ungroup() %>%
    select(SciName_cor, year_combo, Year_chr.x, mean_cover.x, Year_chr.y, mean_cover.y) %>%
    pivot_longer(., cols = -c(SciName_cor, year_combo), names_to = c(".value", "group"), names_sep ="\\.") %>%
    select(-group) %>%
    mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
           SciName_cor_lab = if_else(SciName_cor %in%c("Carex", "Salicornia", "Juncus", "Rumex", "Polygonum"), paste0(SciName_cor, " spp."), SciName_cor))
  
  points_dfb <- points_df %>%
    ungroup() %>%
    select(year_combo, Year_chr, mean_cover, SciName_cor) %>%
    group_by(year_combo, SciName_cor) %>%
    mutate(cover_dif = max(mean_cover)-min(mean_cover)) %>%
    group_by(year_combo) %>%
    {if (park %in% c("ASIS", "COLO", "GATE", "SAHI")) slice_max(., order_by = cover_dif, n = 5)
      else if (park == "FIIS") slice_max(., order_by = cover_dif, n = 4)
      else .} %>%
    mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
           SciName_cor_lab = if_else(SciName_cor %in%c("Carex", "Salicornia", "Juncus", "Rumex", "Polygonum"), paste0(SciName_cor, " spp."), SciName_cor))
  
  lines_df <- plot_veg_cover_usda %>%
    filter(UnitCode == park) %>%
    select(EventID, SubunitCode, UniqueID, UnitCode, Year_chr, SciName_cor, PercentCover) %>%
    pivot_wider(., names_from = "SciName_cor", values_from = "PercentCover", values_fill = 0) %>%
    pivot_longer(., cols = -c("EventID", "SubunitCode", "UniqueID", "UnitCode", "Year_chr"), names_to = "SciName_cor", values_to = "PercentCover") %>%
    group_by(UnitCode, UniqueID, SciName_cor, Year_chr) %>%
    summarise(mean_site_cover = mean(PercentCover, na.rm = TRUE)) %>%
    group_by(UnitCode, Year_chr, SciName_cor) %>%
    summarise(mean_cover = mean(mean_site_cover, na.rm = TRUE)) %>%
    filter(SciName_cor %in% c(points_dfb %>% pull(SciName_cor) %>% unique())) %>%
    arrange(SciName_cor, Year_chr) %>%
    left_join(., points_dfb %>% select(SciName_cor, year_combo), by = "SciName_cor", relationship = "many-to-many") %>%
    mutate(Year = as.Date(paste0(Year_chr, "-01-01")),
           SciName_cor_lab = if_else(SciName_cor %in%c("Carex", "Salicornia", "Juncus", "Rumex", "Polygonum"), paste0(SciName_cor, " spp."), SciName_cor))
  
  dummy_df <- lines_df %>%
    group_by(year_combo) %>%
    {if (park %in% c("ASIS", "COLO")) mutate(., ylim = max(mean_cover) + 0.2*max(mean_cover))
      else if(park == "GEWA") mutate(., ylim = max(mean_cover) + 0.15*max(mean_cover))
      else mutate(., ylim = max(mean_cover) + 0.40*max(mean_cover))}
  
  if (park == "ASIS"){
    xlims <- c(as.Date("2008-01-01"), as.Date("2018-01-01"))
    xbreaks <- seq.Date(as.Date("2008-01-01"), as.Date("2018-01-01"), by = "2 years")
    legend_col <- 3
  } else if (park == "COLO"){
    xlims <- c(as.Date("2008-01-01"), as.Date("2016-01-01"))
    xbreaks <- seq.Date(as.Date("2008-01-01"), as.Date("2016-01-01"), by = "2 years")
    legend_col <- 1
  } else if (park == "FIIS"){
    xlims <- c(as.Date("2009-01-01"), as.Date("2017-01-01"))
    xbreaks <- seq.Date(as.Date("2009-01-01"), as.Date("2017-01-01"), by = "2 years")
    legend_col <- 1
  } else if (park == "GATE"){
    xlims <- c(as.Date("2010-01-01"), as.Date("2018-01-01"))
    xbreaks <- seq.Date(min(xlims), max(xlims), by = "2 years")
    legend_col <- 3
  } else if (park == "GEWA"){
    xlims <- c(as.Date("2008-01-01"), as.Date("2012-01-01"))
    xbreaks <- seq.Date(as.Date("2008-01-01"), as.Date("2012-01-01"), by = "1 year")
    legend_col <- 3
  } else if (park == "SAHI"){
    xlims <- c(as.Date("2009-01-01"), as.Date("2017-01-01"))
    xbreaks <- seq.Date(min(xlims), max(xlims), by = "2 years")
    legend_col <- 3
  }
  
  ggplot(lines_df, aes(x = Year, y = mean_cover, color = SciName_cor_lab, fill = SciName_cor_lab)) +
    geom_blank(data = dummy_df, aes(x = Year, y = ylim)) +
    geom_line() +
    geom_point(data = points_dfb, aes(x = Year, y = mean_cover,), size = 2, color = "black", shape = 21) +
    geom_text(data = lines_df %>%
                ungroup() %>%
                distinct(year_combo) %>%
                arrange(year_combo) %>%
                mutate(letter = paste0("(",LETTERS[1:n()], ")"),
                       f = pmap_chr(list(letter, year_combo), function(a, b) deparse(bquote(bold(.(a)~plain(.(b))))))),
              aes(x = structure(-Inf, class = "Date"), y =  Inf, label = f),
              hjust = -0.1, vjust = 1.5, size  = 3.5, fontface = "bold", family = "serif", parse = T, inherit.aes = F) +
    lemon::facet_rep_wrap(~year_combo, scales = "free_y") +
    scale_y_continuous(name = "Average cover (%)", sec.axis = dup_axis()) +
    scale_x_date(limits = xlims, breaks = xbreaks, date_labels = "'%y", sec.axis = dup_axis()) +
    guides(color = guide_legend(title = "Species:", ncol = legend_col), fill = guide_legend(title = "Species:", ncol = legend_col)) +
    lfeheR::theme(base_size = 12) +
    theme(
      axis.title.y = element_text(margin = margin(r = 10, unit = "pt")),
      text = element_text(family = "serif", size = 12),
      legend.key = element_rect(color = "transparent"),
      legend.text = element_text(face = "italic"),
      legend.position = "bottom",
      legend.title.position = "top",
      legend.title = element_text(hjust = 0),
      legend.margin = margin(t = 0, unit = "pt"),
      legend.key.spacing.y = unit(0, "pt"),
      legend.justification = 0.5,
      panel.grid.major = element_line(color = "grey", linewidth = 0.5, linetype = "dashed"),
      panel.spacing = unit(10, "pt"),
      strip.background = element_blank(),
      strip.text = element_blank()
    )
}
```

###### *3.7.1* Community Composition: ASIS
|       At ASIS, there was a significant difference in community composition between years (*R*2 = `r format(round(adonis$ASIS$mod$R2[1], 2), nsmall = 2)`, *p* < 0.001). An examination of the pairwise comparisons between years at ASIS found significant differences between all year pairs (Figure 19). Only the species with the top five greatest changes in cover that contributed to the differences between these 15 year-pairs at ASIS are shown in Figure 19. Additional species with significant differences in cover between at least one year pair at ASIS include *Atriplex patula*, *Elymus virginicus*, *Eragrostis spp.*, *Iva frutescens*, *Juncus gerardii*, *Limonium carolinianum*, *Schoenoplectus pungens var. pungens*, and *Smilax rotundifolia*.

```{r Figure 17, echo=FALSE, fig.height=8, fig.width=6.5, message=FALSE, warning=FALSE, out.height=8, out.width=6.5}
ggdraw() +
  draw_plot(ado_plot("ASIS") + theme(legend.title = element_text(hjust = 0.5, margin = margin(0,0,5,0, "pt"))), y = 0.09, height = 0.91) +
  draw_label(bquote(bold("Figure 19.")~"ASIS: The change in cover (%) of species contributing to differences between significantly"), x = 0.02, y = 0.07, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("different year-pairs identified by ADONIS analysis. Note that only the species with the top five")), x = 0.02, y = 0.045, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("greatest changes in cover that contributed to the differences between year-pairs are shown.")), x = 0.02, y = 0.02, fontfamily = "serif", hjust = 0, size = 12)
```
&nbsp;

##### *3.7.2* Community Composition: COLO
|       At COLO, there was a significant difference in community composition between years (*R*2 = `r format(round(adonis$COLO$mod$R2[1], 2), nsmall = 2)`, *p* < 0.001). An examination of the pairwise comparisons between years at COLO found significant differences between all year pairs (Figure 20). Only the species with the top five greatest changes in cover that contributed to the differences between these ten year-pairs at COLO are shown in Figure 20. Additional species with significant differences in cover between at least one year pair at COLO include *Amaranthus cannabinus*, *Carex hyalinolepsis*, *Carex lurida*, *Eleocharis parvula*, *Juncus effusus*, *Juncus gerardii*, *Juncus roemarianus*, *Juncus tenuis*, *Leersia oryzoides*, *Lythrum lineare*, *Mikania scandens*, *Phragmites australis*, *Pluchea odorata*, *Polygonum punctatum*, *Pontedaria cordata*, *Schoenoplectus americanus*, *Schoenoplectus pungens var. pungens*, *Schoenoplectus tabernaemontani*, *Typha spp.*, *Typha angustifolia*, and *Zizaniopsis miliacea*.

```{r Figure 20, fig.height=6.5, fig.width=7, message=FALSE, warning=FALSE, include=FALSE, out.height=6.5, out.width=7}
p <- ggdraw(reposition_legend(ado_plot("COLO") + 
                            theme(legend.title = element_text(hjust = 0.5, margin = margin(0,0,0,0,"pt")),
                                  axis.title.x.bottom = element_text(hjust = 0.22, margin = margin(5,0,0,0,"pt"))), 
                         panel = "panel-4-3", x = -0.9, y = -0.28, just = c(0,0)),
       ylim = c(-0.12,1)) +
  draw_label(bquote(bold("Figure 20.")~"COLO: The change in cover (%) of species contributing to differences between significantly"), x = 0.02, y = -0.03, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("different year-pairs identified by ADONIS analysis. Note that only the species with the top five greatest")), x = 0.02, y = -0.065, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("changes in cover that contributed to the differences between year-pairs are shown.")), x = 0.02, y = -0.1, fontfamily = "serif", hjust = 0, size = 12)
```
```{r echo=FALSE, fig.height=6.5, fig.width=7, message=FALSE, warning=FALSE, out.height=6.5, out.width=7}
p
```
&nbsp;

##### *3.7.3* Community Composition: FIIS
|       At FIIS, there was a significant difference in community composition between years (*R*2 = `r format(round(adonis$FIIS$mod$R2[1], 2), nsmall = 2)`, *p* < 0.001). An examination of the pairwise comparisons between years at FIIS found significant differences between all year pairs (Figure 21). Only the species with the top four greatest changes in cover that contributed to the differences between these ten year-pairs at FIIS are shown in Figure 21. Additional species with significant differences in cover between at least one year pair at FIIS include *Atriplex patula*, *Hibiscus spp.*, *Hibiscus moscheutos*, *Kosteletzkya virginica*, *Limonium carolinianum*, *Salicornia bigelovii*, *Schoenoplectus pungens*, *Schoenoplectus pungens var. pungens*, *Schoenoplectus robustus*, *Suaeda maritima*, *Symphyotrichum tenuifolium*, and *Typha angustifolia*.

```{r Figure 21, fig.height=7.5, fig.width=6.5, message=FALSE, warning=FALSE, include=FALSE, out.height=7.5, out.width=6.5}
m <- ggdraw() +
  draw_plot(reposition_legend(ado_plot("FIIS") + 
                            theme(legend.title = element_text(hjust = 0.5, margin = margin(0,0,5,0,"pt")),
                                  axis.title.x.bottom = element_text(hjust = 0.22, margin = margin(5,0,0,0, "pt"))), 
                         panel = "panel-4-3", x = -0.9, y = 0.0, just = c(0,0)),
            y = 0.10, height = 0.9) +
  draw_label(bquote(bold("Figure 21.")~"FIIS: The change in cover (%) of species contributing to differences between significantly"), x = 0.02, y = 0.08, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("different year-pairs identified by ADONIS analysis. Note that only the species with the top four")), x = 0.02, y = 0.05, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("greatest changes in cover that contributed to the differences between year-pairs are shown.")), x = 0.02, y = 0.02, fontfamily = "serif", hjust = 0, size = 12)
```
```{r echo=FALSE, fig.height=6.5, fig.width=6.5, message=FALSE, warning=FALSE, out.height=6.5, out.width=6.5}
m
```
&nbsp;

##### *3.7.4* Community Composition: GATE
|       At GATE, there was a significant differnce in community composition between years (*R*2 = `r format(round(adonis$GATE$mod$R2[1], 2), nsmall = 2)`, *p* < 0.001). An examination of the pairwise comparisons between years at GATE found significant differences between 2010 vs. 2014, 2010 vs. 2016, 2014 vs. 2016, 2014 vs. 2018, and 2016 vs. 2018 (Figure 22). Only the species with the top five greatest changes in cover that contributed to the differences between these five year-pairs at GATE are shown in Figure 22. Additional species with significant differences in cover between at least one year pair at GATE include *Iva frutescens*, *Salicornia spp.*, and *Spartina alterniflora*.

```{r Figure 22, echo=FALSE, message=FALSE, warning=FALSE, fig.height=5, fig.width=6.5, out.height=5, out.width=6.5}
ggdraw() +
  draw_plot(ado_plot("GATE") + theme(legend.title = element_text(hjust = 0.5, margin = margin(0,0,5,0, "pt")),
                                     axis.title.x.bottom = element_text(margin = margin(5,0,0,0,"pt"))), 
            y = 0.13, height = 0.87) +
   draw_label(bquote(bold("Figure 22.")~"GATE: The change in cover (%) of species contributing to differences between"), x = 0.02, y = 0.1, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("significantly different year-pairs identified by ADONIS analysis. Note that only the species with the")), x = 0.02, y = 0.06, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("top five greatest changes in cover that contributed to the differences between year-pairs are shown.")), x = 0.02, y = 0.02, fontfamily = "serif", hjust = 0, size = 12)
```
&nbsp;

##### *3.7.5* Community Composition: GEWA
|       At GEWA, there was a significant difference in community composition between years (*R*2 = `r format(round(adonis$GEWA$mod$R2[1], 2), nsmall = 2)`, *p* < 0.001). An examination of the pairwise comparisons between years at GEWA found significant differences between all year pairs (Figure 23). The species with significant differences in cover that contributed to the differences between these year-pairs at GEWA are shown in Figure 23.

```{r Figure 23, echo=FALSE, fig.height=3.5, fig.width=6.5, message=FALSE, warning=FALSE, out.height=3.5, out.width=6.5}
ggdraw() +
  draw_plot(ado_plot("GEWA") + theme(legend.title = element_text(hjust = 0.5, margin = margin(0,0,0,0, "pt"))), y = 0.12, height = 0.88) +
   draw_label(bquote(bold("Figure 23.")~"GEWA: The change in cover (%) of species contributing to differences between"), x = 0.02, y = 0.09, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("significantly different year-pairs identified by ADONIS analysis.")), x = 0.02, y = 0.03, fontfamily = "serif", hjust = 0, size = 12)
```
&nbsp;

##### *3.7.6* Community Composition: SAHI
|       At SAHI, there was a significant difference in community composition between years (*R*2 = `r format(round(adonis$SAHI$mod$R2[1], 2), nsmall = 2)`, *p* < 0.01). An examination of the pairwise comparisons between years at SAHI found significant differences between 2009 vs. 2011, 2009 vs. 2013, 2011 vs. 2013, 2011 vs. 2015, 2011 vs. 2017, 2013 vs. 2015, 2013 vs. 2017, and 2015 vs. 2017 (Figure 24). Only the species with the top five greatest changes in cover that contributed to the differences between these eight year-pairs at SAHI are shown in Figure 24. Additional species with significant differences in cover between at least one year pair at SAHI include *Atriplex cristata*, *Iva frutescens*, and *Salicornia maritima*.

```{r Figure 24, echo=FALSE, message=FALSE, warning=FALSE, fig.height=6.5, fig.width=7, out.height=6.5, out.width=7}
ggdraw() +
  draw_plot(ado_plot("SAHI") + theme(legend.title = element_text(hjust = 0.5, margin = margin(0,0,5,0, "pt")),
                                     axis.title.x.bottom = element_text(margin = margin(5,0,0,0,"pt"))), 
            y = 0.12, height = 0.88) +
   draw_label(bquote(bold("Figure 24.")~"SAHI: The change in cover (%) of species contributing to differences between significantly"), x = 0.02, y = 0.09, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("different year-pairs identified by ADONIS analysis. Note that only the species with the top five greatest")), x = 0.02, y = 0.06, fontfamily = "serif", hjust = 0, size = 12) +
  draw_label(bquote(plain("changes in cover that contributed to the differences between year-pairs are shown.")), x = 0.02, y = 0.03, fontfamily = "serif", hjust = 0, size = 12)
```
&nbsp;

#### **4. Discussion**
|       In the following paragraphs of this section, we summarize the above results for each park. We also identify critical limitations of the current data set and discuss how these findings could be used to modify and improve upon the existing salt marsh vegetation monitoring protocol.
&nbsp;

##### **4.1** Park-level Trends
##### *4.1.1* Park-level Trends: ASIS
|       The salt marsh plant community at ASIS has seen a reduction in total park-level species richness (Figure 3a) that is most likely due to the loss of species with medium salinity tolerance and/or species in the salt marsh open ditch category (Figure 5a and 11a). Similarly, average total plot-level cover at ASIS declined substantially between 2008 to 2018 (Figure 2a), however this change was most likely driven by the decreasing frequency and cover of species with high salinity tolerance and/or species in the salt marsh pool/panne and tidal lagoon categories (Figure 5b and 5c, Figure 11b and 11c). Taken together, these results would seem to suggest that there has been a general decline in all salt marsh habitat at ASIS given the decreases in park-level species richness (Figure 3a) and frequency and cover of species with high salinity tolerance (Figure 5 and 11). Decline in the salt marsh habitats at ASIS could be the result of both conversion to open water due to sea-level rise and climate change and/or conversion to other wetland or upland habitats. However, the second process seems unlikely to be playing a strong role given that total plot cover (i.e., cover of species with all salinity tolerances and community classification categories) also declined between 2008 to 2018 (Figure 2a). Additionally, it is important to note that many of the previously mentioned metrics declined when comparing the data from the first sampling event in 2008 to the last sampling event in 2018, a closer inspection of their respective figures could also suggest that the majority of these declines occurred between 2008 to 2014, after which many of these metrics seemed to experience some recovery, although most have not recovered back to their 2008 level (Figures 2a, 3a, 5c, and 11c) . Regardless of the mechanism, additional data in the form of remotely sensed imagery (either from publicly available collections such as Landsat or from imagery collected by the park or NCBN staff) would be needed to confirm if these declines are indeed occurring as the salt marsh monitoring data would suggest, and also to quantify the spatial magnitude and rate of change.   
&nbsp;

##### *4.1.2* Park-level Trends: COLO
|       
##### *4.1.3* Park-level Trends: FIIS
##### *4.1.4* Park-level Trends: GATE
##### *4.1.5* Park-level Trends: GEWA
##### *4.1.6* Park-level Trends: SAHI
&nbsp; 

##### **4.2** Status of the NCBN Salt Marsh Vegetation Monitoring Protocol
|       The National Park Service Inventory and Monitoring (I&M) Program's Northeast Coastal and Barrier Network (NCBN) has identified salt marsh condition, in addition to several associated vital signs, as a high priority for long-term monitoring. The first iteration of the salt marsh vegetation monitoring protocol was originally developed by the USGS and University of Rhode Island for the purpose of comparing the vegetation community in hydrologically altered marshes to more pristine 'control' marshes in order to understand the potential effects of hydrologic restoration on salt marsh habitats within Cape Cod National Seashore (Roman et al., 2001). This protocol was then adapted to measure change in the species composition and abundance of the salt marsh plant community at the other six coastal parks monitored by NCBN in response to a multitude of stressors such as hydrologic alteration, storms, visitor use, nutrient loading, watershed development, sea-level rise and climate change, among others (Rocks and Stevens 2018). The salt marsh vegetation monitoring protocol was successfully implemented across seven NCBN parks over a period of 10 years from 2008 to 2018, but was placed on hold in 2018 due to staffing and budget shortages. During the years that this protocol was in use, it was by far the most labor- and time-intensive vital sign monitored by NCBN. For instance, assuming a four person crew (two full-time biologists and two interns) was used for each sampling event, a conservative estimate of 7,072 total man-hours were dedicated to field data collection alone during this time (i.e., 221 sampling events *x* 8 hours per day *x* 4 crew members). Further more, this estimate does not include the additional time needed for traveling to and from the NCBN main office (Kingston, Rhode Island) to each park, logistical considerations (e.g., time for budget and travel planning, equipment preparation, clean-up, etc.), or data management and annual reporting tasks, among others. For a more specific example, it took a total of 13 full days to complete field sampling at just 1 park - ASIS - in 2018. Similarly, this protocol was also one of the more budget intensive monitoring programs conducted by NCBN. In 2018, Rocks and Stevens (2018) estimated that the annual operational cost associated with the NCBN salt marsh vegetation monitoring was $50,000 per year - a figure that would likely be much higher today.

|       The data summaries that were suggested for annual reporting in the protocol implementation plan (Rocks and Stevens 2018) include species composition (species lists), percent cover for all cover types by site, and presence of any federal, state-listed and/or non-native species. Additionally, the protocol implementation plan also recommends that trend analysis be conducted on a 3-5 year basis and suggests the use of non-parametric multivariate community analysis methods such as analysis of similarities (ANOSIM) and similarity of percentages analysis (SIMPER) in order to understand change over time. The suggestion to include species lists for annual reporting are necessary in order to have a record of the full suite of species at each park and the compilation of these lists is relatively straightforward and easy to interpret. However, the recommended trend analysis (ANOSIM and SIMPER) do not actually calculate trends and only indicate where differences between plant communities have occurred in the previous sample years. For example, the ADONIS model and subsequent pairwise comparisons (which is analogous to ANOSIM and SIMPER) for FIIS suggest that there is a significant difference in community composition between 2015 vs. 2017, but does not provide any information about overall long-term trends in community composition. As such, these methods of analysis have limited value for understanding the broader 'big-picture' changes in these salt marsh plant communities and also do not provide a means for anticipating (i.e., predicting) future changes and developing management actions that may be needed to either counteract or facilitate these changes. 


##### **4.3** Opportunities for Future Salt Marsh Vegetation Monitoring at NCBN Parks
|       Recent studies using uncrewed aerial systems (UAS) for ecological monitoring have demonstrated great promise as an alternative to time-consuming and expensive on-the-ground surveys (citations here). The current state of the technology may not provide results that are directly comparable to the current NCBN protocol since it can be difficult to identify specific species via UAS imagery (especially in areas with higher diversity (brackish marshes like COLO), areas with lots of overlapping layers, or areas with several species that are virtually indistinguishable in even high resolution imagery (e.g., spartina patens vs. distichlis)). However, it may be feasible to classify marshes into relatively broad categories such as low marsh vs. high marsh or to pick out a few species that are easily distinguished from surrounding vegetation e.g. S. alterniflora vs. mixed Distichlis/S. patens (Mason Harris et al., 2024). In fact, monitoring a subset of ecologically important species/cover groups is likely to be just as (if not more) informative for understanding changes in marsh condition as compared to measuring the cover of every single species in every plot because even the most pristine North American salt marshes are known to have very low plant diversity. Similarly, the use of broad cover categories (as opposed to % cover of every unique species) may provide information that is more easily interpreted and thus more readily actionable by park resource managers. 

|       Additionally, we could combine other remotely-sensed metrics of marsh health with the cover classifications to obtain a comprehensive picture of marsh health since marsh health can be reflected in many different aspects of the structure and function of the plant community. For example, results obtained from the current ground-survey method indicate that species richness and diversity has remained stable over time, thus giving the impression that the marsh is also maintaining a 'stable' condition. However, when this data is combined with other remotely-derived metrics of marsh health, such as..., it may be apparent that the productivity or biomass of the marsh is actually decreasing over time, indicating a decline in condition that would not otherwise be apparent from the percent cover data alone. Similarly, remotely-derived metrics of marsh health may not be easily measured by on-the-ground surveys. For example, it is much less labor intensive, and also less damaging to the marsh, to estimate changes in biomass from remotely-sensed imagery as compared to the destructive harvesting that is necessary for the traditional clip-plot method. Thus, remotely-sensed data may also provide information that is more ecologically relevant while also being much less labor and cost intensive.
&nbsp;

#### **5. Literature Cited**

Benjamini, Y., and Y. Hochberg. 1995. Controlling the false discovery rate: a practical and powerful approach to multiple testing. Journal of the Royal Statistical Society Series B 57:289-300. doi.org/10.1111/j/2517-6161.1995.tb02031.x.

Lichvar, R.W., D.L. Banks, W.N. Kirchner, and N.C. Melvin. 2016. The National Wetland Plant List: 2016 wetland ratings. Phytoneuron 2016-30: 1-17. https://wetland-plants.sec.usace.army.mil/.

Mason Harris, J., W.P. Broussard III, and J.A. Nelson. 2024. Evaluating coastal wetland restoration using drones and high-resolution imagery. Estuaries and Coasts 47:1359-1375. doi.org/10.1007/s12237-024-01376-1.

Nicosia, E.L., and P.S. Pooler. 2012a. Monitoring salt marsh vegetation and nekton at Fire Island National Seashore: 2011 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2012/397. National Park Service, Fort Collins, Colorado.

Nicosia, E.L., and P.S. Pooler. 2012b. Monitoring salt marsh vegetation and nekton at William Floyd Estate, Fire Island National Seashore: 2011 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2012/399. National Park Service, Fort Collins, Colorado.

Nicosia, E.L., and P.S. Pooler. 2012c. Monitoring salt marsh vegetation and nekton at Sagamore Hill National Historic Site: 2011 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2012/398. National Park Service, Fort Collins, Colorado.

Nicosia, E.L. 2013a. Monitoring salt marsh vegetation and nekton at Assateague Island National Seashore: 2012 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2013/655. National Park Service, Fort Collins, Colorado.

Nicosia, E.L. 2013b. Monitoring salt marsh vegetation at Colonial National Historical Park: 2012 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2013/444. National Park Service, Fort Collins, Colorado.

Nicosia, E.L. 2013c. Monitoring salt marsh vegetation and nekton at Gateway National Recreation Area’s Sandy Hook Unit: 2012 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2013/458. National Park Service, Fort Collins, Colorado.

Nicosia, E.L. 2013d. Monitoring salt marsh vegetation at George Washington Birthplace National Monument: 2012 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2013/442. National Park Service, Fort Collins, Colorado.

Nicosia, E.L. 2015a. Monitoring salt marsh vegetation at Colonial National Historical Park: 2014 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2015/791. National Park Service, Fort Collins, Colorado.

Nicosia, E.L. 2015b. Monitoring salt marsh vegetation and nekton at Fire Island National Seashore and the William Floyd Estate: 2015 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2015/995. National Park Service, Fort Collins, Colorado.

Nicosia, E.L. 2015c. Monitoring salt marsh vegetation at Gateway National Recreation Area’s Sandy Hook Unit: 2014 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2015/793. National Park Service, Fort Collins, Colorado.

Nicosia, E.L. 2015d. Monitoring salt marsh vegetation and nekton at Sagamore Hill National Historic Site: 2015 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2015/996. National Park Service, Fort Collins, Colorado.

Patenaude, E.L., and P.S. Pooler. 2010a. Salt marsh vegetation and nekton community monitoring at Assateague Island National Seashore: 2008 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2010/065. National Park Service, Fort Collins, Colorado.

Patenaude, E.L., and P.S. Pooler. 2010b. Salt marsh vegetation monitoring at Colonial National Historical Park: 2008 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2010/066. National Park Service, Fort Collins, Colorado. 

Patenaude, E.L., and P.S. Pooler. 2010c. Monitoring salt marsh vegetation at Colonial National Historical Park: 2010 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2010/120. National Park Service, Fort Collins, Colorado.

Patenaude, E.L., and P.S. Pooler. 2010d. Salt marsh vegetation and nekton community monitoring at William Floyd Estate, Fire Island National Seashore. Natural Resource Technical Report NPS/NCBN/NRDS—2010/070. National Park Service, Fort Collins, Colorado.

Patenaude, E.L., and P.S. Pooler. 2010e. Salt marsh vegetation and nekton community monitoring at Fire Island National Seashore: 2009 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2010/068. National Park Service, Fort Collins, Colorado. 

Patenaude, E.L., and P.S. Pooler. 2010f. Salt marsh vegetation and nekton community monitoring at William Floyd Estate, Fire Island National Seashore: 2009 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2010/070. National Park Service, Fort Collins, Colorado.

Patenaude, E.L., and P.S. Pooler. 2010g. Salt marsh vegetation and nekton community monitoring at George Washington Birthplace National Monument: 2008 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2010/069. National Park Service, Fort Collins, Colorado. 

Patenaude, E.L., and P.S. Pooler. 2010h. Salt marsh vegetation and nekton community monitoring at Sagamore Hill National Historical Site: 2009 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2010/067. National Park Service, Fort Collins, Colorado.

Patenaude, E.L., and P.S. Pooler. 2011a. Monitoring salt marsh vegetation and nekton at Assateague Island National Seashore: 2010 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2011/312. National Park Service, Fort Collins, Colorado.

Patenaude, E.L., and P.S. Pooler. 2011b. Monitoring salt marsh vegetation and nekton at Gateway National Recreation Area’s Sandy Hook Unit: 2010 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2011/132. National Park Service, Fort Collins, Colorado.

Patenaude, E.L., and P.S. Pooler. 2011c. Salt marsh vegetation and nekton community monitoring at George Washington Birthplace National Monument: 2010 summary report. Natural Resource Data Series NPS/NCBN/NRDS—2011/133. National Park Service, Fort Collins, Colorado.

Rocks, E.N., and S.M. Stevens. 2018. Northeast Coastal and Barrier Network salt marsh vegetation monitoring protocol implementation plan: Version 1.0. Natural Resource Report NPS/NCBN/NRR—2018/1790. National Park Service, Fort Collins, Colorado.

Roman, C.T., M.J. James-Pirri, and J.F. Heltshe. 2001. Monitoring Salt Marsh Vegetation: A Protocol for the Long-term Coastal Ecosystem Monitoring Program at Cape Cod National Seashore. Coordinated by the USGS Patuxent Wildlife Research Center, Coastal Research Field Station at the University of Rhode Island, Narragansett, RI 02882. Available at https://irma.nps.gov/DataStore/Reference/Profile/563500.

Smith, S.M. 2015. Salt marsh vegetation monitoring report, Cape Cod National Seashore: A summary of monitoring data from 2003, 2008, and 2013. Natural Resource Report NPS/CACO/NRR-2015/920. National Park Service, Fort Collins, Colorado.

State of New York. 2022. [New York Laws, Environmental Conservation § 9-170](https://law.justia.com/codes/new-york/2022/env/article-9/title-17/9-1709/). New York Department of State. 2021. [6 New York Codes, Rules and Regulations Part 575: Prohibited and Regulated Invasive Species](https://govt.westlaw.com/nycrr/Browse/Home/NewYork/NewYorkCodesRulesandRegulations?guid=Ie8d3e7b0339611e4baa20000845b8d3e&originationContext=documenttoc&transitionType=Default&contextData=(sc.Default)).

U.S. Army Corps of Engineers. 2009. Regional supplement to the Corps of Engineers Wetland Delineation Manual: Northcentral and Northeast Region. U.S. Army Corps of Engineers, Engineer Research and Development Center, Environmental Laboratory ERDC/EL TR-09-19.
&nbsp;

Warton, D.I., Wright, T.W., Wang, Y. 2012. Distance-based multivariate analyses confound location and dispersion effects. Methods in Ecology and Evolution, 3, 89–101.

#### **6. Appendices**
```{r Appendix 1, echo=FALSE, fig.width=6.5, message=FALSE, warning=FALSE, ft.keepnext=FALSE, out.width=6.5}
data.frame(
  state = c("MA", "NY", "NJ", "MD", "VA"),
  rare_source = c(
    "https://www.mass.gov/info-details/list-of-\nendangered-threatened-and-special-concern-\nspecies",
    "https://www.nynhp.org/documents/5/rare-\nplant-status-lists-2023.pdf",
    "https://www.nj.gov/dep/parksandforests/\nnatural/docs/njplantlist.pdf",
    "https://dnr.maryland.gov/wildlife/documents/\nrte_plant_list.pdf",
    "https://www.dcr.virginia.gov/natural-\nheritage/document/plantlist-current.pdf"),
    invasive_source = c(
      "https://massnrc.org/mipag/species\nreviewed_category.htm",
      "https://govt.westlaw.com/nycrr/Browse/Home/\nNewYork/NewYorkCodesRulesandRegulations?\nguid=Ie8d3e7b0339611e4baa20000845b8d3e&\noriginationContext=documenttoc&transitionType=\nDefault&contextData=(sc.Default)",
      "https://dep.nj.gov/invasive-species/plants/",
      "https://mda.maryland.gov/plants-pests/\nDocuments/Invasive-Plant-List-March-2020.pdf",
      "https://www.dcr.virginia.gov/natural-heritage/\ninvsppdflist")
) %>%
  flextable(data = .) %>%
  set_header_labels(., state = "State", rare_source = "Rare species list source", invasive_source = "Invasive species list source") %>%
  align(., align = "center", part = "all") %>%
  align(., j = c(2,3), part = "body", align = "left") %>%
  padding(., part = "body", padding.top = 3, padding.bottom = 3, padding.left = 3, padding.right = 3) %>%
  padding(., i = 1, j = 1, part = "header", padding.left = 5, padding.right = 5) %>%
  padding(., j = 1, part = "body", padding.left = 5, padding.right = 5) %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  add_header_lines(., values = c("Appendix 1. Data sources for rare and invasive species lists for each state.")) %>%
  align(., i = 1, align = "left", part = "header") %>%
  padding(., i = 1, part = "header", padding.left = 0)
```
&nbsp;

```{r Appendix 2, echo=FALSE, message=FALSE, warning=FALSE}

cover_appdx <- perc_cover %>%
  group_by(UnitCode, SciName_cor) %>%
  summarise(mean_cover = mean(mean_cover, na.rm = TRUE)) 

frq_appdx <- frq %>%
  group_by(UnitCode, SciName_cor) %>%
  summarise(mean_frq = mean(mean_frq, na.rm = TRUE))

imp_appdx <- perc_cover %>%
  group_by(UnitCode, SciName_cor) %>%
  summarise(mean_cover = mean(mean_cover, na.rm = TRUE)) %>%
  left_join(., frq_appdx %>% ungroup(), by = c("UnitCode", "SciName_cor")) %>%
  ungroup() %>%
  mutate(imp = (((mean_cover/100) + mean_frq)/2)*10) %>%
  filter(!is.na(imp)) %>%
  group_by(UnitCode, SciName_cor) %>%
  summarise(mean_imp = mean(imp, na.rm = TRUE))

appdx_letter_labs <- list(
  "sal_codes" = plot_veg_cover_usda %>%
    mutate(SalinityCode = case_when(SalinityCode == "high >18 ppt" ~ "High",
                                    SalinityCode == "medium 0.5-18 ppt" ~ "Medium",
                                    SalinityCode == "low <0.5 ppt" ~ "Low", 
                                    SalinityCode == "unknown" ~ NA, 
                                    SalinityCode == "no" ~ NA,
                                    T ~ SalinityCode),
           SalinityTolerance = case_when(SalinityTolerance == "" ~ NA,
                                         SalinityTolerance == "None" ~ NA,
                                         T ~ SalinityTolerance)) %>%
    mutate(sal_code = if_else(is.na(SalinityTolerance) & !is.na(SalinityCode), SalinityCode, SalinityTolerance)) %>%
    filter(!is.na(sal_code)) %>%
    ungroup() %>%
    select(SciName_cor, sal_code) %>%
    distinct() %>%
    mutate(sal_code = case_when(sal_code == "Low" ~ "L",
                                sal_code == "Medium" ~ "M",
                                sal_code == "High" ~ "H")),
  
  "commun_codes" = plot_veg_cover_usda %>%
    filter(!is.na(Community_Class) & Community_Class != "9") %>%
    ungroup() %>%
    select(SciName_cor, Community_Class) %>%
    distinct() %>%
    mutate(commun_class = case_when(Community_Class == "freshwater wetland" ~ "6",
                                    Community_Class == "salt marsh" ~ "1",
                                    Community_Class == "salt marsh open ditch" ~ "2",
                                    Community_Class == "salt marsh plugged ditch" ~ "7",
                                    Community_Class == "salt marsh pool/panne" ~ "3",
                                    Community_Class == "salt marsh shoreline" ~ "8",
                                    Community_Class == "tidal creek" ~ "4",
                                    Community_Class == "tidal lagoon" ~ "5")),
  
  "invasive_codes" = plot_veg_cover_usda %>% 
    mutate(is_invasive = case_when(if_any(starts_with("invasive_"), ~ .x == "T") ~ "T")) %>% 
    ungroup() %>%
    select(UnitCode, SciName_cor, is_invasive) %>%
    distinct() %>%
    mutate(is_invasive = if_else(is.na(is_invasive), "", "I"))
)

top5 <- list(
  "top5cover" = cover_appdx %>% 
    group_by(UnitCode) %>%
    slice_max(order_by = mean_cover, n = 5) %>%
    left_join(., appdx_letter_labs$sal_codes, by = c("SciName_cor")) %>%
    left_join(., appdx_letter_labs$commun_codes, by = c("SciName_cor")) %>%
    left_join(., appdx_letter_labs$invasive_codes, by = c("UnitCode", "SciName_cor")) %>%
    mutate(characteristics_cover = paste0(is_invasive, sal_code, commun_class)) %>%
    ungroup() %>%
    select(UnitCode, mean_cover, "sciname_cover" = SciName_cor, characteristics_cover) %>%
    mutate(sciname_cover = if_else(sciname_cover %in% c("Salicornia", "Suaeda"), paste0(sciname_cover, " spp."), sciname_cover)),
  
  "top5frq" = frq_appdx %>%
    group_by(UnitCode) %>%
    slice_max(order_by = mean_frq, n = 5) %>%
    left_join(., appdx_letter_labs$sal_codes, by = c("SciName_cor")) %>%
    left_join(., appdx_letter_labs$commun_codes, by = c("SciName_cor")) %>%
    left_join(., appdx_letter_labs$invasive_codes, by = c("UnitCode", "SciName_cor")) %>%
    mutate(characteristics_frq = paste0(is_invasive, sal_code, commun_class)) %>%
    ungroup() %>%
    select(mean_frq, "sciname_frq" = SciName_cor, characteristics_frq)  %>%
    mutate(sciname_frq = if_else(sciname_frq %in% c("Salicornia", "Suaeda"), paste0(sciname_frq, " spp."), sciname_frq)),
  
  "top5imp" = imp_appdx %>%
    group_by(UnitCode) %>%
    slice_max(order_by = mean_imp, n = 5, with_ties = FALSE) %>%
    left_join(., appdx_letter_labs$sal_codes, by = c("SciName_cor")) %>%
    left_join(., appdx_letter_labs$commun_codes, by = c("SciName_cor")) %>%
    left_join(., appdx_letter_labs$invasive_codes, by = c("UnitCode", "SciName_cor")) %>%
    mutate(characteristics_imp = paste0(is_invasive, sal_code, commun_class)) %>%
    ungroup() %>%
    select(mean_imp, "sciname_imp" = SciName_cor, characteristics_imp) %>%
    mutate(sciname_imp = if_else(sciname_imp %in% c("Salicornia", "Suaeda"), paste0(sciname_imp, " spp."), sciname_imp))
)

bind_cols(top5$top5cover, top5$top5frq, top5$top5imp) %>%
flextable(data = ., col_keys = c("UnitCode", "dummy_cover", "mean_cover", "dummy_frq", "mean_frq", "dummy_imp", "mean_imp")) %>%
  align(., align = "center", part = "all") %>%
  add_header_lines(., values = c("Appendix 3. Salt marsh plant cover species with the top five highest average cover, frequency, and importance value in each park unit. Importance values were calculated as the mean of the average cover and frequency for each species at each park. The letter 'I' following a species name indicates that the species is considered invasive. Additional letters and numbers represent the species salinity tolerance and community class (respectively). Salinity tolerance: L = low, M = medium, H = high. Community class: 1 = salt marsh, 2 = salt marsh open ditch, 3 = salt marsh pool/panne, 4 = tidal creek, 5 = tidal lagoon, 6 = freshwater wetland, 7 = salt marsh plugged ditch, 8 = salt marsh shoreline.")) %>%
  mk_par(j = "dummy_cover", value = as_paragraph(as_i(sciname_cover), as_chunk(" "), characteristics_cover)) %>%
  mk_par(j = "dummy_frq", value = as_paragraph(as_i(sciname_frq), as_chunk(" "), characteristics_frq)) %>%
  mk_par(j = "dummy_imp", value = as_paragraph(as_i(sciname_imp), as_chunk(" "), characteristics_imp)) %>%
  colformat_double(., j = 3, digits = 1) %>%
  colformat_double(., j = c(5,7), digits = 2) %>%
  set_header_labels(., UnitCode = "Park Unit", dummy_cover = "Species", mean_cover = "Cover (%)", dummy_frq = "Species", mean_frq = "Frequency", dummy_imp = "Species", mean_imp = "Importance") %>%
  align(., i = 1, align = "left", part = "header") %>%
  hline(., i = c(5,10,15,20,25), border = fp_border(color = "black", width = 1)) %>%
  merge_v(., j = 1) %>%
  fix_border_issues() %>%
  padding(., part = "body", padding.top = 3, padding.bottom = 3) %>%
  autofit()
```
&nbsp;

```{r Appendix 3 setup species lists for each park, message=FALSE, warning=FALSE, include=FALSE}
species_list_table_fun <- function(park_code, letter, park) {
  plot_veg_cover_usda %>%
    ungroup() %>%
    select(UnitCode, SciName_cor) %>%
    group_by(UnitCode) %>%
    distinct(SciName_cor) %>%
    ungroup() %>%
    filter(UnitCode == park_code) %>%
    select(SciName_cor) %>%
    arrange(SciName_cor) %>%
    left_join(., plot_veg_cover_usda 
              %>% ungroup() 
              %>% select(SciName_cor, CommonName, AcceptedSymbol, Community_Class, SalinityCode, SalinityTolerance) 
              %>% distinct(SciName_cor, CommonName, AcceptedSymbol, Community_Class, SalinityCode, SalinityTolerance), 
              by = "SciName_cor") %>%
    mutate(SalinityCode = case_when(SalinityCode == "high >18 ppt" ~ "High",
                                    SalinityCode == "medium 0.5-18 ppt" ~ "Medium",
                                    SalinityCode == "low <0.5 ppt" ~ "Low", 
                                    SalinityCode == "unknown" ~ NA, 
                                    SalinityCode == "no" ~ NA,
                                    T ~ SalinityCode),
           SalinityTolerance = case_when(SalinityTolerance == "" ~ NA,
                                         SalinityTolerance == "None" ~ NA,
                                         T ~ SalinityTolerance),
           SciName_cor = if_else(SciName_cor %in% c("Aster", "Bassia", "Bromus", "Carex", "Cuscuta", "Cyperus", "Digitaria", "Eleocharis", "Eragrostis", "Galium", "Ipomoea", "Hibiscus", "Hydrocotyle", "Juncus", "Leersia", "Lepidium", "Lonicera", "Lycopus", "Melilotus", "Panicum", "Polygonum", "Rosa", "Rubus", "Rumex", "Salicornia", "Scirpus", "Solidago", "Suaeda", "Typha", "Vitis"), paste0(SciName_cor, " spp."), SciName_cor)) %>%
    mutate(sal_code = if_else(is.na(SalinityTolerance) & !is.na(SalinityCode), SalinityCode, SalinityTolerance),
           Community_Class = if_else(Community_Class == "9", NA, Community_Class)) %>%
    select(SciName_cor, CommonName, AcceptedSymbol, Community_Class, sal_code) %>%
    flextable(.) %>%
    align(., align = "center", part = "all") %>%
    set_table_properties(., layout = "autofit") %>%
    add_header_lines(., values = c(paste0("Appendix 3", letter, ". Salt marsh plant species list for ", park, ". Species labeled with .spp could not be identified beyond the genus level. Common names and symbols are derived from the USDA Plants database (plants.usda.gov). Salinity tolerance categories are from the USDA Plants database. Low = < 0.5 ppt, Medium = 0.5 to 18 ppt, High = > 18 ppt. Species without salinity tolerance data or community classifications are labeled with blanks in these columns."))) %>%
    set_header_labels(., SciName_cor = "Species", CommonName = "Common Name", AcceptedSymbol = "Symbol", sal_code = "Salinity Tolerance", Community_Class = "Community Class") %>%
    align(., i = 1, align = "left", part = "header") %>%
    border_inner_h(., border = fp_border(color = "transparent"), part = "body") %>%
    style(j = 1, pr_t = fp_text_default(italic = TRUE)) 
}
```

```{r Appendix 4A: Species lists for ASIS, echo=FALSE, message=FALSE, warning=FALSE}
species_list_table_fun(park_code = "ASIS", letter = "A", park = "Assateague Island National Seashore")
```
&nbsp;

```{r Appendix 4B: Species lists for COLO, echo=FALSE, message=FALSE, warning=FALSE}
species_list_table_fun(park_code = "COLO", letter = "B", park = "Colonial National Historical Park")
```
&nbsp;

```{r Appendix 4C: Species lists for FIIS, echo=FALSE, message=FALSE, warning=FALSE}
species_list_table_fun(park_code = "FIIS", letter = "C", park = "Fire Island National Seashore")
```
&nbsp;

```{r Appendix 4D: Species lists for GATE, echo=FALSE, message=FALSE, warning=FALSE}
species_list_table_fun(park_code = "GATE", letter = "D", park = "Gateway National Recreation Area")
```
&nbsp;

```{r Appendix 4E: Species lists for GEWA, echo=FALSE, message=FALSE, warning=FALSE}
species_list_table_fun(park_code = "GEWA", letter = "E", park = "George Washington Birthplace National Monument")
```
&nbsp;

```{r Appendix 4F: Species lists for SAHI, echo=FALSE, message=FALSE, warning=FALSE}
species_list_table_fun(park_code = "SAHI", letter = "F", park = "Sagamore Hill National Historic Site")
```


```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
# species with the greatest changes in cover for at least 1 year pair
plot_veg_cover_usda %>%
  filter(UnitCode == "FIIS") %>%
  ungroup() %>%
  select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, rel_percent_cover) %>%
  group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_site_cover = mean(rel_percent_cover, na.rm = T)) %>%
  group_by(UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_cover = mean(mean_site_cover, na.rm = T)) %>%
  mutate(year = as.Date(paste0(Year_chr, "-01-01"))) %>%
  filter(str_detect(SciName_cor, '^Spartina patens')) %>%
    ggplot(., aes(x = year, y = mean_cover)) +
  geom_line(aes(color = SciName_cor)) +
    geom_point(aes(color = SciName_cor))
  
#Baccharis, Carex, Iva fru, Juncus gerardii, Juncus roe, 
#?Morella cerifera, Pinus taeda, Salicornia, Salicornia big, Sal mari,
#Smilax rotundifolia, Spartina patens, Suaeda maritima, Vitis rotund

#Hydrocotyle vert, Juniperus virginiana, Lilaeopsis chinensis, 
#Phragmites australis, Peltandra virginica, Pluchea odorata, Sagittaria lancifolia,
#spartina alterniflora, spartina cynosuroides, 
#Teucrium Canadense, Zizania aquatica, Zizania miliacea

#Baccharis, Eleocharis, Hibiscus moscheutos, Iva fru, Juncus, Juncus canadensis,
#Juncus gerardii, Limonium carolinianum, Mikania scandens, Phragmites australis,
#Schoenoplectus pungens var. pungens, Teucrium canadense, 
#Toxicodendron radicans, Typha angustifolia

f<-c("Baccharis", "Distichlisspicata", "Decodonverticillatus", "Hibiscusmoscheutos",
"Kosteletzkyavirginica", "Lythrumlineare", "Mikaniascandens", "Peltandravirginica",
"Polygonumarifolium", "Quercusphellos", 
"Spartinaalterniflora", "Spartinacynosuroides", "Spartinapatens", "Zizaniaaquatica")

plot_veg_cover_usda %>%
  filter(UnitCode == "ASIS") %>%
  ungroup() %>%
  select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, rel_percent_cover) %>%
  group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_site_cover = mean(rel_percent_cover, na.rm = T)) %>%
  group_by(UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_cover = mean(mean_site_cover, na.rm = T)) %>%
  mutate(Year_chr = paste0("a", Year_chr)) %>%
  pivot_wider(., names_from = "Year_chr", values_from = "mean_cover") %>%
  mutate(a2008_2010 = abs(a2010-a2008),
         a2008_2012 = abs(a2012-a2008),
         a2008_2014 = abs(a2014-a2008),
         a2008_2016 = abs(a2016-a2008),
         a2008_2018 = abs(a2018-a2016),
         a2010_2012 = abs(a2012-a2010),
         a2010_2014 = abs(a2014-a2010),
         a2010_2016 = abs(a2016-a2010),
         a2010_2018 = abs(a2018-a2010),
         a2012_2014 = abs(a2014-a2012),
         a2012_2016 = abs(a2016-a2012),
         a2012_2018 = abs(a2018-a2012),
         a2014_2016 = abs(a2016-a2014),
         a2014_2018 = abs(a2018-a2014),
         a2016_2018 = abs(a2016-a2018)) %>%
  select(-c(a2008, a2010, a2012, a2014, a2016, a2018)) %>%
  pivot_longer(., cols = -c("UnitCode", "SciName_cor"), names_to = "year_pair", values_to = "dif") %>%
  filter(dif >= 15) %>%
  ungroup() %>%
  select(SciName_cor) %>%
  arrange(SciName_cor) %>%
  distinct()

plot_veg_cover_usda %>%
  filter(UnitCode == "COLO") %>%
  ungroup() %>%
  select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, rel_percent_cover) %>%
  group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_site_cover = mean(rel_percent_cover, na.rm = T)) %>%
  group_by(UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_cover = mean(mean_site_cover, na.rm = T)) %>%
  mutate(Year_chr = paste0("a", Year_chr)) %>%
  pivot_wider(., names_from = "Year_chr", values_from = "mean_cover") %>%
  mutate(a2008_2010 = abs(a2010-a2008),
         a2008_2012 = abs(a2012-a2008),
         a2008_2014 = abs(a2014-a2008),
         a2008_2016 = abs(a2016-a2008),
         a2010_2012 = abs(a2012-a2010),
         a2010_2014 = abs(a2014-a2010),
         a2010_2016 = abs(a2016-a2010),
         a2012_2014 = abs(a2014-a2012),
         a2012_2016 = abs(a2016-a2012),
         a2014_2016 = abs(a2016-a2014)) %>%
  select(-c(a2008, a2010, a2012, a2014, a2016)) %>%
  pivot_longer(., cols = -c("UnitCode", "SciName_cor"), names_to = "year_pair", values_to = "dif") %>%
  filter(dif >= 15) %>%
  ungroup() %>%
  select(SciName_cor) %>%
  arrange(SciName_cor) %>%
  distinct()

plot_veg_cover_usda %>%
  filter(UnitCode == "FIIS") %>%
  ungroup() %>%
  select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, rel_percent_cover) %>%
  group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_site_cover = mean(rel_percent_cover, na.rm = T)) %>%
  group_by(UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_cover = mean(mean_site_cover, na.rm = T)) %>%
  mutate(Year_chr = paste0("a", Year_chr)) %>%
  pivot_wider(., names_from = "Year_chr", values_from = "mean_cover") %>%
  mutate(a2009_2011 = abs(a2011-a2009),
         a2009_2013 = abs(a2013-a2009),
         a2009_2015 = abs(a2015-a2009),
         a2009_2017 = abs(a2017-a2009),
         a2011_2013 = abs(a2013-a2011),
         a2011_2015 = abs(a2015-a2011),
         a2011_2017 = abs(a2017-a2011),
         a2013_2015 = abs(a2015-a2013),
         a2013_2017 = abs(a2017-a2013),
         a2015_2017 = abs(a2017-a2015)) %>%
  select(-c(a2009, a2011, a2013, a2015, a2017)) %>%
  pivot_longer(., cols = -c("UnitCode", "SciName_cor"), names_to = "year_pair", values_to = "dif") %>%
  filter(dif >= 15) %>%
  ungroup() %>%
  select(SciName_cor) %>%
  arrange(SciName_cor) %>%
  distinct()

plot_veg_cover_usda %>%
  filter(UnitCode == "GEWA") %>%
  ungroup() %>%
  select(EventID, UniqueID, UnitCode, Year_chr, SciName_cor, rel_percent_cover) %>%
  group_by(UniqueID, UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_site_cover = mean(rel_percent_cover, na.rm = T)) %>%
  group_by(UnitCode, Year_chr, SciName_cor) %>%
  summarise(mean_cover = mean(mean_site_cover, na.rm = T)) %>%
  mutate(Year_chr = paste0("a", Year_chr)) %>%
  pivot_wider(., names_from = "Year_chr", values_from = "mean_cover", values_fill = 0) %>%
  mutate(a2008_2010 = abs(a2010-a2008),
         a2008_2012 = abs(a2012-a2008),
         a2010_2012 = abs(a2012-a2010)) %>%
  select(UnitCode, SciName_cor, a2008_2010, a2008_2012, a2010_2012) %>%
  pivot_longer(., cols = -c("UnitCode", "SciName_cor"), names_to = "year_pair", values_to = "dif") %>%
  filter(dif >= 15) %>%
  ungroup() %>%
  select(SciName_cor) %>%
  arrange(SciName_cor) %>%
  distinct()
  

park <- "ASIS"
ado_species <- species_matrix %>%
  arrange(EventID, UniqueID, UnitCode, Year_chr) %>%
  filter(UnitCode == park) %>%
  select(-c(EventID, UniqueID, UnitCode, Year_chr))

ado_env <- species_matrix %>%
  arrange(EventID, UniqueID, UnitCode, Year_chr) %>%
  filter(UnitCode == park) %>%
  select(EventID, UniqueID, Year_chr) %>%
  distinct() %>%
  mutate(min_year = min(as.integer(Year_chr)),
         max_year = max(as.integer(Year_chr)),
         year_dif = as.integer(Year_chr)-min_year)

ado_mod <- adonis2(ado_species ~ year_dif, data = ado_env)

#ado_pairwise <- pairwiseAdonis::pairwise.adonis(ado_species, ado_env$year_dif) %>%
 # filter(p.adjusted < 0.05)

list("species" = ado_species, "env" = ado_env, "mod" = ado_mod, "pairwise" = ado_pairwise)
```

```{r}
npspecies <- readxl::read_xlsx(here::here("data", "NPSpecies", "NPSpecies_Combined_List.xlsx")) %>% 
  distinct(`Scientific Name`) %>%
  pull() %>%
  as.list()

npspecies_resolve <- do.call(list, lapply(npspecies[c(1:2311)], function(p) {
  tryCatch(taxize::gnr_resolve(sci = p, data_source_ids = 3, fields = "all"), error = function(e) return(NULL))
}))

save(npspecies_resolve, file = "./data/derived/npspecies_resolve.rda")

data_species <- plot_veg_cover_usda %>%
  ungroup() %>%
  select("Scientific Name" = SciName_cor) %>%
  distinct(`Scientific Name`) %>%
  pull() %>%
  as.list()

data_species_resolve <- do.call(list, lapply(data_species[c(1:156)], function(p) {
  tryCatch(taxize::gnr_resolve(sci = p, data_source_ids = 3, fields = "all", canonical = TRUE), error = function(e) return(NULL))
}))

f <- data_species_resolve %>%
  bind_rows() %>%
  filter(!str_detect(classification_path, "Animalia") & score >= 0.90) %>%
  mutate(TSN_gnr = if_else(is.na(current_taxon_id), taxon_id, current_taxon_id)) %>%
  select(user_supplied_name, matched_name2, taxon_id, current_taxon_id, TSN_gnr) %>%
  left_join(., plot_veg_cover_usda %>%
              ungroup() %>%
              select(SciName_cor, TSN) %>%
              distinct(),
            by = c("user_supplied_name" = "SciName_cor")) %>%
  mutate(name_match = if_else(user_supplied_name == matched_name2, T, F),
         TSN_match = if_else(TSN_gnr == TSN, T, F)) %>%
  filter(name_match == F | TSN_match == F)
```

